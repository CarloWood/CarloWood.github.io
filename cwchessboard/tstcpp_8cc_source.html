<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html LANG="en_US">

<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="Author" content="Carlo Wood">
<meta name="description" content="cwchessboard version 2.0.9">
<title>cwchessboard: tstcpp.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="main.css" rel="stylesheet" type="text/css">
</head>

<body>

<div class="normal">
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>tstcpp.cc</h1>  </div>
</div>
<div class="contents">
<a href="tstcpp_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// cwchessboard -- A C++ chessboard tool set for gtkmm</span>
<a name="l00002"></a>00002 <span class="comment">//</span><span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">//! @file tstcpp.cc A full-blown test application used for debugging %cwchess::%ChessPosition.</span>
<a name="l00004"></a>00004 <span class="comment"></span><span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// Copyright (C) 2008 - 2010, by</span>
<a name="l00006"></a>00006 <span class="comment">// </span>
<a name="l00007"></a>00007 <span class="comment">// Carlo Wood, Run on IRC &lt;carlo@alinoe.com&gt;</span>
<a name="l00008"></a>00008 <span class="comment">// RSA-1024 0x624ACAD5 1997-01-26                    Sign &amp; Encrypt</span>
<a name="l00009"></a>00009 <span class="comment">// Fingerprint16 = 32 EC A7 B6 AC DB 65 A6  F6 F6 55 DD 1C DC FF 61</span>
<a name="l00010"></a>00010 <span class="comment">// </span>
<a name="l00011"></a>00011 <span class="comment">// This program is free software: you can redistribute it and/or modify</span>
<a name="l00012"></a>00012 <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l00013"></a>00013 <span class="comment">// the Free Software Foundation, either version 2 of the License, or</span>
<a name="l00014"></a>00014 <span class="comment">// (at your option) any later version.</span>
<a name="l00015"></a>00015 <span class="comment">// </span>
<a name="l00016"></a>00016 <span class="comment">// This program is distributed in the hope that it will be useful,</span>
<a name="l00017"></a>00017 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00018"></a>00018 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00019"></a>00019 <span class="comment">// GNU General Public License for more details.</span>
<a name="l00020"></a>00020 <span class="comment">// </span>
<a name="l00021"></a>00021 <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l00022"></a>00022 <span class="comment">// along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00023"></a>00023 <span class="comment">// cwmm::ChessboardWidget usage example in C++ code.</span>
<a name="l00024"></a>00024 <span class="comment">//</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;sys.h&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;iomanip&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;gtk/gtk.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;gtkmm/box.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;gtkmm/main.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;gtkmm/window.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;gtkmm/stock.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;gtkmm/uimanager.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;gtkmm/radioaction.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;gtkmm/menu.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;gtkmm/iconfactory.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;cstring&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;stack&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="ChessPositionWidget_8h.html" title="This file contains the declaration of class ChessPositionWidget.">ChessPositionWidget.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;debug.h&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="ChessNotation_8h.html" title="This file contains the declaration of class ChessNotation.">ChessNotation.h</a>&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="keyword">enum</span> mode_type {
<a name="l00045"></a>00045   mode_show_candidates,
<a name="l00046"></a>00046   mode_show_reachables,
<a name="l00047"></a>00047   mode_show_attacked,
<a name="l00048"></a>00048   mode_show_defendables,
<a name="l00049"></a>00049   mode_show_defended_black,
<a name="l00050"></a>00050   mode_show_defended_white,
<a name="l00051"></a>00051   mode_show_moves,
<a name="l00052"></a>00052   mode_popup_menu
<a name="l00053"></a>00053 };
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">// The chessboard.</span>
<a name="l00056"></a><a class="code" href="classMyChessboardWidget.html">00056</a> <span class="keyword">class </span><a class="code" href="classMyChessboardWidget.html">MyChessboardWidget</a> : <span class="keyword">public</span> cwmm::<a class="code" href="classcwmm_1_1ChessPositionWidget.html#aa751bed5c9ecc32aee9a68c3d443877c" title="Constructor.">ChessPositionWidget</a> {
<a name="l00057"></a>00057   <span class="keyword">private</span>:
<a name="l00058"></a>00058     gint M_arrow_begin_col;
<a name="l00059"></a>00059     gint M_arrow_begin_row;
<a name="l00060"></a>00060     <a class="code" href="classcwmm_1_1ChessboardWidget.html#add735276ea3b6550e639ac73b149d619" title="A color handle used for background markers.">ColorHandle</a> M_colors[10];
<a name="l00061"></a>00061     gpointer M_en_passant_arrow;
<a name="l00062"></a>00062     <a class="code" href="classcwchess_1_1Index.html" title="The index of a chess square.">cwchess::Index</a> M_en_passant_arrow_index;
<a name="l00063"></a>00063     mode_type M_mode;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065   <span class="keyword">protected</span>:
<a name="l00066"></a>00066     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classMyChessboardWidget.html#ada9611b429abf69a9850f17ae1671113" title="Draw the HUD layer.">draw_hud_layer</a>(cairo_t* cr, gint <a class="code" href="classcwmm_1_1ChessboardWidget.html#afcd6e5256e5808eab86a1ef04561b985" title="The side of a square in pixels.">sside</a>, guint hud);
<a name="l00067"></a>00067     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classMyChessboardWidget.html#a93cd99baca5c201951f9d4de3816d769" title="Called when a mouse button is pressed while the mouse is on the chessboard.">on_button_press</a>(gint col, gint row, GdkEventButton <span class="keyword">const</span>* event);
<a name="l00068"></a>00068     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classMyChessboardWidget.html#ae62b5614c52b315f8ed28adf66902ba9" title="Called when a mouse button is released.">on_button_release</a>(gint col, gint row, GdkEventButton <span class="keyword">const</span>* event);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070   <span class="keyword">public</span>:
<a name="l00071"></a>00071     <span class="keywordtype">void</span> on_menu_mode_editposition(<span class="keywordtype">void</span>)
<a name="l00072"></a>00072     {
<a name="l00073"></a>00073       <span class="keywordflow">if</span> (<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a8d81f1435a74cb83d462b8b42df178ca" title="Return the current widget mode.">get_widget_mode</a>() != <a class="code" href="classcwmm_1_1ChessPositionWidget.html#a4e152fe16b24a190620a357a8e8e2afc" title="The value used for the&amp; #39;Edit Position&amp;#39; mode.">mode_edit_position</a>)
<a name="l00074"></a>00074         <a class="code" href="classcwmm_1_1ChessPositionWidget.html#a3e2d45bf5443a4d7d2975c922a75e095" title="Set the widget mode.">set_widget_mode</a>(<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a4e152fe16b24a190620a357a8e8e2afc" title="The value used for the&amp; #39;Edit Position&amp;#39; mode.">mode_edit_position</a>);
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076     <span class="keywordtype">void</span> on_menu_mode_editgame(<span class="keywordtype">void</span>)
<a name="l00077"></a>00077     {
<a name="l00078"></a>00078       <span class="keywordflow">if</span> (<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a8d81f1435a74cb83d462b8b42df178ca" title="Return the current widget mode.">get_widget_mode</a>() != <a class="code" href="classcwmm_1_1ChessPositionWidget.html#a1122458ca51a499bd300af6434eea483" title="The value used for the&amp; #39;Edit Game&amp;#39; mode.">mode_edit_game</a>)
<a name="l00079"></a>00079         <a class="code" href="classcwmm_1_1ChessPositionWidget.html#a3e2d45bf5443a4d7d2975c922a75e095" title="Set the widget mode.">set_widget_mode</a>(<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a1122458ca51a499bd300af6434eea483" title="The value used for the&amp; #39;Edit Game&amp;#39; mode.">mode_edit_game</a>);
<a name="l00080"></a>00080     }
<a name="l00081"></a>00081     <span class="keywordtype">void</span> on_menu_mode_showcandidates(<span class="keywordtype">void</span>) { M_mode = mode_show_candidates; }
<a name="l00082"></a>00082     <span class="keywordtype">void</span> on_menu_mode_showreachables(<span class="keywordtype">void</span>) { M_mode = mode_show_reachables; }
<a name="l00083"></a>00083     <span class="keywordtype">void</span> on_menu_mode_showattacked(<span class="keywordtype">void</span>) { M_mode = mode_show_attacked; }
<a name="l00084"></a>00084     <span class="keywordtype">void</span> on_menu_mode_showdefendables(<span class="keywordtype">void</span>) { M_mode = mode_show_defendables; }
<a name="l00085"></a>00085     <span class="keywordtype">void</span> on_menu_mode_showdefended_black(<span class="keywordtype">void</span>) { M_mode = mode_show_defended_black; }
<a name="l00086"></a>00086     <span class="keywordtype">void</span> on_menu_mode_showdefended_white(<span class="keywordtype">void</span>) { M_mode = mode_show_defended_white; }
<a name="l00087"></a>00087     <span class="keywordtype">void</span> on_menu_mode_showmoves(<span class="keywordtype">void</span>) { M_mode = mode_show_moves; }
<a name="l00088"></a>00088     <span class="keywordtype">void</span> on_menu_mode_placepieces(<span class="keywordtype">void</span>) { M_mode = mode_popup_menu; }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="keywordtype">void</span> picked_up(<a class="code" href="classcwchess_1_1Index.html" title="The index of a chess square.">cwchess::Index</a> <span class="keyword">const</span>&amp; index, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; chess_position);
<a name="l00091"></a>00091     <span class="keywordtype">void</span> dropped(gint col, gint row, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; chess_position);
<a name="l00092"></a>00092     <span class="keywordtype">void</span> moved(<a class="code" href="classcwchess_1_1Move.html" title="A chess move in a particular chess position.">cwchess::Move</a> <span class="keyword">const</span>&amp; move, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; previous_position, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; current_position);
<a name="l00093"></a>00093     <span class="keywordtype">void</span> illegal(<a class="code" href="classcwchess_1_1Move.html" title="A chess move in a particular chess position.">cwchess::Move</a> <span class="keyword">const</span>&amp; move, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; chess_position);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095   <span class="keyword">public</span>:
<a name="l00096"></a>00096     <a class="code" href="classMyChessboardWidget.html">MyChessboardWidget</a>(Gtk::Window* drawable);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098   <span class="keyword">private</span>:
<a name="l00099"></a>00099     <span class="keywordtype">void</span> show_reachables(<span class="keywordtype">int</span> col, <span class="keywordtype">int</span> row, mode_type mode);
<a name="l00100"></a>00100     <span class="keywordtype">void</span> update_en_passant_arrow(<span class="keywordtype">void</span>);
<a name="l00101"></a>00101     <span class="keywordtype">void</span> show_pinning();
<a name="l00102"></a>00102 
<a name="l00103"></a>00103   <span class="keyword">private</span>:
<a name="l00104"></a>00104     <span class="keyword">enum</span> colors_t {
<a name="l00105"></a>00105       background = 0,
<a name="l00106"></a>00106       red,
<a name="l00107"></a>00107       green,
<a name="l00108"></a>00108       blue,
<a name="l00109"></a>00109       brown
<a name="l00110"></a>00110     };
<a name="l00111"></a>00111 
<a name="l00112"></a>00112   <span class="keyword">private</span>:
<a name="l00113"></a>00113     <span class="keywordtype">void</span> init_colors(<span class="keywordtype">void</span>);
<a name="l00114"></a>00114     <a class="code" href="classcwmm_1_1ChessboardWidget.html#add735276ea3b6550e639ac73b149d619" title="A color handle used for background markers.">ColorHandle</a> get_color_handle(<span class="keywordtype">int</span> index, colors_t color);
<a name="l00115"></a>00115 };
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 MyChessboardWidget::MyChessboardWidget(Gtk::Window* drawable) : cwmm::ChessPositionWidget(drawable), M_en_passant_arrow(NULL)
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119   init_colors();
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="structrgb__t.html">00122</a> <span class="keyword">struct </span><a class="code" href="structrgb__t.html">rgb_t</a> { gdouble red; gdouble green; gdouble blue; };
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <a class="code" href="structrgb__t.html">rgb_t</a> mix(<a class="code" href="structrgb__t.html">rgb_t</a> col1, gdouble alpha1, <a class="code" href="structrgb__t.html">rgb_t</a> col2, gdouble alpha2)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126   <a class="code" href="structrgb__t.html">rgb_t</a> result;
<a name="l00127"></a>00127   result.red = (col1.red * alpha1 + col2.red * alpha2) / sqrt(alpha1 * alpha1 + alpha2 * alpha2);
<a name="l00128"></a>00128   result.green = (col1.green * alpha1 + col2.green * alpha2) / sqrt(alpha1 * alpha1 + alpha2 * alpha2);
<a name="l00129"></a>00129   result.blue = (col1.blue * alpha1 + col2.blue * alpha2) / sqrt(alpha1 * alpha1 + alpha2 * alpha2);
<a name="l00130"></a>00130   <span class="keywordflow">return</span> result;
<a name="l00131"></a>00131 }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="keywordtype">void</span> MyChessboardWidget::init_colors(<span class="keywordtype">void</span>)
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135   gdouble alpha = 0.5;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137   <a class="code" href="structrgb__t.html">rgb_t</a> rgb_red = { 1.0, 0, 0 };
<a name="l00138"></a>00138   <a class="code" href="structrgb__t.html">rgb_t</a> rgb_green = { 0, 1.0, 0 };
<a name="l00139"></a>00139   <a class="code" href="structrgb__t.html">rgb_t</a> rgb_blue = { 0, 0, 1.0 };
<a name="l00140"></a>00140   <a class="code" href="structrgb__t.html">rgb_t</a> rgb_brown = { 1.0, 0, 1.0 };
<a name="l00141"></a>00141 
<a name="l00142"></a>00142   GdkColor dark_background;
<a name="l00143"></a>00143   GdkColor light_background;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145   <a class="code" href="classcwmm_1_1ChessboardWidget.html#a38d654d06bbb8b7b88fe75da3d32040e" title="Retrieve the current background color of the dark squares.">get_dark_square_color</a>(dark_background);
<a name="l00146"></a>00146   <a class="code" href="classcwmm_1_1ChessboardWidget.html#ad465c9f42225175f504016001c3a58a5" title="Retrieve the current background color of the light squares.">get_light_square_color</a>(light_background);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148   <a class="code" href="structrgb__t.html">rgb_t</a> rgb_background_dark = { dark_background.red / 65535.0, dark_background.green / 65535.0, dark_background.blue / 65535.0 };
<a name="l00149"></a>00149   <a class="code" href="structrgb__t.html">rgb_t</a> rgb_background_light = { light_background.red / 65535.0, light_background.green / 65535.0, light_background.blue / 65535.0 };
<a name="l00150"></a>00150 
<a name="l00151"></a>00151   <a class="code" href="structrgb__t.html">rgb_t</a> tmp;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153   <span class="keywordtype">int</span> <span class="keyword">const</span> dark = 0;
<a name="l00154"></a>00154   <span class="keywordtype">int</span> <span class="keyword">const</span> light = 1;
<a name="l00155"></a>00155   M_colors[2 * background + dark] = 0;
<a name="l00156"></a>00156   M_colors[2 * background + light] = 0;
<a name="l00157"></a>00157   tmp = mix(rgb_background_dark, 1.0, rgb_red, alpha);
<a name="l00158"></a>00158   M_colors[2 * red + dark] = <a class="code" href="classcwmm_1_1ChessboardWidget.html#aa36e17a101f030699c8fe9d5f6a7bba8" title="Allocate a new ColorHandle.">allocate_color_handle_rgb</a>(tmp.red, tmp.green, tmp.blue);
<a name="l00159"></a>00159   tmp = mix(rgb_background_light, 1.0, rgb_red, alpha);
<a name="l00160"></a>00160   M_colors[2 * red + light] = <a class="code" href="classcwmm_1_1ChessboardWidget.html#aa36e17a101f030699c8fe9d5f6a7bba8" title="Allocate a new ColorHandle.">allocate_color_handle_rgb</a>(tmp.red, tmp.green, tmp.blue);
<a name="l00161"></a>00161   tmp = mix(rgb_background_dark, 1.0, rgb_green, alpha);
<a name="l00162"></a>00162   M_colors[2 * green + dark] = <a class="code" href="classcwmm_1_1ChessboardWidget.html#aa36e17a101f030699c8fe9d5f6a7bba8" title="Allocate a new ColorHandle.">allocate_color_handle_rgb</a>(tmp.red, tmp.green, tmp.blue);
<a name="l00163"></a>00163   tmp = mix(rgb_background_light, 1.0, rgb_green, alpha);
<a name="l00164"></a>00164   M_colors[2 * green + light] = <a class="code" href="classcwmm_1_1ChessboardWidget.html#aa36e17a101f030699c8fe9d5f6a7bba8" title="Allocate a new ColorHandle.">allocate_color_handle_rgb</a>(tmp.red, tmp.green, tmp.blue);
<a name="l00165"></a>00165   tmp = mix(rgb_background_dark, 1.0, rgb_blue, alpha);
<a name="l00166"></a>00166   M_colors[2 * blue + dark] = <a class="code" href="classcwmm_1_1ChessboardWidget.html#aa36e17a101f030699c8fe9d5f6a7bba8" title="Allocate a new ColorHandle.">allocate_color_handle_rgb</a>(tmp.red, tmp.green, tmp.blue);
<a name="l00167"></a>00167   tmp = mix(rgb_background_light, 1.0, rgb_blue, alpha);
<a name="l00168"></a>00168   M_colors[2 * blue + light] = <a class="code" href="classcwmm_1_1ChessboardWidget.html#aa36e17a101f030699c8fe9d5f6a7bba8" title="Allocate a new ColorHandle.">allocate_color_handle_rgb</a>(tmp.red, tmp.green, tmp.blue);
<a name="l00169"></a>00169   tmp = mix(rgb_background_dark, 1.0, rgb_brown, alpha);
<a name="l00170"></a>00170   M_colors[2 * brown + dark] = <a class="code" href="classcwmm_1_1ChessboardWidget.html#aa36e17a101f030699c8fe9d5f6a7bba8" title="Allocate a new ColorHandle.">allocate_color_handle_rgb</a>(tmp.red, tmp.green, tmp.blue);
<a name="l00171"></a>00171   tmp = mix(rgb_background_light, 1.0, rgb_brown, alpha);
<a name="l00172"></a>00172   M_colors[2 * brown + light] = <a class="code" href="classcwmm_1_1ChessboardWidget.html#aa36e17a101f030699c8fe9d5f6a7bba8" title="Allocate a new ColorHandle.">allocate_color_handle_rgb</a>(tmp.red, tmp.green, tmp.blue);
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <a class="code" href="classcwmm_1_1ChessboardWidget.html#add735276ea3b6550e639ac73b149d619" title="A color handle used for background markers.">MyChessboardWidget::ColorHandle</a> MyChessboardWidget::get_color_handle(<span class="keywordtype">int</span> index, colors_t color)
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177   <span class="keywordtype">int</span> <span class="keyword">const</span> dark = 0;
<a name="l00178"></a>00178   <span class="keywordtype">int</span> <span class="keyword">const</span> light = 1;
<a name="l00179"></a>00179   <span class="keywordtype">int</span> offset = ((index &amp; 1) == ((index &gt;&gt; 3) &amp; 1)) ? dark : light;
<a name="l00180"></a>00180   <span class="keywordflow">return</span> M_colors[2 * color + offset];
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="keywordtype">void</span> MyChessboardWidget::show_pinning(<span class="keywordtype">void</span>)
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185   <span class="keyword">using namespace </span>cwchess;
<a name="l00186"></a>00186   BitBoard bb1 = attackers(<a class="code" href="namespacecwchess.html#a9edd86c3609c3393232c628d5b718c42" title="A constant representing the color black.">black</a>) | attackers(<a class="code" href="namespacecwchess.html#abfd6f16d8dad461f71e0458a668dd39c" title="A constant representing the color white.">white</a>);
<a name="l00187"></a>00187   BitBoard bb2 = pinned(<a class="code" href="namespacecwchess.html#a9edd86c3609c3393232c628d5b718c42" title="A constant representing the color black.">black</a>) | pinned(<a class="code" href="namespacecwchess.html#abfd6f16d8dad461f71e0458a668dd39c" title="A constant representing the color white.">white</a>);
<a name="l00188"></a>00188   <a class="code" href="classcwmm_1_1ChessboardWidget.html#add735276ea3b6550e639ac73b149d619" title="A color handle used for background markers.">ColorHandle</a> handles[64];
<a name="l00189"></a>00189   std::memset(handles, 0, <span class="keyword">sizeof</span>(handles));
<a name="l00190"></a>00190   <span class="keywordflow">for</span> (Index index = <a class="code" href="namespacecwchess.html#a5f575bff9af84d4cddda44acd6e6bf0d" title="A constant representing the&amp; #39;first&amp;#39; index.">index_begin</a>; index != <a class="code" href="namespacecwchess.html#aefccdeb9385ba2d999d518561465de66" title="A constant representing&amp; #39;one past the end&amp;#39;.">index_end</a>; ++index)
<a name="l00191"></a>00191     <span class="keywordflow">if</span> (bb1.test(index) &amp;&amp; !bb2.test(index))
<a name="l00192"></a>00192       handles[index()] = get_color_handle(index(), blue);
<a name="l00193"></a>00193     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bb2.test(index) &amp;&amp; !bb1.test(index))
<a name="l00194"></a>00194       handles[index()] = get_color_handle(index(), red);
<a name="l00195"></a>00195     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bb1.test(index) &amp;&amp; bb2.test(index))
<a name="l00196"></a>00196       handles[index()] = get_color_handle(index(), brown);
<a name="l00197"></a>00197   <a class="code" href="classcwmm_1_1ChessboardWidget.html#a82c5e6616ccec188c70fe405eecc29ef" title="Set new background colors of any number of squares.">set_background_colors</a>(handles);
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="keywordtype">void</span> MyChessboardWidget::show_reachables(<span class="keywordtype">int</span> col, <span class="keywordtype">int</span> row, mode_type mode)
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202   <span class="keyword">using namespace </span>cwchess;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204   Index index(col, row);
<a name="l00205"></a>00205   BitBoard bb;
<a name="l00206"></a>00206   <span class="keywordflow">switch</span> (mode)
<a name="l00207"></a>00207   {
<a name="l00208"></a>00208     <span class="keywordflow">case</span> mode_show_candidates:
<a name="l00209"></a>00209       bb = candidates(index);
<a name="l00210"></a>00210       Dout(dc::notice, <span class="stringliteral">&quot;candidates: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; bb() &lt;&lt; std::dec &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; bb);
<a name="l00211"></a>00211       <span class="keywordflow">break</span>;
<a name="l00212"></a>00212     <span class="keywordflow">case</span> mode_show_reachables:
<a name="l00213"></a>00213       bb = reachables(index);
<a name="l00214"></a>00214       Dout(dc::notice, <span class="stringliteral">&quot;reachables: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; bb() &lt;&lt; std::dec &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; bb);
<a name="l00215"></a>00215       <span class="keywordflow">break</span>;
<a name="l00216"></a>00216     <span class="keywordflow">case</span> mode_show_attacked:
<a name="l00217"></a>00217       bb = reachables(index, <span class="keyword">true</span>);
<a name="l00218"></a>00218       Dout(dc::notice, <span class="stringliteral">&quot;attacked reachables: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; bb() &lt;&lt; std::dec &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; bb);
<a name="l00219"></a>00219       <span class="keywordflow">break</span>;
<a name="l00220"></a>00220     <span class="keywordflow">case</span> mode_show_defendables:
<a name="l00221"></a>00221     {
<a name="l00222"></a>00222       <span class="keywordtype">bool</span> battery = <span class="keyword">false</span>;
<a name="l00223"></a>00223       bb = defendables(piece_at(index).code(), index, battery);
<a name="l00224"></a>00224       Dout(dc::notice, <span class="stringliteral">&quot;defendables: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; bb() &lt;&lt; std::dec &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; bb);
<a name="l00225"></a>00225       <span class="keywordflow">break</span>;
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227     <span class="keywordflow">case</span> mode_show_defended_black:
<a name="l00228"></a>00228     {
<a name="l00229"></a>00229       bb = get_defended()[<a class="code" href="namespacecwchess.html#a9edd86c3609c3393232c628d5b718c42" title="A constant representing the color black.">black</a>].any();
<a name="l00230"></a>00230       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 7; row &gt;= 0; --row)
<a name="l00231"></a>00231       {
<a name="l00232"></a>00232         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt;= 7; ++col)
<a name="l00233"></a>00233         {
<a name="l00234"></a>00234           Index i(col, row);
<a name="l00235"></a>00235           std::cout &lt;&lt; get_defended()[<a class="code" href="namespacecwchess.html#a9edd86c3609c3393232c628d5b718c42" title="A constant representing the color black.">black</a>].count(i) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237         std::cout &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00238"></a>00238       }
<a name="l00239"></a>00239       <span class="keywordflow">break</span>;
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241     <span class="keywordflow">case</span> mode_show_defended_white:
<a name="l00242"></a>00242     {
<a name="l00243"></a>00243       bb = get_defended()[<a class="code" href="namespacecwchess.html#abfd6f16d8dad461f71e0458a668dd39c" title="A constant representing the color white.">white</a>].any();
<a name="l00244"></a>00244       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 7; row &gt;= 0; --row)
<a name="l00245"></a>00245       {
<a name="l00246"></a>00246         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt;= 7; ++col)
<a name="l00247"></a>00247         {
<a name="l00248"></a>00248           Index i(col, row);
<a name="l00249"></a>00249           std::cout &lt;&lt; get_defended()[<a class="code" href="namespacecwchess.html#abfd6f16d8dad461f71e0458a668dd39c" title="A constant representing the color white.">white</a>].count(i) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00250"></a>00250         }
<a name="l00251"></a>00251         std::cout &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;
<a name="l00252"></a>00252       }
<a name="l00253"></a>00253       <span class="keywordflow">break</span>;
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255     <span class="keywordflow">default</span>:
<a name="l00256"></a>00256     {
<a name="l00257"></a>00257       <a class="code" href="classcwchess_1_1Color.html" title="A color (black or white).">cwchess::Color</a> color(to_move());
<a name="l00258"></a>00258       <a class="code" href="classcwchess_1_1Piece.html" title="A particular piece on the board.">cwchess::Piece</a> piece(piece_at(col, row));
<a name="l00259"></a>00259       <span class="keywordflow">if</span> (!piece.code().is_nothing())
<a name="l00260"></a>00260         to_move(piece.color());
<a name="l00261"></a>00261       bb = moves(index);
<a name="l00262"></a>00262       <span class="keywordflow">if</span> (get_widget_mode() == mode_edit_game)
<a name="l00263"></a>00263         to_move(color);
<a name="l00264"></a>00264       Dout(dc::notice, <span class="stringliteral">&quot;moves: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; bb() &lt;&lt; std::dec &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; bb);
<a name="l00265"></a>00265       <span class="keywordflow">break</span>;
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267   }
<a name="l00268"></a>00268   <span class="keywordflow">if</span> (mode != mode_show_defended_black &amp;&amp; mode != mode_show_defended_white)
<a name="l00269"></a>00269     disable_hud_layer(1);
<a name="l00270"></a>00270   ColorHandle handles[64];
<a name="l00271"></a>00271   std::memset(handles, 0, <span class="keyword">sizeof</span>(handles));
<a name="l00272"></a>00272   <span class="keywordflow">for</span> (Index index = <a class="code" href="namespacecwchess.html#a5f575bff9af84d4cddda44acd6e6bf0d" title="A constant representing the&amp; #39;first&amp;#39; index.">index_begin</a>; index != <a class="code" href="namespacecwchess.html#aefccdeb9385ba2d999d518561465de66" title="A constant representing&amp; #39;one past the end&amp;#39;.">index_end</a>; ++index)
<a name="l00273"></a>00273     <span class="keywordflow">if</span> (bb.test(index))
<a name="l00274"></a>00274       handles[index()] = get_color_handle(index(), red);
<a name="l00275"></a>00275   set_background_colors(handles);
<a name="l00276"></a>00276   update_en_passant_arrow();
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="keywordtype">void</span> MyChessboardWidget::update_en_passant_arrow(<span class="keywordtype">void</span>)
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281   <a class="code" href="classcwchess_1_1EnPassant.html" title="An object representing en passant information.">cwchess::EnPassant</a> <span class="keyword">const</span>&amp; en_passant(this-&gt;en_passant());
<a name="l00282"></a>00282   <span class="keywordflow">if</span> (en_passant.exists())
<a name="l00283"></a>00283   {
<a name="l00284"></a>00284     <span class="keywordflow">if</span> (M_en_passant_arrow_index != en_passant.index())
<a name="l00285"></a>00285     {
<a name="l00286"></a>00286       remove_arrow(M_en_passant_arrow);
<a name="l00287"></a>00287       M_en_passant_arrow = NULL;
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289     <span class="keywordflow">if</span> (!M_en_passant_arrow)
<a name="l00290"></a>00290     {
<a name="l00291"></a>00291       <a class="code" href="classcwchess_1_1Index.html" title="The index of a chess square.">cwchess::Index</a> from(en_passant.from_index());
<a name="l00292"></a>00292       <a class="code" href="classcwchess_1_1Index.html" title="The index of a chess square.">cwchess::Index</a> to(en_passant.pawn_index());
<a name="l00293"></a>00293       GdkColor color = { 0, 0, 65535, 65535 };
<a name="l00294"></a>00294       M_en_passant_arrow = add_arrow(from.col(), from.row(), to.col(), to.row(), color);
<a name="l00295"></a>00295       M_en_passant_arrow_index = en_passant.index();
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297   }
<a name="l00298"></a>00298   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (M_en_passant_arrow)
<a name="l00299"></a>00299   {
<a name="l00300"></a>00300     remove_arrow(M_en_passant_arrow);
<a name="l00301"></a>00301     M_en_passant_arrow = NULL;
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a><a class="code" href="classMyChessboardWidget.html#a93cd99baca5c201951f9d4de3816d769">00305</a> <span class="keywordtype">bool</span> <a class="code" href="classMyChessboardWidget.html#a93cd99baca5c201951f9d4de3816d769" title="Called when a mouse button is pressed while the mouse is on the chessboard.">MyChessboardWidget::on_button_press</a>(gint col, gint row, GdkEventButton <span class="keyword">const</span>* event)
<a name="l00306"></a>00306 {
<a name="l00307"></a>00307   <span class="comment">// Ignore double clicks.</span>
<a name="l00308"></a>00308   <span class="keywordflow">if</span> (event-&gt;type == GDK_2BUTTON_PRESS)
<a name="l00309"></a>00309     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00310"></a>00310   <span class="keywordflow">if</span> (event-&gt;button == 2)
<a name="l00311"></a>00311   {
<a name="l00312"></a>00312     <span class="comment">// Inside board?</span>
<a name="l00313"></a>00313     <span class="keywordflow">if</span> (col != -1)
<a name="l00314"></a>00314     {
<a name="l00315"></a>00315       <a class="code" href="classcwmm_1_1ChessboardWidget.html#ab53db82cf41a433ec4e0024aed30fa94" title="Show the cursor.">show_cursor</a>();
<a name="l00316"></a>00316       <span class="comment">// Marker the start square.</span>
<a name="l00317"></a>00317       <a class="code" href="classcwmm_1_1ChessboardWidget.html#ac715079290fed110beec0e64a29aeb1b" title="Change the color of the marker.">set_marker_color</a>(col, row, 1);
<a name="l00318"></a>00318       M_arrow_begin_col = col;
<a name="l00319"></a>00319       M_arrow_begin_row = row;
<a name="l00320"></a>00320     }
<a name="l00321"></a>00321   }
<a name="l00322"></a>00322   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;button == 3)
<a name="l00323"></a>00323   {
<a name="l00324"></a>00324     <span class="comment">// Inside board?</span>
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (col != -1)
<a name="l00326"></a>00326     {
<a name="l00327"></a>00327       <span class="keywordflow">switch</span> (M_mode)
<a name="l00328"></a>00328       {
<a name="l00329"></a>00329         <span class="keywordflow">case</span> mode_show_candidates:
<a name="l00330"></a>00330         <span class="keywordflow">case</span> mode_show_reachables:
<a name="l00331"></a>00331         <span class="keywordflow">case</span> mode_show_attacked:
<a name="l00332"></a>00332         <span class="keywordflow">case</span> mode_show_defendables:
<a name="l00333"></a>00333         <span class="keywordflow">case</span> mode_show_defended_black:
<a name="l00334"></a>00334         <span class="keywordflow">case</span> mode_show_defended_white:
<a name="l00335"></a>00335         <span class="keywordflow">case</span> mode_show_moves:
<a name="l00336"></a>00336           show_reachables(col, row, M_mode);
<a name="l00337"></a>00337           <a class="code" href="classcwmm_1_1ChessboardWidget.html#ab53db82cf41a433ec4e0024aed30fa94" title="Show the cursor.">show_cursor</a>();
<a name="l00338"></a>00338           <span class="keywordflow">return</span> <span class="keyword">true</span>;          <span class="comment">// Don&#39;t show the popup menu.</span>
<a name="l00339"></a>00339         <span class="keywordflow">case</span> mode_popup_menu:
<a name="l00340"></a>00340           <span class="comment">// The default of ChessPositionWidget already does this.</span>
<a name="l00341"></a>00341           <span class="keywordflow">break</span>;
<a name="l00342"></a>00342       }
<a name="l00343"></a>00343       <a class="code" href="classcwmm_1_1ChessboardWidget.html#ab53db82cf41a433ec4e0024aed30fa94" title="Show the cursor.">show_cursor</a>();
<a name="l00344"></a>00344     }
<a name="l00345"></a>00345   }
<a name="l00346"></a>00346   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event-&gt;button == 10)
<a name="l00347"></a>00347   {
<a name="l00348"></a>00348     <a class="code" href="classcwmm_1_1ChessboardWidget.html#ab6f38b39d1e18e76c68ab25c6946c20a" title="Active a HUD layer.">enable_hud_layer</a>(1);
<a name="l00349"></a>00349     show_reachables(0, 0, mode_show_defended_white);
<a name="l00350"></a>00350   }
<a name="l00351"></a>00351   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 
<a name="l00354"></a><a class="code" href="classMyChessboardWidget.html#ae62b5614c52b315f8ed28adf66902ba9">00354</a> <span class="keywordtype">bool</span> <a class="code" href="classMyChessboardWidget.html#ae62b5614c52b315f8ed28adf66902ba9" title="Called when a mouse button is released.">MyChessboardWidget::on_button_release</a>(gint col, gint row, GdkEventButton <span class="keyword">const</span>* event)
<a name="l00355"></a>00355 {
<a name="l00356"></a>00356   <a class="code" href="classcwmm_1_1ChessboardWidget.html#a9914cdeed588190fde06f13d537a6095" title="Hide the cursor.">hide_cursor</a>();
<a name="l00357"></a>00357   <span class="keywordflow">if</span> (event-&gt;button == 2)
<a name="l00358"></a>00358   {
<a name="l00359"></a>00359     GdkColor color = { 0, 0, 0, 65535 };
<a name="l00360"></a>00360     <span class="comment">// Clear the marker on the start square again.</span>
<a name="l00361"></a>00361     <a class="code" href="classcwmm_1_1ChessboardWidget.html#ac715079290fed110beec0e64a29aeb1b" title="Change the color of the marker.">set_marker_color</a>(M_arrow_begin_col, M_arrow_begin_row, 0);
<a name="l00362"></a>00362     <span class="comment">// Draw an arrow.</span>
<a name="l00363"></a>00363     <span class="keywordflow">if</span> ((M_arrow_begin_col != col || M_arrow_begin_row != row)&amp;&amp; 
<a name="l00364"></a>00364         <a class="code" href="classcwmm_1_1ChessboardWidget.html#ac0cb2d9590345cc7f8dbea955ca26a4a" title="Test if a given column and row are on the chessboard.">is_inside_board</a>(M_arrow_begin_col, M_arrow_begin_row)&amp;&amp; 
<a name="l00365"></a>00365         <a class="code" href="classcwmm_1_1ChessboardWidget.html#ac0cb2d9590345cc7f8dbea955ca26a4a" title="Test if a given column and row are on the chessboard.">is_inside_board</a>(col, row))
<a name="l00366"></a>00366       <a class="code" href="classcwmm_1_1ChessboardWidget.html#a60507d203a018843baa0fd0b8326e0ca" title="Draw an arrow on the board.">add_arrow</a>(M_arrow_begin_col, M_arrow_begin_row, col, row, color);
<a name="l00367"></a>00367   }
<a name="l00368"></a>00368   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00369"></a>00369 }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 <span class="keywordtype">void</span> MyChessboardWidget::moved(<a class="code" href="classcwchess_1_1Move.html" title="A chess move in a particular chess position.">cwchess::Move</a> <span class="keyword">const</span>&amp; move, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; previous_position, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; UNUSED(current_position))
<a name="l00372"></a>00372 {
<a name="l00373"></a>00373   DoutEntering(dc::notice, <span class="stringliteral">&quot;MyChessboardWidget::moved(&quot;</span> &lt;&lt; <a class="code" href="classcwchess_1_1ChessNotation.html" title="A helper class to write other objects to an ostream.">cwchess::ChessNotation</a>(previous_position, move) &lt;&lt; <span class="stringliteral">&quot;, ...)&quot;</span>);
<a name="l00374"></a>00374   <span class="comment">// Having executed a move, we might need to draw or erase the en passant arrow.</span>
<a name="l00375"></a>00375   update_en_passant_arrow();
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <span class="keywordtype">void</span> MyChessboardWidget::illegal(<a class="code" href="classcwchess_1_1Move.html" title="A chess move in a particular chess position.">cwchess::Move</a> <span class="keyword">const</span>&amp; move, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; UNUSED(chess_position))
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380   DoutEntering(dc::notice, <span class="stringliteral">&quot;MyChessboardWidget::illegal(&quot;</span> &lt;&lt; <a class="code" href="classcwchess_1_1ChessNotation.html" title="A helper class to write other objects to an ostream.">cwchess::ChessNotation</a>(*<span class="keyword">this</span>, move) &lt;&lt; <span class="stringliteral">&quot;, ...)&quot;</span>);
<a name="l00381"></a>00381 }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 <span class="keywordtype">void</span> MyChessboardWidget::picked_up(<a class="code" href="classcwchess_1_1Index.html" title="The index of a chess square.">cwchess::Index</a> <span class="keyword">const</span>&amp; index, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; UNUSED(chess_position))
<a name="l00384"></a>00384 {
<a name="l00385"></a>00385   DoutEntering(dc::notice, <span class="stringliteral">&quot;MyChessboardWidget::picked_up(&quot;</span> &lt;&lt; <a class="code" href="classcwchess_1_1ChessNotation.html" title="A helper class to write other objects to an ostream.">cwchess::ChessNotation</a>(*<span class="keyword">this</span>, index) &lt;&lt; <span class="stringliteral">&quot;, ...)&quot;</span>);
<a name="l00386"></a>00386   <span class="keywordflow">if</span> (<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a8d81f1435a74cb83d462b8b42df178ca" title="Return the current widget mode.">get_widget_mode</a>() == <a class="code" href="classcwmm_1_1ChessPositionWidget.html#a1122458ca51a499bd300af6434eea483" title="The value used for the&amp; #39;Edit Game&amp;#39; mode.">mode_edit_game</a>)
<a name="l00387"></a>00387   {
<a name="l00388"></a>00388     <span class="comment">// If we pick up a piece to do a move, show all legal moves and the cursor.</span>
<a name="l00389"></a>00389     show_reachables(index.<a class="code" href="classcwchess_1_1Index.html#aeeeece4a4238c83b806ea83a45db322c" title="Returns the column.">col</a>(), index.<a class="code" href="classcwchess_1_1Index.html#a7ea9520a22986f986f6e9dd818b8ad90" title="Returns the row.">row</a>(), mode_show_moves);
<a name="l00390"></a>00390     <a class="code" href="classcwmm_1_1ChessboardWidget.html#ab53db82cf41a433ec4e0024aed30fa94" title="Show the cursor.">show_cursor</a>();
<a name="l00391"></a>00391   }
<a name="l00392"></a>00392   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a8d81f1435a74cb83d462b8b42df178ca" title="Return the current widget mode.">get_widget_mode</a>() == <a class="code" href="classcwmm_1_1ChessPositionWidget.html#a4e152fe16b24a190620a357a8e8e2afc" title="The value used for the&amp; #39;Edit Position&amp;#39; mode.">mode_edit_position</a>)
<a name="l00393"></a>00393     <span class="comment">// In &#39;edit position&#39; mode, show the pinning information instead.</span>
<a name="l00394"></a>00394     show_pinning();
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="keywordtype">void</span> MyChessboardWidget::dropped(gint col, gint row, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; UNUSED(chess_position))
<a name="l00398"></a>00398 {
<a name="l00399"></a>00399   DoutEntering(dc::notice, <span class="stringliteral">&quot;MyChessboardWidget::dropped(&quot;</span> &lt;&lt; col &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; row &lt;&lt; <span class="stringliteral">&quot;, ...)&quot;</span>);
<a name="l00400"></a>00400   <span class="comment">// The piece that was picked up is dropped again. Return to regular standing.</span>
<a name="l00401"></a>00401   <a class="code" href="classcwmm_1_1ChessboardWidget.html#a9914cdeed588190fde06f13d537a6095" title="Hide the cursor.">hide_cursor</a>();
<a name="l00402"></a>00402   show_pinning();
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 
<a name="l00405"></a><a class="code" href="classMyChessboardWidget.html#ada9611b429abf69a9850f17ae1671113">00405</a> <span class="keywordtype">void</span> <a class="code" href="classMyChessboardWidget.html#ada9611b429abf69a9850f17ae1671113" title="Draw the HUD layer.">MyChessboardWidget::draw_hud_layer</a>(cairo_t* cr, gint sside, guint hud)
<a name="l00406"></a>00406 {
<a name="l00407"></a>00407   DoutEntering(dc::notice, <span class="stringliteral">&quot;draw_hud_layer(&quot;</span> &lt;&lt; cr &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; sside &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; hud &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);
<a name="l00408"></a>00408   cairo_text_extents_t extents;
<a name="l00409"></a>00409   cairo_select_font_face(cr, <span class="stringliteral">&quot;Sans&quot;</span>, CAIRO_FONT_SLANT_NORMAL, CAIRO_FONT_WEIGHT_NORMAL);
<a name="l00410"></a>00410   cairo_set_font_size(cr, 20);
<a name="l00411"></a>00411   cairo_text_extents(cr, <span class="stringliteral">&quot;3&quot;</span>,&amp; extents);
<a name="l00412"></a>00412   <span class="keywordtype">double</span> x, y;
<a name="l00413"></a>00413   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; 8; ++col)
<a name="l00414"></a>00414   {
<a name="l00415"></a>00415     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; 8; ++row)
<a name="l00416"></a>00416     {
<a name="l00417"></a>00417       <span class="keyword">static</span> <span class="keywordtype">char</span> <span class="keyword">const</span>* number[] = { <span class="stringliteral">&quot;0&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, <span class="stringliteral">&quot;2&quot;</span>, <span class="stringliteral">&quot;3&quot;</span>, <span class="stringliteral">&quot;4&quot;</span>, <span class="stringliteral">&quot;5&quot;</span>, <span class="stringliteral">&quot;6&quot;</span>, <span class="stringliteral">&quot;7&quot;</span>, <span class="stringliteral">&quot;8&quot;</span>, <span class="stringliteral">&quot;9&quot;</span> };
<a name="l00418"></a>00418       <a class="code" href="classcwchess_1_1Index.html" title="The index of a chess square.">cwchess::Index</a> i(col, row);
<a name="l00419"></a>00419       <span class="keywordtype">int</span> count = get_defended()[<a class="code" href="namespacecwchess.html#abfd6f16d8dad461f71e0458a668dd39c" title="A constant representing the color white.">cwchess::white</a>].count(i);
<a name="l00420"></a>00420       <span class="keywordtype">char</span> <span class="keyword">const</span>* utf8 = number[count % 10];
<a name="l00421"></a>00421       x = col * sside + 1;
<a name="l00422"></a>00422       y = (7 - row) * sside + extents.height + 2;
<a name="l00423"></a>00423       cairo_move_to(cr, x, y);
<a name="l00424"></a>00424       <span class="keywordflow">if</span> (count &gt; 9)
<a name="l00425"></a>00425         cairo_show_text(cr, number[1]);
<a name="l00426"></a>00426       cairo_show_text(cr, utf8);
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428   }
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 <span class="comment">// The main application.</span>
<a name="l00432"></a><a class="code" href="classGtkTest.html">00432</a> <span class="keyword">class </span><a class="code" href="classGtkTest.html">GtkTest</a> : <span class="keyword">public</span> Gtk::Window {
<a name="l00433"></a>00433   <span class="keyword">public</span>:
<a name="l00434"></a>00434     <a class="code" href="classGtkTest.html">GtkTest</a>(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height);
<a name="l00435"></a>00435     <span class="keyword">virtual</span> ~<a class="code" href="classGtkTest.html">GtkTest</a>() { }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <span class="comment">// Accessors for the chessboard widget.</span>
<a name="l00438"></a>00438     <a class="code" href="classMyChessboardWidget.html">MyChessboardWidget</a>&amp; chessboard_widget(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> m_chessboard_widget; }
<a name="l00439"></a>00439     <a class="code" href="classMyChessboardWidget.html">MyChessboardWidget</a> <span class="keyword">const</span>&amp; chessboard_widget(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_chessboard_widget; }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441   <span class="keyword">private</span>:
<a name="l00442"></a>00442     <span class="keywordtype">void</span> setup_menu(<span class="keywordtype">void</span>);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   <span class="keyword">protected</span>:
<a name="l00445"></a>00445     <span class="comment">//Signal handlers:</span>
<a name="l00446"></a>00446     <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_menu_file_quit();
<a name="l00447"></a>00447     <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_menu_file_open();
<a name="l00448"></a>00448     <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_menu_file_save();
<a name="l00449"></a>00449     <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_menu_file_new();
<a name="l00450"></a>00450     <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_menu_file_clear();
<a name="l00451"></a>00451     <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_menu_file_export();
<a name="l00452"></a>00452     <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_menu_file_undo();
<a name="l00453"></a>00453     <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_menu_file_flip();
<a name="l00454"></a>00454     <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_menu_mode_editposition(<span class="keywordtype">void</span>)
<a name="l00455"></a>00455     {
<a name="l00456"></a>00456       m_chessboard_widget.on_menu_mode_editposition();
<a name="l00457"></a>00457       <span class="keywordflow">if</span> (m_chessboard_widget.<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a8d81f1435a74cb83d462b8b42df178ca" title="Return the current widget mode.">get_widget_mode</a>() == <a class="code" href="classcwmm_1_1ChessPositionWidget.html#a1122458ca51a499bd300af6434eea483" title="The value used for the&amp; #39;Edit Game&amp;#39; mode.">cwmm::ChessPositionWidget::mode_edit_game</a>)
<a name="l00458"></a>00458         M_ModePlacePieces_action-&gt;set_active(<span class="keyword">true</span>);
<a name="l00459"></a>00459       m_chessboard_widget.<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a3e2d45bf5443a4d7d2975c922a75e095" title="Set the widget mode.">set_widget_mode</a>(<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a4e152fe16b24a190620a357a8e8e2afc" title="The value used for the&amp; #39;Edit Position&amp;#39; mode.">cwmm::ChessPositionWidget::mode_edit_position</a>);
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461     <span class="keyword">virtual</span> <span class="keywordtype">void</span> on_menu_mode_editgame(<span class="keywordtype">void</span>)
<a name="l00462"></a>00462     {
<a name="l00463"></a>00463       m_chessboard_widget.on_menu_mode_editgame();
<a name="l00464"></a>00464       m_chessboard_widget.<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a3e2d45bf5443a4d7d2975c922a75e095" title="Set the widget mode.">set_widget_mode</a>(<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a1122458ca51a499bd300af6434eea483" title="The value used for the&amp; #39;Edit Game&amp;#39; mode.">cwmm::ChessPositionWidget::mode_edit_game</a>);
<a name="l00465"></a>00465     }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     <span class="keywordtype">void</span> moved(<a class="code" href="classcwchess_1_1Move.html" title="A chess move in a particular chess position.">cwchess::Move</a> <span class="keyword">const</span>&amp; move, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; previous_position, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; current_position);
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     <span class="comment">//Member widgets:</span>
<a name="l00470"></a>00470     Gtk::VBox m_vbox;
<a name="l00471"></a>00471     <a class="code" href="classMyChessboardWidget.html">MyChessboardWidget</a> m_chessboard_widget;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     <span class="comment">// Menu and tool bar stuff.</span>
<a name="l00474"></a>00474     Glib::RefPtr&lt;Gtk::UIManager&gt; m_refUIManager;
<a name="l00475"></a>00475     Glib::RefPtr&lt;Gtk::ActionGroup&gt; m_refActionGroup;
<a name="l00476"></a>00476     Glib::RefPtr&lt;Gtk::RadioAction&gt; M_ModePlacePieces_action;
<a name="l00477"></a>00477     Glib::RefPtr&lt;Gtk::RadioAction&gt; M_ModeEditPosition_action;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     std::stack&lt;cwchess::ChessPosition&gt; M_history;
<a name="l00480"></a>00480 };
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 <span class="keywordtype">void</span> GtkTest::moved(<a class="code" href="classcwchess_1_1Move.html" title="A chess move in a particular chess position.">cwchess::Move</a> <span class="keyword">const</span>&amp; move, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; previous_position, <a class="code" href="classcwchess_1_1ChessPosition.html" title="A chess position.">cwchess::ChessPosition</a> <span class="keyword">const</span>&amp; UNUSED(current_position))
<a name="l00483"></a>00483 {
<a name="l00484"></a>00484   DoutEntering(dc::notice, <span class="stringliteral">&quot;GtkTest::moved(&quot;</span> &lt;&lt; <a class="code" href="classcwchess_1_1ChessNotation.html" title="A helper class to write other objects to an ostream.">cwchess::ChessNotation</a>(previous_position, move) &lt;&lt; <span class="stringliteral">&quot;, ...)&quot;</span>);
<a name="l00485"></a>00485   M_history.push(previous_position);
<a name="l00486"></a>00486 }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 GtkTest::GtkTest(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height) : m_vbox(FALSE, 0), m_chessboard_widget(this)
<a name="l00489"></a>00489 {
<a name="l00490"></a>00490   <span class="comment">// Set a title.</span>
<a name="l00491"></a>00491   set_title(<span class="stringliteral">&quot;ChessboardWidget Test&quot;</span>);
<a name="l00492"></a>00492 
<a name="l00493"></a>00493   <span class="comment">// Sets the border width of the window.</span>
<a name="l00494"></a>00494   set_border_width(10);
<a name="l00495"></a>00495 
<a name="l00496"></a>00496   <span class="comment">// Set a default width and height.</span>
<a name="l00497"></a>00497   set_default_size(width, height);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   <span class="comment">// A vbox to put a menu and chessboard in.</span>
<a name="l00500"></a>00500   add(m_vbox);
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   <span class="comment">// Set up the menu.</span>
<a name="l00503"></a>00503   setup_menu();
<a name="l00504"></a>00504 
<a name="l00505"></a>00505   <span class="comment">// Add the chessboard to m_vbox.</span>
<a name="l00506"></a>00506   m_vbox.add(m_chessboard_widget);
<a name="l00507"></a>00507 
<a name="l00508"></a>00508   <span class="comment">// Show everything.</span>
<a name="l00509"></a>00509   show_all_children(); 
<a name="l00510"></a>00510 
<a name="l00511"></a>00511   <span class="comment">// Record moves.</span>
<a name="l00512"></a>00512   m_chessboard_widget.<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a3f02e7ffb579cd3d8238cd1ac170750e" title="Return handler for events signaling that the user did a (legal) chess move.">signal_moved</a>().connect(sigc::mem_fun(<span class="keyword">this</span>,&amp; GtkTest::moved));
<a name="l00513"></a>00513 
<a name="l00514"></a>00514   <span class="comment">// Update en passant arrow.</span>
<a name="l00515"></a>00515   m_chessboard_widget.<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a3f02e7ffb579cd3d8238cd1ac170750e" title="Return handler for events signaling that the user did a (legal) chess move.">signal_moved</a>().connect(sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::moved));
<a name="l00516"></a>00516 
<a name="l00517"></a>00517   <span class="comment">// Just show that we can catch this event too.</span>
<a name="l00518"></a>00518   m_chessboard_widget.<a class="code" href="classcwmm_1_1ChessPositionWidget.html#adb880675dc6dc1b78e3dce810e899a1f" title="Return handler for events signaling that the user attempted an illegal move.">signal_illegal</a>().connect(sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::illegal));
<a name="l00519"></a>00519 
<a name="l00520"></a>00520   <span class="comment">// Show cursor, reachables and pinning as function of whether we picked up a piece or not.</span>
<a name="l00521"></a>00521   m_chessboard_widget.<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a3b50298a996a331a35b0430620a3c65c" title="Return handler for events signaling that the user picked up a piece.">signal_picked_up</a>().connect(sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::picked_up));
<a name="l00522"></a>00522   m_chessboard_widget.<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a98aa1d888ee00bf3117c905377e07573" title="Return handler for events signaling that the user dropped a piece.">signal_dropped</a>().connect(sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::dropped));
<a name="l00523"></a>00523 }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="keywordtype">void</span> GtkTest::on_menu_file_quit(<span class="keywordtype">void</span>)
<a name="l00526"></a>00526 {
<a name="l00527"></a>00527   hide();
<a name="l00528"></a>00528 }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530 <span class="keywordtype">void</span> GtkTest::on_menu_file_save(<span class="keywordtype">void</span>)
<a name="l00531"></a>00531 {
<a name="l00532"></a>00532   std::ofstream file;
<a name="l00533"></a>00533   file.open(<span class="stringliteral">&quot;FEN.out&quot;</span>);
<a name="l00534"></a>00534   file &lt;&lt; chessboard_widget().<a class="code" href="classcwchess_1_1ChessPosition.html#ae498d567bbec7c33d83de5c31a317291" title="Return the FEN code for this position.">FEN</a>() &lt;&lt; std::endl;
<a name="l00535"></a>00535   file.close();
<a name="l00536"></a>00536 }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 <span class="keywordtype">void</span> GtkTest::on_menu_file_undo(<span class="keywordtype">void</span>)
<a name="l00539"></a>00539 {
<a name="l00540"></a>00540   <span class="keywordflow">if</span> (M_history.empty())
<a name="l00541"></a>00541     <span class="keywordflow">return</span>;
<a name="l00542"></a>00542   chessboard_widget().<a class="code" href="classcwmm_1_1ChessPositionWidget.html#af29ed0f382e1906cb2a35fdb603155fb">set_position</a>(M_history.top());
<a name="l00543"></a>00543   M_history.pop();
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 <span class="keywordtype">void</span> GtkTest::on_menu_file_new(<span class="keywordtype">void</span>)
<a name="l00547"></a>00547 {
<a name="l00548"></a>00548   chessboard_widget().<a class="code" href="classcwmm_1_1ChessPositionWidget.html#a3f5b47ece541275933b9b52b9282d305" title="See cwchess::ChessPosition::initial_position.">initial_position</a>();
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 <span class="keywordtype">void</span> GtkTest::on_menu_file_clear(<span class="keywordtype">void</span>)
<a name="l00552"></a>00552 {
<a name="l00553"></a>00553   chessboard_widget().<a class="code" href="classcwmm_1_1ChessPositionWidget.html#afe88e2290b95531fc0047d07faf53054" title="See cwchess::ChessPosition::clear.">clear</a>();
<a name="l00554"></a>00554   Dout(dc::notice, <span class="stringliteral">&quot;Calling M_ModeEditPosition_action-&gt;set_active(true)&quot;</span>);
<a name="l00555"></a>00555   M_ModeEditPosition_action-&gt;set_active(<span class="keyword">true</span>); 
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="keywordtype">void</span> GtkTest::on_menu_file_flip(<span class="keywordtype">void</span>)
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560   chessboard_widget().<a class="code" href="classcwmm_1_1ChessboardWidget.html#a13281d21f402e707f715d39603fecc20" title="Set the boolean which determines whether white is playing bottom up or top down.">set_flip_board</a>(!chessboard_widget().get_flip_board());
<a name="l00561"></a>00561 }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 <span class="keywordtype">void</span> GtkTest::on_menu_file_export(<span class="keywordtype">void</span>)
<a name="l00564"></a>00564 {
<a name="l00565"></a>00565   <span class="keyword">using namespace </span>cwchess;
<a name="l00566"></a>00566   std::cout &lt;&lt; <span class="stringliteral">&quot;  chess_position.load_FEN(\&quot;&quot;</span> &lt;&lt; chessboard_widget().FEN() &lt;&lt; <span class="stringliteral">&quot;\&quot;);\n&quot;</span>;
<a name="l00567"></a>00567   std::cout &lt;&lt; <span class="stringliteral">&quot;  static mask_t moves1[] = {\n&quot;</span>;
<a name="l00568"></a>00568   <span class="keywordtype">int</span> color_count = 0;
<a name="l00569"></a>00569   <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;
<a name="l00570"></a>00570   <span class="keywordflow">for</span> (Color color(<a class="code" href="namespacecwchess.html#a9edd86c3609c3393232c628d5b718c42" title="A constant representing the color black.">black</a>); color_count &lt; 2; ++color_count, color = <a class="code" href="namespacecwchess.html#abfd6f16d8dad461f71e0458a668dd39c" title="A constant representing the color white.">white</a>)
<a name="l00571"></a>00571   {
<a name="l00572"></a>00572     <span class="keywordflow">for</span> (PieceIterator piece_iter = chessboard_widget().piece_begin(color); piece_iter != chessboard_widget().piece_end(); ++piece_iter)
<a name="l00573"></a>00573     {
<a name="l00574"></a>00574       <span class="keywordflow">if</span> (first)
<a name="l00575"></a>00575       {
<a name="l00576"></a>00576         std::cout &lt;&lt; <span class="stringliteral">&quot;    &quot;</span>;
<a name="l00577"></a>00577         first = <span class="keyword">false</span>;
<a name="l00578"></a>00578       }
<a name="l00579"></a>00579       <span class="keywordflow">else</span>
<a name="l00580"></a>00580         std::cout &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;
<a name="l00581"></a>00581       std::cout &lt;&lt; std::hex &lt;&lt; <span class="stringliteral">&quot;0x&quot;</span> &lt;&lt; chessboard_widget().moves(piece_iter.index())() &lt;&lt; std::dec;
<a name="l00582"></a>00582     }
<a name="l00583"></a>00583   }
<a name="l00584"></a>00584   std::cout &lt;&lt; <span class="stringliteral">&quot;\n  };&quot;</span> &lt;&lt; std::endl;
<a name="l00585"></a>00585 }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 <span class="keywordtype">void</span> GtkTest::on_menu_file_open(<span class="keywordtype">void</span>)
<a name="l00588"></a>00588 {
<a name="l00589"></a>00589   std::ifstream file;
<a name="l00590"></a>00590   file.open(<span class="stringliteral">&quot;FEN.out&quot;</span>);
<a name="l00591"></a>00591   std::string fen;
<a name="l00592"></a>00592   std::getline(file, fen);
<a name="l00593"></a>00593   file.close();
<a name="l00594"></a>00594   chessboard_widget().<a class="code" href="classcwmm_1_1ChessPositionWidget.html#ad56e76c857399889d5e0e175aae72503" title="See cwchess::ChessPosition::load_FEN.">load_FEN</a>(fen);
<a name="l00595"></a>00595 }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 <span class="keywordtype">void</span> GtkTest::setup_menu(<span class="keywordtype">void</span>)
<a name="l00598"></a>00598 {
<a name="l00599"></a>00599   <span class="comment">// Create the action group.</span>
<a name="l00600"></a>00600   m_refActionGroup = Gtk::ActionGroup::create();
<a name="l00601"></a>00601 
<a name="l00602"></a>00602   <span class="comment">// File menu:</span>
<a name="l00603"></a>00603   m_refActionGroup-&gt;add(Gtk::Action::create(<span class="stringliteral">&quot;FileMenu&quot;</span>, <span class="stringliteral">&quot;File&quot;</span>));
<a name="l00604"></a>00604   <span class="comment">// Add the QUIT action.</span>
<a name="l00605"></a>00605   m_refActionGroup-&gt;add(Gtk::Action::create(<span class="stringliteral">&quot;FileQuit&quot;</span>, Gtk::Stock::QUIT),
<a name="l00606"></a>00606       sigc::mem_fun(*<span class="keyword">this</span>,&amp; GtkTest::on_menu_file_quit));
<a name="l00607"></a>00607   <span class="comment">// Add the OPEN action.</span>
<a name="l00608"></a>00608   m_refActionGroup-&gt;add(Gtk::Action::create(<span class="stringliteral">&quot;FileOpen&quot;</span>, Gtk::Stock::OPEN, <span class="stringliteral">&quot;Load&quot;</span>, <span class="stringliteral">&quot;Load position from file FEN.out&quot;</span>),
<a name="l00609"></a>00609       sigc::mem_fun(*<span class="keyword">this</span>,&amp; GtkTest::on_menu_file_open));
<a name="l00610"></a>00610   <span class="comment">// Add the SAVE action.</span>
<a name="l00611"></a>00611   m_refActionGroup-&gt;add(Gtk::Action::create(<span class="stringliteral">&quot;FileSave&quot;</span>, Gtk::Stock::SAVE, <span class="stringliteral">&quot;Save&quot;</span>, <span class="stringliteral">&quot;Save position to file FEN.out&quot;</span>),
<a name="l00612"></a>00612       sigc::mem_fun(*<span class="keyword">this</span>,&amp; GtkTest::on_menu_file_save));
<a name="l00613"></a>00613   <span class="comment">// Add the CONVERT action.</span>
<a name="l00614"></a>00614   m_refActionGroup-&gt;add(Gtk::Action::create(<span class="stringliteral">&quot;FileConvert&quot;</span>, Gtk::Stock::CONVERT, <span class="stringliteral">&quot;Export&quot;</span>),
<a name="l00615"></a>00615       sigc::mem_fun(*<span class="keyword">this</span>,&amp; GtkTest::on_menu_file_export));
<a name="l00616"></a>00616   <span class="comment">// Add the CLEAR action.</span>
<a name="l00617"></a>00617   m_refActionGroup-&gt;add(Gtk::Action::create(<span class="stringliteral">&quot;FileClear&quot;</span>, Gtk::Stock::CLEAR, <span class="stringliteral">&quot;Clear&quot;</span>, <span class="stringliteral">&quot;Remove all pieces and switch to Mode &#39;Edit position&#39;.&quot;</span>),
<a name="l00618"></a>00618       sigc::mem_fun(*<span class="keyword">this</span>,&amp; GtkTest::on_menu_file_clear));
<a name="l00619"></a>00619   <span class="comment">// Add the NEW action.</span>
<a name="l00620"></a>00620   m_refActionGroup-&gt;add(Gtk::Action::create(<span class="stringliteral">&quot;FileNew&quot;</span>, Gtk::Stock::NEW, <span class="stringliteral">&quot;New&quot;</span>, <span class="stringliteral">&quot;Set up initial position.&quot;</span>),
<a name="l00621"></a>00621       sigc::mem_fun(*<span class="keyword">this</span>,&amp; GtkTest::on_menu_file_new));
<a name="l00622"></a>00622   <span class="comment">// Add the UNDO action.</span>
<a name="l00623"></a>00623   m_refActionGroup-&gt;add(Gtk::Action::create(<span class="stringliteral">&quot;FileUndo&quot;</span>, Gtk::Stock::UNDO, <span class="stringliteral">&quot;Undo&quot;</span>),
<a name="l00624"></a>00624       sigc::mem_fun(*<span class="keyword">this</span>,&amp; GtkTest::on_menu_file_undo));
<a name="l00625"></a>00625   <span class="comment">// Add the FLIP action.</span>
<a name="l00626"></a>00626   m_refActionGroup-&gt;add(Gtk::Action::create(<span class="stringliteral">&quot;FileFlip&quot;</span>, Gtk::Stock::REFRESH, <span class="stringliteral">&quot;Flip&quot;</span>),
<a name="l00627"></a>00627       sigc::mem_fun(*<span class="keyword">this</span>,&amp; GtkTest::on_menu_file_flip));
<a name="l00628"></a>00628 
<a name="l00629"></a>00629   <span class="comment">// Mode menu:</span>
<a name="l00630"></a>00630   m_refActionGroup-&gt;add(Gtk::Action::create(<span class="stringliteral">&quot;ModeMenu&quot;</span>, <span class="stringliteral">&quot;Mode&quot;</span>));
<a name="l00631"></a>00631   Gtk::RadioAction::Group group_widget_mode;
<a name="l00632"></a>00632   Gtk::RadioAction::Group group_rightclick_mode;
<a name="l00633"></a>00633   <span class="comment">// Add SET UP POSITION action.</span>
<a name="l00634"></a>00634   M_ModeEditPosition_action = Gtk::RadioAction::create(group_widget_mode, <span class="stringliteral">&quot;ModeEditPosition&quot;</span>, <span class="stringliteral">&quot;Edit position&quot;</span>);
<a name="l00635"></a>00635   m_refActionGroup-&gt;add(M_ModeEditPosition_action, sigc::mem_fun(*<span class="keyword">this</span>,&amp; GtkTest::on_menu_mode_editposition));
<a name="l00636"></a>00636   <span class="comment">// Add EDIT GAME action.</span>
<a name="l00637"></a>00637   Glib::RefPtr&lt;Gtk::RadioAction&gt; ModeEditGame_action(Gtk::RadioAction::create(group_widget_mode, <span class="stringliteral">&quot;ModeEditGame&quot;</span>, <span class="stringliteral">&quot;Edit game&quot;</span>));
<a name="l00638"></a>00638   m_refActionGroup-&gt;add(ModeEditGame_action, sigc::mem_fun(*<span class="keyword">this</span>,&amp; GtkTest::on_menu_mode_editgame));
<a name="l00639"></a>00639   <span class="comment">// Add the SHOW CANDIDATES action.</span>
<a name="l00640"></a>00640   m_refActionGroup-&gt;add(Gtk::RadioAction::create(group_rightclick_mode, <span class="stringliteral">&quot;ModeShowCandidates&quot;</span>, <span class="stringliteral">&quot;Show candidates&quot;</span>),
<a name="l00641"></a>00641       sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::on_menu_mode_showcandidates));
<a name="l00642"></a>00642   <span class="comment">// Add the SHOW REACHABLES action.</span>
<a name="l00643"></a>00643   m_refActionGroup-&gt;add(Gtk::RadioAction::create(group_rightclick_mode, <span class="stringliteral">&quot;ModeShowReachables&quot;</span>, <span class="stringliteral">&quot;Show reachables&quot;</span>),
<a name="l00644"></a>00644       sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::on_menu_mode_showreachables));
<a name="l00645"></a>00645   <span class="comment">// Add the SHOW ATTACKED action.</span>
<a name="l00646"></a>00646   m_refActionGroup-&gt;add(Gtk::RadioAction::create(group_rightclick_mode, <span class="stringliteral">&quot;ModeShowAttacked&quot;</span>, <span class="stringliteral">&quot;Show attacked&quot;</span>),
<a name="l00647"></a>00647       sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::on_menu_mode_showattacked));
<a name="l00648"></a>00648   <span class="comment">// Add the SHOW DEFENDABLES action.</span>
<a name="l00649"></a>00649   m_refActionGroup-&gt;add(Gtk::RadioAction::create(group_rightclick_mode, <span class="stringliteral">&quot;ModeShowDefendables&quot;</span>, <span class="stringliteral">&quot;Show defendables&quot;</span>),
<a name="l00650"></a>00650       sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::on_menu_mode_showdefendables));
<a name="l00651"></a>00651   <span class="comment">// Add the SHOW DEFENDED BLACK action.</span>
<a name="l00652"></a>00652   m_refActionGroup-&gt;add(Gtk::RadioAction::create(group_rightclick_mode, <span class="stringliteral">&quot;ModeShowDefendedBlack&quot;</span>, <span class="stringliteral">&quot;Show defended by black&quot;</span>),
<a name="l00653"></a>00653       sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::on_menu_mode_showdefended_black));
<a name="l00654"></a>00654   <span class="comment">// Add the SHOW DEFENDED WHITE action.</span>
<a name="l00655"></a>00655   m_refActionGroup-&gt;add(Gtk::RadioAction::create(group_rightclick_mode, <span class="stringliteral">&quot;ModeShowDefendedWhite&quot;</span>, <span class="stringliteral">&quot;Show defended by white&quot;</span>),
<a name="l00656"></a>00656       sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::on_menu_mode_showdefended_white));
<a name="l00657"></a>00657   <span class="comment">// Add the SHOW MOVES action.</span>
<a name="l00658"></a>00658   Glib::RefPtr&lt;Gtk::RadioAction&gt; ModeShowMoves_action(Gtk::RadioAction::create(group_rightclick_mode, <span class="stringliteral">&quot;ModeShowMoves&quot;</span>, <span class="stringliteral">&quot;Show moves&quot;</span>));
<a name="l00659"></a>00659   m_refActionGroup-&gt;add(ModeShowMoves_action, sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::on_menu_mode_showmoves));
<a name="l00660"></a>00660   <span class="comment">// Add the PLACE PIECES action.</span>
<a name="l00661"></a>00661   M_ModePlacePieces_action = Gtk::RadioAction::create(group_rightclick_mode, <span class="stringliteral">&quot;ModePlacePieces&quot;</span>, <span class="stringliteral">&quot;Place pieces&quot;</span>);
<a name="l00662"></a>00662   m_refActionGroup-&gt;add(M_ModePlacePieces_action, sigc::mem_fun(m_chessboard_widget,&amp; MyChessboardWidget::on_menu_mode_placepieces));
<a name="l00663"></a>00663 
<a name="l00664"></a>00664   <span class="comment">// Default.</span>
<a name="l00665"></a>00665 <span class="preprocessor">#if 1</span>
<a name="l00666"></a>00666 <span class="preprocessor"></span>  Dout(dc::notice, <span class="stringliteral">&quot;Calling ModeEditGame_action-&gt;set_active(true)&quot;</span>);
<a name="l00667"></a>00667   ModeEditGame_action-&gt;set_active(<span class="keyword">true</span>);
<a name="l00668"></a>00668   Dout(dc::notice, <span class="stringliteral">&quot;Calling ModeShowMoves_action-&gt;set_active(true)&quot;</span>);
<a name="l00669"></a>00669   ModeShowMoves_action-&gt;set_active(<span class="keyword">true</span>);
<a name="l00670"></a>00670 <span class="preprocessor">#else</span>
<a name="l00671"></a>00671 <span class="preprocessor"></span>  Dout(dc::notice, <span class="stringliteral">&quot;Calling M_ModeEditPosition_action-&gt;set_active(true)&quot;</span>);
<a name="l00672"></a>00672   M_ModeEditPosition_action-&gt;set_active(<span class="keyword">true</span>); 
<a name="l00673"></a>00673   Dout(dc::notice, <span class="stringliteral">&quot;Calling M_ModePlacePieces_action-&gt;set_active(true)&quot;</span>);
<a name="l00674"></a>00674   M_ModePlacePieces_action-&gt;set_active(<span class="keyword">true</span>);
<a name="l00675"></a>00675 <span class="preprocessor">#endif</span>
<a name="l00676"></a>00676 <span class="preprocessor"></span>
<a name="l00677"></a>00677   <span class="comment">// Create a UIManager and add the ActionGroup to the UIManager.</span>
<a name="l00678"></a>00678   m_refUIManager = Gtk::UIManager::create();
<a name="l00679"></a>00679   m_refUIManager-&gt;insert_action_group(m_refActionGroup);
<a name="l00680"></a>00680 
<a name="l00681"></a>00681   <span class="comment">// Tell the parent window to respond to the specified keyboard shortcuts.</span>
<a name="l00682"></a>00682   add_accel_group(m_refUIManager-&gt;get_accel_group());
<a name="l00683"></a>00683 
<a name="l00684"></a>00684   <span class="comment">// Layout the actions in a menubar and toolbar.</span>
<a name="l00685"></a>00685   Glib::ustring ui_info = 
<a name="l00686"></a>00686         <span class="stringliteral">&quot;&lt;ui&gt;&quot;</span>
<a name="l00687"></a>00687         <span class="stringliteral">&quot;  &lt;menubar name=&#39;MenuBar&#39;&gt;&quot;</span>
<a name="l00688"></a>00688         <span class="stringliteral">&quot;    &lt;menu action=&#39;FileMenu&#39;&gt;&quot;</span>
<a name="l00689"></a>00689         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;FileOpen&#39;/&gt;&quot;</span>
<a name="l00690"></a>00690         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;FileSave&#39;/&gt;&quot;</span>
<a name="l00691"></a>00691         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;FileQuit&#39;/&gt;&quot;</span>
<a name="l00692"></a>00692         <span class="stringliteral">&quot;    &lt;/menu&gt;&quot;</span>
<a name="l00693"></a>00693         <span class="stringliteral">&quot;    &lt;menu action=&#39;ModeMenu&#39;&gt;&quot;</span>
<a name="l00694"></a>00694         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;ModeEditPosition&#39;/&gt;&quot;</span>
<a name="l00695"></a>00695         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;ModeEditGame&#39;/&gt;&quot;</span>
<a name="l00696"></a>00696         <span class="stringliteral">&quot;      &lt;separator/&gt;&quot;</span>
<a name="l00697"></a>00697         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;ModeShowCandidates&#39;/&gt;&quot;</span>
<a name="l00698"></a>00698         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;ModeShowReachables&#39;/&gt;&quot;</span>
<a name="l00699"></a>00699         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;ModeShowAttacked&#39;/&gt;&quot;</span>
<a name="l00700"></a>00700         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;ModeShowDefendables&#39;/&gt;&quot;</span>
<a name="l00701"></a>00701         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;ModeShowDefendedBlack&#39;/&gt;&quot;</span>
<a name="l00702"></a>00702         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;ModeShowDefendedWhite&#39;/&gt;&quot;</span>
<a name="l00703"></a>00703         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;ModeShowMoves&#39;/&gt;&quot;</span>
<a name="l00704"></a>00704         <span class="stringliteral">&quot;      &lt;menuitem action=&#39;ModePlacePieces&#39;/&gt;&quot;</span>
<a name="l00705"></a>00705         <span class="stringliteral">&quot;    &lt;/menu&gt;&quot;</span>
<a name="l00706"></a>00706         <span class="stringliteral">&quot;  &lt;/menubar&gt;&quot;</span>
<a name="l00707"></a>00707         <span class="stringliteral">&quot;  &lt;toolbar  name=&#39;ToolBar&#39;&gt;&quot;</span>
<a name="l00708"></a>00708         <span class="stringliteral">&quot;    &lt;toolitem action=&#39;FileQuit&#39;/&gt;&quot;</span>
<a name="l00709"></a>00709         <span class="stringliteral">&quot;    &lt;toolitem action=&#39;FileOpen&#39;/&gt;&quot;</span>
<a name="l00710"></a>00710         <span class="stringliteral">&quot;    &lt;toolitem action=&#39;FileSave&#39;/&gt;&quot;</span>
<a name="l00711"></a>00711         <span class="stringliteral">&quot;    &lt;toolitem action=&#39;FileNew&#39;/&gt;&quot;</span>
<a name="l00712"></a>00712         <span class="stringliteral">&quot;    &lt;toolitem action=&#39;FileClear&#39;/&gt;&quot;</span>
<a name="l00713"></a>00713         <span class="stringliteral">&quot;    &lt;toolitem action=&#39;FileConvert&#39;/&gt;&quot;</span>
<a name="l00714"></a>00714         <span class="stringliteral">&quot;    &lt;toolitem action=&#39;FileUndo&#39;/&gt;&quot;</span>
<a name="l00715"></a>00715         <span class="stringliteral">&quot;    &lt;toolitem action=&#39;FileFlip&#39;/&gt;&quot;</span>
<a name="l00716"></a>00716         <span class="stringliteral">&quot;  &lt;/toolbar&gt;&quot;</span>
<a name="l00717"></a>00717         <span class="stringliteral">&quot;&lt;/ui&gt;&quot;</span>;
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 <span class="preprocessor">#ifdef GLIBMM_EXCEPTIONS_ENABLED</span>
<a name="l00720"></a>00720 <span class="preprocessor"></span>  <span class="keywordflow">try</span>
<a name="l00721"></a>00721   {
<a name="l00722"></a>00722     m_refUIManager-&gt;add_ui_from_string(ui_info);
<a name="l00723"></a>00723   }
<a name="l00724"></a>00724   <span class="keywordflow">catch</span>(<span class="keyword">const</span> Glib::Error&amp; ex)
<a name="l00725"></a>00725   {
<a name="l00726"></a>00726     std::cerr &lt;&lt; <span class="stringliteral">&quot;building menus failed: &quot;</span> &lt;&lt;  ex.what();
<a name="l00727"></a>00727   }
<a name="l00728"></a>00728 <span class="preprocessor">#else</span>
<a name="l00729"></a>00729 <span class="preprocessor"></span>  std::auto_ptr&lt;Glib::Error&gt; ex;
<a name="l00730"></a>00730   m_refUIManager-&gt;add_ui_from_string(ui_info, ex);
<a name="l00731"></a>00731   <span class="keywordflow">if</span>(ex.get())
<a name="l00732"></a>00732   {
<a name="l00733"></a>00733     std::cerr &lt;&lt; <span class="stringliteral">&quot;building menus failed: &quot;</span> &lt;&lt;  ex-&gt;what();
<a name="l00734"></a>00734   }
<a name="l00735"></a>00735 <span class="preprocessor">#endif // GLIBMM_EXCEPTIONS_ENABLED</span>
<a name="l00736"></a>00736 <span class="preprocessor"></span>
<a name="l00737"></a>00737   <span class="comment">// Get the menubar and toolbar widgets, and add them to a container widget.</span>
<a name="l00738"></a>00738   Gtk::Widget* pMenubar = m_refUIManager-&gt;get_widget(<span class="stringliteral">&quot;/MenuBar&quot;</span>);
<a name="l00739"></a>00739   <span class="keywordflow">if</span>(pMenubar)
<a name="l00740"></a>00740     m_vbox.pack_start(*pMenubar, Gtk::PACK_SHRINK);
<a name="l00741"></a>00741 
<a name="l00742"></a>00742   Gtk::Widget* pToolbar = m_refUIManager-&gt;get_widget(<span class="stringliteral">&quot;/ToolBar&quot;</span>) ;
<a name="l00743"></a>00743   <span class="keywordflow">if</span>(pToolbar)
<a name="l00744"></a>00744     m_vbox.pack_start(*pToolbar, Gtk::PACK_SHRINK);
<a name="l00745"></a>00745 }
<a name="l00746"></a>00746 
<a name="l00747"></a>00747 <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])
<a name="l00748"></a>00748 {
<a name="l00749"></a>00749   <span class="keyword">using namespace </span>cwchess;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751   Debug(debug::init());
<a name="l00752"></a>00752   Dout(dc::notice, <span class="stringliteral">&quot;Entered main()&quot;</span>);
<a name="l00753"></a>00753 
<a name="l00754"></a>00754   Gtk::Main kit(argc, argv);
<a name="l00755"></a>00755 
<a name="l00756"></a>00756   <span class="comment">// Create the application window, passing a default size.</span>
<a name="l00757"></a>00757   <a class="code" href="classGtkTest.html">GtkTest</a> application(500, 532);
<a name="l00758"></a>00758 
<a name="l00759"></a>00759   <span class="comment">// Get a reference to the chessboard widget.</span>
<a name="l00760"></a>00760   <a class="code" href="classMyChessboardWidget.html">MyChessboardWidget</a>&amp; chessboard_widget(application.chessboard_widget());
<a name="l00761"></a>00761 
<a name="l00762"></a>00762   ChessPosition chess_position;
<a name="l00763"></a>00763   <span class="comment">//chess_position.initial_position();</span>
<a name="l00764"></a>00764   chess_position.load_FEN(<span class="stringliteral">&quot;rnbqkbnr/4p1pp/1p6/p1p1PpP1/1P1p4/2P5/P2P1P1P/RNBQKBNR w KQkq f6 0 7&quot;</span>);
<a name="l00765"></a>00765 <span class="preprocessor">#if 0</span>
<a name="l00766"></a>00766 <span class="preprocessor"></span>  std::ifstream file;
<a name="l00767"></a>00767   file.open(<span class="stringliteral">&quot;FEN.out&quot;</span>);
<a name="l00768"></a>00768   std::string fen;
<a name="l00769"></a>00769   std::getline(file, fen);
<a name="l00770"></a>00770   file.close();
<a name="l00771"></a>00771   chess_position.load_FEN(fen);
<a name="l00772"></a>00772 <span class="preprocessor">#endif</span>
<a name="l00773"></a>00773 <span class="preprocessor"></span>  <span class="comment">//chess_position.swap_colors();</span>
<a name="l00774"></a>00774 
<a name="l00775"></a>00775   chessboard_widget.set_position(chess_position);
<a name="l00776"></a>00776 
<a name="l00777"></a>00777   <span class="comment">// Set the border color.</span>
<a name="l00778"></a>00778   uint32_t border_color_html = 0x597359;
<a name="l00779"></a>00779   GdkColor brown = { 0, (border_color_html &amp; 0xff0000) &gt;&gt; 8, (border_color_html &amp; 0xff00), (border_color_html &amp; 0xff) &lt;&lt; 8 };
<a name="l00780"></a>00780   chessboard_widget.set_border_color(brown);
<a name="l00781"></a>00781 
<a name="l00782"></a>00782   <span class="comment">//open_gdb = true;</span>
<a name="l00783"></a>00783   Gtk::Main::run(application);
<a name="l00784"></a>00784 
<a name="l00785"></a>00785   <span class="keywordflow">return</span> 0;
<a name="l00786"></a>00786 }
</pre></div></div>
</div>
<hr>

<address>Copyright &copy; 2006 - 2010 Carlo Wood.&nbsp; All rights reserved.</address>

</div>
</body>
</html>

