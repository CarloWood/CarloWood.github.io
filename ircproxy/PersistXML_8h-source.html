<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML LANG="en-us">
 
<HEAD>
<META name="Author" content="Carlo Wood">
<META name="description" content="IRC proxy">
<META name="keywords" content="IRC, proxy, bnc, security, protection">
<META http-equiv="content-type" content="text/html; charset=iso-8859-1">
<TITLE>ircproxy documentation</TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
<LINK HREF="main.css" REL="stylesheet" TYPE="text/css">
</HEAD>

<BODY>

<TABLE class="header" BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR>
<TD WIDTH=120><IMG SRC="images/ircproxy.png" BORDER=0></TD>
<TD VALIGN=center ALIGN=center BGCOLOR="#0A0607"><FONT size=+4 color="#ffffff"><B>&nbsp;ircproxy</B>&nbsp;</FONT>
<FONT size=+3 color="#ffffff">The&nbsp;Ultimate&nbsp;Cyborg</FONT></TD>
</TR>
</TABLE>

<DIV class="normal">
<hr>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>PersistXML.h</h1><a href="PersistXML_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// ircproxy -- An IRC bouncer.</span>
<a name="l00002"></a>00002 <span class="comment">//</span><span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">//! @file PersistXML.h</span>
<a name="l00004"></a>00004 <span class="comment">//! @brief This file contains the declaration of class PersistXML.</span>
<a name="l00005"></a>00005 <span class="comment"></span><span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// Copyright (C) 2006, 2007 by</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// Carlo Wood, Run on IRC &lt;carlo@alinoe.com&gt;</span>
<a name="l00009"></a>00009 <span class="comment">// RSA-1024 0x624ACAD5 1997-01-26                    Sign &amp; Encrypt</span>
<a name="l00010"></a>00010 <span class="comment">// Fingerprint16 = 32 EC A7 B6 AC DB 65 A6  F6 F6 55 DD 1C DC FF 61</span>
<a name="l00011"></a>00011 <span class="comment">//</span>
<a name="l00012"></a>00012 <span class="comment">// This file may be distributed under the terms of the Q Public License</span>
<a name="l00013"></a>00013 <span class="comment">// version 1.0 as appearing in the file LICENSE.QPL included in the</span>
<a name="l00014"></a>00014 <span class="comment">// packaging of this file.</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#ifndef PERSISTXML_H</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#define PERSISTXML_H</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span>
<a name="l00019"></a>00019 <span class="preprocessor">#ifndef USE_PCH</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;list&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;stack&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;libxml/parser.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;boost/shared_ptr.hpp&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;boost/optional/optional.hpp&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include "<a class="code" href="debug_8h.html" title="This file contains the declaration of debug related macros, objects and functions...">debug.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">#endif</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033 <span class="preprocessor">#include "<a class="code" href="exceptions_8h.html" title="This file contains the declaration of exception related classes and (debug) macros...">exceptions.h</a>"</span>
<a name="l00034"></a>00034 <span class="comment"></span>
<a name="l00035"></a>00035 <span class="comment">/*! @brief Exception class used to signal an invalid XML label.</span>
<a name="l00036"></a>00036 <span class="comment"> *</span>
<a name="l00037"></a>00037 <span class="comment"> * This exception is thrown by PersistXML::serialize when the</span>
<a name="l00038"></a>00038 <span class="comment"> * requested label is invalid.</span>
<a name="l00039"></a>00039 <span class="comment"> */</span>
<a name="l00040"></a><a class="code" href="classxml__invalid__label.html">00040</a> <span class="keyword">class </span><a class="code" href="classxml__invalid__label.html" title="Exception class used to signal an invalid XML label.">xml_invalid_label</a> : <span class="keyword">public</span> <span class="keyword">virtual</span> std::invalid_argument {
<a name="l00041"></a>00041 <span class="keyword">public</span>:<span class="comment"></span>
<a name="l00042"></a>00042 <span class="comment">  //! Constructor.</span>
<a name="l00043"></a><a class="code" href="classxml__invalid__label.html#8f0b2c2de38bb7731c2ba002c43779de">00043</a> <span class="comment"></span>  <a class="code" href="classxml__invalid__label.html#8f0b2c2de38bb7731c2ba002c43779de" title="Constructor.">xml_invalid_label</a>(std::string <span class="keyword">const</span>&amp; label) : std::invalid_argument(<span class="stringliteral">"Invalid XML label: \""</span> + label + <span class="stringliteral">"\"."</span>) { }<span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment">  //! Destructor.</span>
<a name="l00045"></a><a class="code" href="classxml__invalid__label.html#960b86f75c2e02f77a5917490743fd52">00045</a> <span class="comment"></span>  <span class="keyword">virtual</span> <a class="code" href="classxml__invalid__label.html#960b86f75c2e02f77a5917490743fd52" title="Destructor.">~xml_invalid_label</a>() throw() { }
<a name="l00046"></a>00046 };
<a name="l00047"></a>00047 <span class="comment"></span>
<a name="l00048"></a>00048 <span class="comment">/*! @brief Exception class used to signal a failure in parsing an XML document.</span>
<a name="l00049"></a>00049 <span class="comment"> *</span>
<a name="l00050"></a>00050 <span class="comment"> */</span>
<a name="l00051"></a><a class="code" href="classxml__parse__error.html">00051</a> <span class="keyword">class </span><a class="code" href="classxml__parse__error.html" title="Exception class used to signal a failure in parsing an XML document.">xml_parse_error</a> : <span class="keyword">public</span> <span class="keyword">virtual</span> std::runtime_error {
<a name="l00052"></a>00052 <span class="keyword">public</span>:<span class="comment"></span>
<a name="l00053"></a>00053 <span class="comment">  //! Constructor.</span>
<a name="l00054"></a><a class="code" href="classxml__parse__error.html#c64d4ab5140aa03e9c4b8acdb28eb7d8">00054</a> <span class="comment"></span>  <a class="code" href="classxml__parse__error.html#c64d4ab5140aa03e9c4b8acdb28eb7d8" title="Constructor.">xml_parse_error</a>(std::string <span class="keyword">const</span>&amp; message) : std::runtime_error(<span class="stringliteral">"XML parse error: "</span> + message) { }<span class="comment"></span>
<a name="l00055"></a>00055 <span class="comment">  //! Destructor.</span>
<a name="l00056"></a><a class="code" href="classxml__parse__error.html#7cfd5aa644c61dc26877ea6baee47cc9">00056</a> <span class="comment"></span>  <span class="keyword">virtual</span> <a class="code" href="classxml__parse__error.html#7cfd5aa644c61dc26877ea6baee47cc9" title="Destructor.">~xml_parse_error</a>() throw() { }
<a name="l00057"></a>00057 };
<a name="l00058"></a>00058 <span class="comment"></span>
<a name="l00059"></a>00059 <span class="comment">//! Returns true if the label is valid.</span>
<a name="l00060"></a>00060 <span class="comment"></span><span class="keyword">extern</span> <span class="keywordtype">bool</span> <a class="code" href="PersistXML_8cc.html#b1f15d2306c5fe44b59b06d350760f47" title="Returns true if the label is valid.">valid_label</a>(std::string <span class="keyword">const</span>&amp; label);
<a name="l00061"></a>00061 <span class="comment"></span>
<a name="l00062"></a>00062 <span class="comment">/*! @brief A class to control output indentation.</span>
<a name="l00063"></a>00063 <span class="comment"> */</span>
<a name="l00064"></a><a class="code" href="classIndentation.html">00064</a> <span class="keyword">class </span><a class="code" href="classIndentation.html" title="A class to control output indentation.">Indentation</a> {
<a name="l00065"></a>00065 <span class="keyword">private</span>:
<a name="l00066"></a><a class="code" href="classIndentation.html#68a2bfab5a372a01fae8cda6d68b507c">00066</a>   <span class="keywordtype">int</span> <a class="code" href="classIndentation.html#68a2bfab5a372a01fae8cda6d68b507c" title="The number of spaces to indent.">M_spaces</a>;         <span class="comment">//!&lt; The number of spaces to indent.</span>
<a name="l00067"></a>00067 <span class="comment"></span><span class="keyword">public</span>:<span class="comment"></span>
<a name="l00068"></a>00068 <span class="comment">  //! Construct a new indentation object of zero spaces.</span>
<a name="l00069"></a><a class="code" href="classIndentation.html#05bf9ca5ca85dfc96baab13eea009d39">00069</a> <span class="comment"></span>  <a class="code" href="classIndentation.html#05bf9ca5ca85dfc96baab13eea009d39" title="Construct a new indentation object of zero spaces.">Indentation</a>(<span class="keywordtype">void</span>) : <a class="code" href="classIndentation.html#68a2bfab5a372a01fae8cda6d68b507c" title="The number of spaces to indent.">M_spaces</a>(0) { }<span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">  //! Copy constructor.</span>
<a name="l00071"></a><a class="code" href="classIndentation.html#2b50375ef006f62d12f11dbae0ab7353">00071</a> <span class="comment"></span>  <a class="code" href="classIndentation.html#05bf9ca5ca85dfc96baab13eea009d39" title="Construct a new indentation object of zero spaces.">Indentation</a>(<a class="code" href="classIndentation.html" title="A class to control output indentation.">Indentation</a> <span class="keyword">const</span>&amp; indent) : <a class="code" href="classIndentation.html#68a2bfab5a372a01fae8cda6d68b507c" title="The number of spaces to indent.">M_spaces</a>(indent.<a class="code" href="classIndentation.html#68a2bfab5a372a01fae8cda6d68b507c" title="The number of spaces to indent.">M_spaces</a>) { }<span class="comment"></span>
<a name="l00072"></a>00072 <span class="comment">  //! Pre-increment indentation with two spaces.</span>
<a name="l00073"></a><a class="code" href="classIndentation.html#102a21696c9842c852eb71b9be63ae0b">00073</a> <span class="comment"></span>  <a class="code" href="classIndentation.html" title="A class to control output indentation.">Indentation</a>&amp; <a class="code" href="classIndentation.html#102a21696c9842c852eb71b9be63ae0b" title="Pre-increment indentation with two spaces.">operator++</a>(<span class="keywordtype">void</span>) { <a class="code" href="classIndentation.html#68a2bfab5a372a01fae8cda6d68b507c" title="The number of spaces to indent.">M_spaces</a> += 2; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }<span class="comment"></span>
<a name="l00074"></a>00074 <span class="comment">  //! Post-increment indentation with two spaces.</span>
<a name="l00075"></a><a class="code" href="classIndentation.html#5bfb41d0ab25240c69a593d8dc01bd9f">00075</a> <span class="comment"></span>  <a class="code" href="classIndentation.html" title="A class to control output indentation.">Indentation</a> <a class="code" href="classIndentation.html#102a21696c9842c852eb71b9be63ae0b" title="Pre-increment indentation with two spaces.">operator++</a>(<span class="keywordtype">int</span>) { <a class="code" href="classIndentation.html" title="A class to control output indentation.">Indentation</a> tmp(*<span class="keyword">this</span>); <a class="code" href="classIndentation.html#68a2bfab5a372a01fae8cda6d68b507c" title="The number of spaces to indent.">M_spaces</a> += 2; <span class="keywordflow">return</span> tmp; }<span class="comment"></span>
<a name="l00076"></a>00076 <span class="comment">  //! Pre-decrement indentation by two spaces.</span>
<a name="l00077"></a><a class="code" href="classIndentation.html#3c8e2b3621e7ecafe14dec29d0dbf8ae">00077</a> <span class="comment"></span>  <a class="code" href="classIndentation.html" title="A class to control output indentation.">Indentation</a>&amp; <a class="code" href="classIndentation.html#3c8e2b3621e7ecafe14dec29d0dbf8ae" title="Pre-decrement indentation by two spaces.">operator--</a>(<span class="keywordtype">void</span>) { <a class="code" href="classIndentation.html#68a2bfab5a372a01fae8cda6d68b507c" title="The number of spaces to indent.">M_spaces</a> -= 2; <span class="keywordflow">return</span> *<span class="keyword">this</span>; }<span class="comment"></span>
<a name="l00078"></a>00078 <span class="comment">  //! Post-decrement indentation by two spaces.</span>
<a name="l00079"></a><a class="code" href="classIndentation.html#2f84fe97e17bc0f74758290e15c49d76">00079</a> <span class="comment"></span>  <a class="code" href="classIndentation.html" title="A class to control output indentation.">Indentation</a> <a class="code" href="classIndentation.html#3c8e2b3621e7ecafe14dec29d0dbf8ae" title="Pre-decrement indentation by two spaces.">operator--</a>(<span class="keywordtype">int</span>) { <a class="code" href="classIndentation.html" title="A class to control output indentation.">Indentation</a> tmp(*<span class="keyword">this</span>); <a class="code" href="classIndentation.html#68a2bfab5a372a01fae8cda6d68b507c" title="The number of spaces to indent.">M_spaces</a> -= 2; <span class="keywordflow">return</span> tmp; }<span class="comment"></span>
<a name="l00080"></a>00080 <span class="comment">  //! Print object to ostream.</span>
<a name="l00081"></a><a class="code" href="classIndentation.html#b7c6e5a5dd5699d8797c8dd99c95b961">00081</a> <span class="comment"></span>  <span class="keyword">friend</span> std::ostream&amp; <a class="code" href="classIndentation.html#b7c6e5a5dd5699d8797c8dd99c95b961" title="Print object to ostream.">operator&lt;&lt;</a>(std::ostream&amp; os, <a class="code" href="classIndentation.html" title="A class to control output indentation.">Indentation</a> <span class="keyword">const</span>&amp; indentation)
<a name="l00082"></a>00082   {
<a name="l00083"></a>00083     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; indentation.<a class="code" href="classIndentation.html#68a2bfab5a372a01fae8cda6d68b507c" title="The number of spaces to indent.">M_spaces</a>; ++i)
<a name="l00084"></a>00084       os &lt;&lt; <span class="charliteral">' '</span>;
<a name="l00085"></a>00085     <span class="keywordflow">return</span> os;
<a name="l00086"></a>00086   }
<a name="l00087"></a>00087 };
<a name="l00088"></a>00088 <span class="comment"></span>
<a name="l00089"></a>00089 <span class="comment">/*! @brief A persistent object archiver</span>
<a name="l00090"></a>00090 <span class="comment"> *</span>
<a name="l00091"></a>00091 <span class="comment"> * This object represents an archive to which objects</span>
<a name="l00092"></a>00092 <span class="comment"> * can be written to if they support the serialize(PersistXML&amp;)</span>
<a name="l00093"></a>00093 <span class="comment"> * method.</span>
<a name="l00094"></a>00094 <span class="comment"> */</span>
<a name="l00095"></a><a class="code" href="classPersistXML.html">00095</a> <span class="keyword">class </span><a class="code" href="classPersistXML.html" title="A persistent object archiver.">PersistXML</a> {
<a name="l00096"></a>00096 <span class="keyword">public</span>:<span class="comment"></span>
<a name="l00097"></a>00097 <span class="comment">  //! The open mode type of the archive.</span>
<a name="l00098"></a><a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda">00098</a> <span class="comment"></span>  <span class="keyword">enum</span> <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda" title="The open mode type of the archive.">openmode_type</a> {
<a name="l00099"></a><a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145edaad0d87e448e1d77010c4111d76a6ed93">00099</a>     <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145edaad0d87e448e1d77010c4111d76a6ed93" title="Used internally to mark that the archive is not open.">not_open</a>,           <span class="comment">//!&lt; Used internally to mark that the archive is not open.</span>
<a name="l00100"></a><a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda332ebd1dc31393255a2a6ed1ddcb0270">00100</a> <span class="comment"></span>    <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda332ebd1dc31393255a2a6ed1ddcb0270" title="Open for writing objects to the archive.">store</a>,              <span class="comment">//!&lt; Open for writing objects to the archive.</span>
<a name="l00101"></a><a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda312929ba0cd974a84c9edeaad046c922">00101</a> <span class="comment"></span>    <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda312929ba0cd974a84c9edeaad046c922" title="Open for reading objects from the archive.">load</a>                <span class="comment">//!&lt; Open for reading objects from the archive.</span>
<a name="l00102"></a>00102 <span class="comment"></span>  };
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="keyword">protected</span>:
<a name="l00105"></a><a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419">00105</a>   <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda" title="The open mode type of the archive.">openmode_type</a> <a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a>;                     <span class="comment">//!&lt; Whether or not the archive is opened for reading or writing.</span>
<a name="l00106"></a><a class="code" href="classPersistXML.html#40ca9714090ca036aad28dce47e6c46b">00106</a> <span class="comment"></span>  std::string <a class="code" href="classPersistXML.html#40ca9714090ca036aad28dce47e6c46b" title="The name of the XML file used to write the archive to disk.">M_archivename</a>;            <span class="comment">//!&lt; The name of the XML file used to write the archive to disk.</span>
<a name="l00107"></a><a class="code" href="classPersistXML.html#6d5a8241c4e060671c2bd3a33bcb755d">00107</a> <span class="comment"></span>  std::fstream <a class="code" href="classPersistXML.html#6d5a8241c4e060671c2bd3a33bcb755d" title="The file stream of an open archive.">M_archive</a>;               <span class="comment">//!&lt; The file stream of an open archive.</span>
<a name="l00108"></a><a class="code" href="classPersistXML.html#54815808b1b69750789c4acdfc41481f">00108</a> <span class="comment"></span>  <a class="code" href="classIndentation.html" title="A class to control output indentation.">Indentation</a> <a class="code" href="classPersistXML.html#54815808b1b69750789c4acdfc41481f" title="Current XML indentation.">M_indent</a>;                 <span class="comment">//!&lt; Current XML indentation.</span>
<a name="l00109"></a><a class="code" href="classPersistXML.html#0a91795734c743d5a09a10bd94b56250">00109</a> <span class="comment"></span>  xmlDocPtr <a class="code" href="classPersistXML.html#0a91795734c743d5a09a10bd94b56250" title="XML document open for reading.">M_doc</a>;                      <span class="comment">//!&lt; XML document open for reading.</span>
<a name="l00110"></a><a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442">00110</a> <span class="comment"></span>  xmlNodePtr <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>;                     <span class="comment">//!&lt; Current node in M_doc.</span>
<a name="l00111"></a><a class="code" href="classPersistXML.html#3090d396ad00d816a026614d486fff59">00111</a> <span class="comment"></span>  std::stack&lt;std::vector&lt;xmlNodePtr&gt; &gt; <a class="code" href="classPersistXML.html#3090d396ad00d816a026614d486fff59" title="Stack with parents of current node.">M_parent_nodes</a>;  <span class="comment">//!&lt; Stack with parents of current node.</span>
<a name="l00112"></a>00112 <span class="comment"></span>
<a name="l00113"></a>00113 <span class="keyword">public</span>:<span class="comment"></span>
<a name="l00114"></a>00114 <span class="comment">  //! Construct a new persistent XML archive object.</span>
<a name="l00115"></a>00115 <span class="comment"></span>  <a class="code" href="classPersistXML.html#2a0aa48dfd52f9101e1ce4958ea674a0" title="Construct a new persistent XML archive object.">PersistXML</a>(<span class="keywordtype">void</span>);<span class="comment"></span>
<a name="l00116"></a>00116 <span class="comment">  //! Destruct the object. An open archive is first finalized.</span>
<a name="l00117"></a>00117 <span class="comment"></span>  <a class="code" href="classPersistXML.html#aebd66f50c13ade879176bf91c606cf3" title="Destruct the object. An open archive is first finalized.">~PersistXML</a>();<span class="comment"></span>
<a name="l00118"></a>00118 <span class="comment">  //! Associate the archive with a file for either reading or writing.</span>
<a name="l00119"></a>00119 <span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#df1b0482f071fbc2b1bae652e8a52e17" title="Associate the archive with a file for either reading or writing.">open</a>(std::string filename, <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda" title="The open mode type of the archive.">openmode_type</a> mode);<span class="comment"></span>
<a name="l00120"></a>00120 <span class="comment">  //! Finalize and close the archive.</span>
<a name="l00121"></a>00121 <span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#b700aedeb305bb53c8a888e22f812b07" title="Finalize and close the archive.">close</a>(<span class="keywordtype">void</span>);<span class="comment"></span>
<a name="l00122"></a>00122 <span class="comment">  //! Return the current state.</span>
<a name="l00123"></a><a class="code" href="classPersistXML.html#014814a2c9ece11fb570f6e464c15611">00123</a> <span class="comment"></span>  <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda" title="The open mode type of the archive.">openmode_type</a> <a class="code" href="classPersistXML.html#014814a2c9ece11fb570f6e464c15611" title="Return the current state.">openmode</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a>; }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="keyword">private</span>:
<a name="l00126"></a>00126   <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#3d0fcb488bba83e5b2c416aa61ed5545" title="Parse the archive.">parse_archive</a>(<span class="keywordtype">void</span>);
<a name="l00127"></a>00127   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00128"></a>00128     <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#84c22189a1765ecd9e7972a36e4f202f" title="Write builtin-type builtin to archive.">write_escaped</a>(T <span class="keyword">const</span>&amp; builtin);
<a name="l00129"></a>00129   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00130"></a>00130     <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#b72f4766b98469f36bdc43e9788f9951" title="Read builtin from stringstream ss.">read_data</a>(std::stringstream&amp; ss, T&amp; builtin);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 <span class="keyword">public</span>:
<a name="l00133"></a>00133   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00134"></a>00134     <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(std::string <span class="keyword">const</span>&amp; label, T&amp; <span class="keywordtype">object</span>);
<a name="l00135"></a>00135   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00136"></a>00136     <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(std::string <span class="keyword">const</span>&amp; label, boost::shared_ptr&lt;T&gt;&amp; ptr);
<a name="l00137"></a>00137   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00138"></a>00138     <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(std::string <span class="keyword">const</span>&amp; label, std::vector&lt;T&gt;&amp; vec);
<a name="l00139"></a>00139   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00140"></a>00140     <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(std::string <span class="keyword">const</span>&amp; label, std::list&lt;T&gt;&amp; list);
<a name="l00141"></a>00141   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> KEY, <span class="keyword">typename</span> INFO, <span class="keyword">typename</span> COMPARE&gt;
<a name="l00142"></a>00142     <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(std::string <span class="keyword">const</span>&amp; label, std::map&lt;KEY, INFO, COMPARE&gt;&amp; map);
<a name="l00143"></a>00143   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00144"></a>00144     <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(std::string <span class="keyword">const</span>&amp; label, boost::optional&lt;T&gt;&amp; opt);
<a name="l00145"></a>00145 <span class="preprocessor">#if 0</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span>  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> CONTAINER&gt;
<a name="l00147"></a>00147     <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(std::string <span class="keyword">const</span>&amp; label, CONTAINER&amp; <span class="keywordtype">object</span>,
<a name="l00148"></a>00148         <span class="keyword">typename</span> CONTAINER::iterator start, <span class="keyword">typename</span> CONTAINER::iterator end);
<a name="l00149"></a>00149 <span class="preprocessor">#endif</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span>  <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00151"></a>00151     <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5e61b58d1792c76c85a31d850864bb06" title="Serialize builtin type builtin using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize_builtin</a>(std::string <span class="keyword">const</span>&amp; label, T&amp; builtin);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classXMLLabel.html" title="An XML label.">XMLLabel</a>;
<a name="l00154"></a>00154   <span class="keyword">friend</span> std::ostream&amp; <a class="code" href="classPersistXML.html#3d6113f59b7b2148cc753f901e0650d1" title="For debugging purposes. Write a PersistXML::openmode to os.">operator&lt;&lt;</a>(std::ostream&amp; os, <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda" title="The open mode type of the archive.">openmode_type</a> <a class="code" href="classPersistXML.html#014814a2c9ece11fb570f6e464c15611" title="Return the current state.">openmode</a>);
<a name="l00155"></a>00155 };
<a name="l00156"></a>00156 <span class="comment"></span>
<a name="l00157"></a>00157 <span class="comment">/*! @brief An XML label.</span>
<a name="l00158"></a>00158 <span class="comment"> *</span>
<a name="l00159"></a>00159 <span class="comment"> * Output/input an extra &amp;lt;label&amp;gt;...&amp;lt;/label&amp;gt; pair, increasing the indentation.</span>
<a name="l00160"></a>00160 <span class="comment"> */</span>
<a name="l00161"></a><a class="code" href="classXMLLabel.html">00161</a> <span class="keyword">class </span><a class="code" href="classXMLLabel.html" title="An XML label.">XMLLabel</a> {
<a name="l00162"></a>00162 <span class="keyword">private</span>:
<a name="l00163"></a><a class="code" href="classXMLLabel.html#e075a3234bd18a892e6fbc0f87db446e">00163</a>   <a class="code" href="classPersistXML.html" title="A persistent object archiver.">PersistXML</a>&amp; <a class="code" href="classXMLLabel.html#e075a3234bd18a892e6fbc0f87db446e" title="The archive.">M_xml</a>;            <span class="comment">//!&lt; The archive.</span>
<a name="l00164"></a><a class="code" href="classXMLLabel.html#fb022b30924b8b4aa6111afec7d3386d">00164</a> <span class="comment"></span>  std::string <a class="code" href="classXMLLabel.html#fb022b30924b8b4aa6111afec7d3386d" title="The label.">M_label</a>;          <span class="comment">//!&lt; The label.</span>
<a name="l00165"></a>00165 <span class="comment"></span><span class="keyword">public</span>:<span class="comment"></span>
<a name="l00166"></a>00166 <span class="comment">  //! Open \a label archive \a xml.</span>
<a name="l00167"></a><a class="code" href="classXMLLabel.html#d6a25674898560877dd4e4affd92c234">00167</a> <span class="comment"></span>  <a class="code" href="classXMLLabel.html#d6a25674898560877dd4e4affd92c234" title="Open label archive xml.">XMLLabel</a>(<a class="code" href="classPersistXML.html" title="A persistent object archiver.">PersistXML</a>&amp; xml, std::string <span class="keyword">const</span>&amp; label) :
<a name="l00168"></a>00168       <a class="code" href="classXMLLabel.html#e075a3234bd18a892e6fbc0f87db446e" title="The archive.">M_xml</a>(xml), <a class="code" href="classXMLLabel.html#fb022b30924b8b4aa6111afec7d3386d" title="The label.">M_label</a>(label) { <a class="code" href="classXMLLabel.html#e075a3234bd18a892e6fbc0f87db446e" title="The archive.">M_xml</a>.<a class="code" href="classPersistXML.html#6d5a8241c4e060671c2bd3a33bcb755d" title="The file stream of an open archive.">M_archive</a> &lt;&lt; <a class="code" href="classXMLLabel.html#e075a3234bd18a892e6fbc0f87db446e" title="The archive.">M_xml</a>.<a class="code" href="classPersistXML.html#54815808b1b69750789c4acdfc41481f" title="Current XML indentation.">M_indent</a>++ &lt;&lt; <span class="charliteral">'&lt;'</span> &lt;&lt; <a class="code" href="classXMLLabel.html#fb022b30924b8b4aa6111afec7d3386d" title="The label.">M_label</a> &lt;&lt; <span class="stringliteral">"&gt;\n"</span>; }<span class="comment"></span>
<a name="l00169"></a>00169 <span class="comment">  //! Close the label.</span>
<a name="l00170"></a><a class="code" href="classXMLLabel.html#f37d92587b322c1f819c6861c6477b6c">00170</a> <span class="comment"></span>  <a class="code" href="classXMLLabel.html#f37d92587b322c1f819c6861c6477b6c" title="Close the label.">~XMLLabel</a>() { <a class="code" href="classXMLLabel.html#e075a3234bd18a892e6fbc0f87db446e" title="The archive.">M_xml</a>.<a class="code" href="classPersistXML.html#6d5a8241c4e060671c2bd3a33bcb755d" title="The file stream of an open archive.">M_archive</a> &lt;&lt; --<a class="code" href="classXMLLabel.html#e075a3234bd18a892e6fbc0f87db446e" title="The archive.">M_xml</a>.<a class="code" href="classPersistXML.html#54815808b1b69750789c4acdfc41481f" title="Current XML indentation.">M_indent</a> &lt;&lt; <span class="stringliteral">"&lt;/"</span> &lt;&lt; <a class="code" href="classXMLLabel.html#fb022b30924b8b4aa6111afec7d3386d" title="The label.">M_label</a> &lt;&lt; <span class="stringliteral">"&gt;\n"</span>; }
<a name="l00171"></a>00171 };
<a name="l00172"></a>00172 <span class="comment"></span>
<a name="l00173"></a>00173 <span class="comment">//! Serialize \a object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.</span>
<a name="l00174"></a>00174 <span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00175"></a><a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595">00175</a>   <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">PersistXML::serialize</a>(std::string <span class="keyword">const</span>&amp; label, T&amp; <span class="keywordtype">object</span>)
<a name="l00176"></a>00176   {
<a name="l00177"></a>00177     <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda332ebd1dc31393255a2a6ed1ddcb0270" title="Open for writing objects to the archive.">store</a>)
<a name="l00178"></a>00178     {
<a name="l00179"></a>00179       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", ("</span> &lt;&lt;
<a name="l00180"></a>00180           type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">") {"</span> &lt;&lt; <span class="keywordtype">object</span> &lt;&lt; <span class="stringliteral">"}) is called."</span>);
<a name="l00181"></a>00181       <a class="code" href="classXMLLabel.html" title="An XML label.">XMLLabel</a> xml_label(*<span class="keyword">this</span>, label);
<a name="l00182"></a>00182       <span class="keywordtype">object</span>.serialize(*<span class="keyword">this</span>);
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda312929ba0cd974a84c9edeaad046c922" title="Open for reading objects from the archive.">load</a>)
<a name="l00185"></a>00185     {
<a name="l00186"></a>00186       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", ("</span> &lt;&lt;
<a name="l00187"></a>00187           type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">") @"</span> &lt;&lt; (<span class="keywordtype">void</span>*)&amp;<span class="keywordtype">object</span> &lt;&lt; <span class="stringliteral">") is called."</span>);
<a name="l00188"></a>00188       <span class="keywordflow">while</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00189"></a>00189       {
<a name="l00190"></a>00190         Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"M_cur is \""</span> &lt;&lt; <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name &lt;&lt; <span class="stringliteral">"\"."</span>);
<a name="l00191"></a>00191         <span class="keywordflow">if</span> (!xmlStrcmp(<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name, (xmlChar <span class="keyword">const</span>*) label.c_str()))
<a name="l00192"></a>00192         {
<a name="l00193"></a>00193           xmlNodePtr cur = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>;
<a name="l00194"></a>00194           <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = cur-&gt;children;
<a name="l00195"></a>00195           <span class="keywordtype">object</span>.serialize(*<span class="keyword">this</span>);
<a name="l00196"></a>00196           <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = cur-&gt;next;
<a name="l00197"></a>00197           <span class="keywordflow">return</span>;
<a name="l00198"></a>00198         }
<a name="l00199"></a>00199         <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;next;
<a name="l00200"></a>00200       }
<a name="l00201"></a>00201       <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__parse__error.html" title="Exception class used to signal a failure in parsing an XML document.">xml_parse_error</a>(<span class="stringliteral">"Cannot find requested element \""</span> + label + <span class="stringliteral">"\" in current node."</span>), <span class="stringliteral">""</span>);
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203   }
<a name="l00204"></a>00204 <span class="comment"></span>
<a name="l00205"></a>00205 <span class="comment">//! Serialize the object pointed to by a boost::shared_ptr using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.</span>
<a name="l00206"></a>00206 <span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00207"></a><a class="code" href="classPersistXML.html#61f0539fa881fa3c2b80ef753c13befe">00207</a>   <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">PersistXML::serialize</a>(std::string <span class="keyword">const</span>&amp; label, boost::shared_ptr&lt;T&gt;&amp; ptr)
<a name="l00208"></a>00208   {
<a name="l00209"></a>00209     <span class="keywordflow">if</span> (!<a class="code" href="PersistXML_8cc.html#b1f15d2306c5fe44b59b06d350760f47" title="Returns true if the label is valid.">valid_label</a>(label))
<a name="l00210"></a>00210       <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__invalid__label.html" title="Exception class used to signal an invalid XML label.">xml_invalid_label</a>(label), <span class="stringliteral">""</span>);
<a name="l00211"></a>00211     <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda332ebd1dc31393255a2a6ed1ddcb0270" title="Open for writing objects to the archive.">store</a>)
<a name="l00212"></a>00212     {
<a name="l00213"></a>00213       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", (boost::shared_ptr&lt;"</span> &lt;&lt;
<a name="l00214"></a>00214           type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt;)) is called."</span>);
<a name="l00215"></a>00215       <a class="code" href="classXMLLabel.html" title="An XML label.">XMLLabel</a> xml_label(*<span class="keyword">this</span>, label);
<a name="l00216"></a>00216       ptr-&gt;serialize(*<span class="keyword">this</span>);
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda312929ba0cd974a84c9edeaad046c922" title="Open for reading objects from the archive.">load</a>)
<a name="l00219"></a>00219     {
<a name="l00220"></a>00220       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", (boost::shared_ptr&lt;"</span> &lt;&lt;
<a name="l00221"></a>00221           type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt;) @"</span> &lt;&lt; (<span class="keywordtype">void</span>*)&amp;ptr &lt;&lt; <span class="stringliteral">") is called."</span>);
<a name="l00222"></a>00222       <span class="keywordflow">while</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00223"></a>00223       {
<a name="l00224"></a>00224         Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"M_cur is \""</span> &lt;&lt; <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name &lt;&lt; <span class="stringliteral">"\"."</span>);
<a name="l00225"></a>00225         <span class="keywordflow">if</span> (!xmlStrcmp(<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name, (xmlChar <span class="keyword">const</span>*) label.c_str()))
<a name="l00226"></a>00226         {
<a name="l00227"></a>00227           xmlNodePtr cur = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>;
<a name="l00228"></a>00228           <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = cur-&gt;children;
<a name="l00229"></a>00229           ptr.reset(<span class="keyword">new</span> T);
<a name="l00230"></a>00230           AllocTag(ptr.get(), <span class="stringliteral">"Allocated for a boost::shared_ptr&lt;"</span> &lt;&lt; libcwd::type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt; by PersistXML"</span>);
<a name="l00231"></a>00231           ptr-&gt;serialize(*<span class="keyword">this</span>);
<a name="l00232"></a>00232           <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = cur-&gt;next;
<a name="l00233"></a>00233           <span class="keywordflow">return</span>;
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235         <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;next;
<a name="l00236"></a>00236       }
<a name="l00237"></a>00237       <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__parse__error.html" title="Exception class used to signal a failure in parsing an XML document.">xml_parse_error</a>(<span class="stringliteral">"Cannot find requested element \""</span> + label + <span class="stringliteral">"\" in current node."</span>), <span class="stringliteral">""</span>);
<a name="l00238"></a>00238     }
<a name="l00239"></a>00239   }
<a name="l00240"></a>00240 <span class="comment"></span>
<a name="l00241"></a>00241 <span class="comment">//! Serialize std::vector \a vec using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.</span>
<a name="l00242"></a>00242 <span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00243"></a><a class="code" href="classPersistXML.html#bb23b6f861c80a6a0ffb3104971cce3a">00243</a>   <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">PersistXML::serialize</a>(std::string <span class="keyword">const</span>&amp; label, std::vector&lt;T&gt;&amp; vec)
<a name="l00244"></a>00244   {
<a name="l00245"></a>00245     <span class="keywordflow">if</span> (!<a class="code" href="PersistXML_8cc.html#b1f15d2306c5fe44b59b06d350760f47" title="Returns true if the label is valid.">valid_label</a>(label))
<a name="l00246"></a>00246       <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__invalid__label.html" title="Exception class used to signal an invalid XML label.">xml_invalid_label</a>(label), <span class="stringliteral">""</span>);
<a name="l00247"></a>00247     <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda332ebd1dc31393255a2a6ed1ddcb0270" title="Open for writing objects to the archive.">store</a>)
<a name="l00248"></a>00248     {
<a name="l00249"></a>00249       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", (std::vector&lt;"</span> &lt;&lt;
<a name="l00250"></a>00250           type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt;)) is called."</span>);
<a name="l00251"></a>00251       <a class="code" href="classXMLLabel.html" title="An XML label.">XMLLabel</a> xml_label(*<span class="keyword">this</span>, label);
<a name="l00252"></a>00252       <span class="keywordflow">for</span> (<span class="keyword">typename</span> std::vector&lt;T&gt;::iterator iter = vec.begin(); iter != vec.end(); ++iter)
<a name="l00253"></a>00253         this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(<span class="stringliteral">"item"</span>, *iter);
<a name="l00254"></a>00254     }
<a name="l00255"></a>00255     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda312929ba0cd974a84c9edeaad046c922" title="Open for reading objects from the archive.">load</a>)
<a name="l00256"></a>00256     {
<a name="l00257"></a>00257       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", (std::vector&lt;"</span> &lt;&lt;
<a name="l00258"></a>00258           type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt;) @"</span> &lt;&lt; (<span class="keywordtype">void</span>*)&amp;vec &lt;&lt; <span class="stringliteral">") is called."</span>);
<a name="l00259"></a>00259       <span class="keywordflow">while</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00260"></a>00260       {
<a name="l00261"></a>00261         Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"M_cur is \""</span> &lt;&lt; <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name &lt;&lt; <span class="stringliteral">"\"."</span>);
<a name="l00262"></a>00262         <span class="keywordflow">if</span> (!xmlStrcmp(<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name, (xmlChar <span class="keyword">const</span>*) label.c_str()))
<a name="l00263"></a>00263         {
<a name="l00264"></a>00264           <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;children)
<a name="l00265"></a>00265           {
<a name="l00266"></a>00266             xmlNodePtr cur = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>;
<a name="l00267"></a>00267             <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = cur-&gt;children;
<a name="l00268"></a>00268             <span class="keywordflow">while</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00269"></a>00269             {
<a name="l00270"></a>00270               <span class="keywordflow">if</span> (!xmlStrcmp(<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name, (xmlChar <span class="keyword">const</span>*) <span class="stringliteral">"item"</span>))
<a name="l00271"></a>00271               {
<a name="l00272"></a>00272                 vec.push_back(T());
<a name="l00273"></a>00273                 this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(<span class="stringliteral">"item"</span>, vec.back());
<a name="l00274"></a>00274               }
<a name="l00275"></a>00275               <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;next;
<a name="l00276"></a>00276             }
<a name="l00277"></a>00277             <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = cur-&gt;next;
<a name="l00278"></a>00278           }
<a name="l00279"></a>00279           <span class="keywordflow">return</span>;
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281         <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;next;
<a name="l00282"></a>00282       }
<a name="l00283"></a>00283       <span class="keywordflow">if</span> (!<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00284"></a>00284         <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__parse__error.html" title="Exception class used to signal a failure in parsing an XML document.">xml_parse_error</a>(<span class="stringliteral">"Cannot find element \""</span> + label + <span class="stringliteral">"\"."</span>), <span class="stringliteral">""</span>);
<a name="l00285"></a>00285     }
<a name="l00286"></a>00286   }
<a name="l00287"></a>00287 <span class="comment"></span>
<a name="l00288"></a>00288 <span class="comment">//! Serialize std::list \a list using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.</span>
<a name="l00289"></a>00289 <span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00290"></a><a class="code" href="classPersistXML.html#e9f500428211782e9bed55e734c96b1e">00290</a>   <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">PersistXML::serialize</a>(std::string <span class="keyword">const</span>&amp; label, std::list&lt;T&gt;&amp; list)
<a name="l00291"></a>00291   {
<a name="l00292"></a>00292     <span class="keywordflow">if</span> (!<a class="code" href="PersistXML_8cc.html#b1f15d2306c5fe44b59b06d350760f47" title="Returns true if the label is valid.">valid_label</a>(label))
<a name="l00293"></a>00293       <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__invalid__label.html" title="Exception class used to signal an invalid XML label.">xml_invalid_label</a>(label), <span class="stringliteral">""</span>);
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda332ebd1dc31393255a2a6ed1ddcb0270" title="Open for writing objects to the archive.">store</a>)
<a name="l00295"></a>00295     {
<a name="l00296"></a>00296       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", (std::list&lt;"</span> &lt;&lt;
<a name="l00297"></a>00297           type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt;)) is called."</span>);
<a name="l00298"></a>00298       <a class="code" href="classXMLLabel.html" title="An XML label.">XMLLabel</a> xml_label(*<span class="keyword">this</span>, label);
<a name="l00299"></a>00299       <span class="keywordflow">for</span> (<span class="keyword">typename</span> std::list&lt;T&gt;::iterator iter = list.begin(); iter != list.end(); ++iter)
<a name="l00300"></a>00300         this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(<span class="stringliteral">"item"</span>, *iter);
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda312929ba0cd974a84c9edeaad046c922" title="Open for reading objects from the archive.">load</a>)
<a name="l00303"></a>00303     {
<a name="l00304"></a>00304       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", (std::list&lt;"</span> &lt;&lt;
<a name="l00305"></a>00305           type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt;) @"</span> &lt;&lt; (<span class="keywordtype">void</span>*)&amp;list &lt;&lt; <span class="stringliteral">") is called."</span>);
<a name="l00306"></a>00306       <span class="keywordflow">while</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00307"></a>00307       {
<a name="l00308"></a>00308         Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"M_cur is \""</span> &lt;&lt; <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name &lt;&lt; <span class="stringliteral">"\"."</span>);
<a name="l00309"></a>00309         <span class="keywordflow">if</span> (!xmlStrcmp(<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name, (xmlChar <span class="keyword">const</span>*) label.c_str()))
<a name="l00310"></a>00310         {
<a name="l00311"></a>00311           <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;children)
<a name="l00312"></a>00312           {
<a name="l00313"></a>00313             xmlNodePtr cur = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>;
<a name="l00314"></a>00314             <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = cur-&gt;children;
<a name="l00315"></a>00315             <span class="keywordflow">while</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00316"></a>00316             {
<a name="l00317"></a>00317               <span class="keywordflow">if</span> (!xmlStrcmp(<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name, (xmlChar <span class="keyword">const</span>*) <span class="stringliteral">"item"</span>))
<a name="l00318"></a>00318               {
<a name="l00319"></a>00319                 list.push_back(T());
<a name="l00320"></a>00320                 this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(<span class="stringliteral">"item"</span>, list.back());
<a name="l00321"></a>00321               }
<a name="l00322"></a>00322               <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;next;
<a name="l00323"></a>00323             }
<a name="l00324"></a>00324             <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = cur-&gt;next;
<a name="l00325"></a>00325           }
<a name="l00326"></a>00326           <span class="keywordflow">return</span>;
<a name="l00327"></a>00327         }
<a name="l00328"></a>00328         <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;next;
<a name="l00329"></a>00329       }
<a name="l00330"></a>00330       <span class="keywordflow">if</span> (!<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00331"></a>00331         <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__parse__error.html" title="Exception class used to signal a failure in parsing an XML document.">xml_parse_error</a>(<span class="stringliteral">"Cannot find element \""</span> + label + <span class="stringliteral">"\"."</span>), <span class="stringliteral">""</span>);
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333   }
<a name="l00334"></a>00334 <span class="comment"></span>
<a name="l00335"></a>00335 <span class="comment">//! Serialize std::map \a map using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.</span>
<a name="l00336"></a>00336 <span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> KEY, <span class="keyword">typename</span> INFO, <span class="keyword">typename</span> COMPARE&gt;
<a name="l00337"></a><a class="code" href="classPersistXML.html#566dab263e1ccf51e0ed9c63de565f52">00337</a>   <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">PersistXML::serialize</a>(std::string <span class="keyword">const</span>&amp; label, std::map&lt;KEY, INFO, COMPARE&gt;&amp; map)
<a name="l00338"></a>00338   {
<a name="l00339"></a>00339     <span class="keyword">typedef</span> std::map&lt;KEY, INFO, COMPARE&gt; container_type;
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (!<a class="code" href="PersistXML_8cc.html#b1f15d2306c5fe44b59b06d350760f47" title="Returns true if the label is valid.">valid_label</a>(label))
<a name="l00341"></a>00341       <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__invalid__label.html" title="Exception class used to signal an invalid XML label.">xml_invalid_label</a>(label), <span class="stringliteral">""</span>);
<a name="l00342"></a>00342     <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda332ebd1dc31393255a2a6ed1ddcb0270" title="Open for writing objects to the archive.">store</a>)
<a name="l00343"></a>00343     {
<a name="l00344"></a>00344       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", (std::map&lt;"</span> &lt;&lt;
<a name="l00345"></a>00345           type_info_of&lt;KEY&gt;().demangled_name() &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt;
<a name="l00346"></a>00346           type_info_of&lt;INFO&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt;)) is called."</span>);
<a name="l00347"></a>00347       <a class="code" href="classXMLLabel.html" title="An XML label.">XMLLabel</a> xml_label(*<span class="keyword">this</span>, label);
<a name="l00348"></a>00348       <span class="keywordflow">for</span> (<span class="keyword">typename</span> container_type::iterator iter = map.begin(); iter != map.end(); ++iter)
<a name="l00349"></a>00349       {
<a name="l00350"></a>00350         this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(<span class="stringliteral">"key"</span>, const_cast&lt;KEY&amp;&gt;(iter-&gt;first));
<a name="l00351"></a>00351         this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(<span class="stringliteral">"info"</span>, iter-&gt;second);
<a name="l00352"></a>00352       }
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda312929ba0cd974a84c9edeaad046c922" title="Open for reading objects from the archive.">load</a>)
<a name="l00355"></a>00355     {
<a name="l00356"></a>00356       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", (std::map&lt;"</span> &lt;&lt;
<a name="l00357"></a>00357           type_info_of&lt;KEY&gt;().demangled_name() &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt;
<a name="l00358"></a>00358           type_info_of&lt;INFO&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt;) @"</span> &lt;&lt; (<span class="keywordtype">void</span>*)&amp;map &lt;&lt; <span class="stringliteral">") is called."</span>);
<a name="l00359"></a>00359       <span class="keywordflow">while</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00360"></a>00360       {
<a name="l00361"></a>00361         Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"M_cur is \""</span> &lt;&lt; <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name &lt;&lt; <span class="stringliteral">"\"."</span>);
<a name="l00362"></a>00362         <span class="keywordflow">if</span> (!xmlStrcmp(<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name, (xmlChar <span class="keyword">const</span>*) label.c_str()))
<a name="l00363"></a>00363         {
<a name="l00364"></a>00364           <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;children)
<a name="l00365"></a>00365           {
<a name="l00366"></a>00366             xmlNodePtr cur = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>;
<a name="l00367"></a>00367             <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = cur-&gt;children;
<a name="l00368"></a>00368             <span class="keywordflow">while</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00369"></a>00369             {
<a name="l00370"></a>00370               Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"M_cur is \""</span> &lt;&lt; <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name &lt;&lt; <span class="stringliteral">"\"."</span>);
<a name="l00371"></a>00371               <span class="keywordflow">if</span> (!xmlStrcmp(<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name, (xmlChar <span class="keyword">const</span>*) <span class="stringliteral">"key"</span>))
<a name="l00372"></a>00372               {
<a name="l00373"></a>00373                 KEY key;
<a name="l00374"></a>00374                 this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(<span class="stringliteral">"key"</span>, key);
<a name="l00375"></a>00375                 std::pair&lt;typename container_type::iterator, bool&gt; result =
<a name="l00376"></a>00376                     map.insert(<span class="keyword">typename</span> container_type::value_type(key, INFO()));
<a name="l00377"></a>00377                 <span class="keywordflow">if</span> (!result.second)
<a name="l00378"></a>00378                   <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__parse__error.html" title="Exception class used to signal a failure in parsing an XML document.">xml_parse_error</a>(<span class="stringliteral">"Duplicated key for map."</span>), <span class="stringliteral">""</span>);
<a name="l00379"></a>00379                 <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;next;
<a name="l00380"></a>00380                 <span class="keywordflow">while</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00381"></a>00381                 {
<a name="l00382"></a>00382                   Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"M_cur is \""</span> &lt;&lt; <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name &lt;&lt; <span class="stringliteral">"\"."</span>);
<a name="l00383"></a>00383                   <span class="keywordflow">if</span> (!xmlStrcmp(<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name, (xmlChar <span class="keyword">const</span>*) <span class="stringliteral">"key"</span>))
<a name="l00384"></a>00384                   {
<a name="l00385"></a>00385                     <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = NULL;
<a name="l00386"></a>00386                     <span class="keywordflow">break</span>;
<a name="l00387"></a>00387                   }
<a name="l00388"></a>00388                   <span class="keywordflow">if</span> (!xmlStrcmp(<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name, (xmlChar <span class="keyword">const</span>*) <span class="stringliteral">"info"</span>))
<a name="l00389"></a>00389                   {
<a name="l00390"></a>00390                     this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(<span class="stringliteral">"info"</span>, result.first-&gt;second);
<a name="l00391"></a>00391                     Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"Inserted in map: "</span> &lt;&lt; *result.first);
<a name="l00392"></a>00392                     <span class="keywordflow">break</span>;
<a name="l00393"></a>00393                   }
<a name="l00394"></a>00394                   <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;next;
<a name="l00395"></a>00395                 }
<a name="l00396"></a>00396                 <span class="keywordflow">if</span> (!<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00397"></a>00397                   <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__parse__error.html" title="Exception class used to signal a failure in parsing an XML document.">xml_parse_error</a>(<span class="stringliteral">"Missing element \"info\"."</span>), <span class="stringliteral">""</span>);
<a name="l00398"></a>00398               }
<a name="l00399"></a>00399               <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;next;
<a name="l00400"></a>00400             }
<a name="l00401"></a>00401           }
<a name="l00402"></a>00402           <span class="keywordflow">return</span>;
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404         <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;next;
<a name="l00405"></a>00405       }
<a name="l00406"></a>00406       <span class="keywordflow">if</span> (!<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00407"></a>00407         <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__parse__error.html" title="Exception class used to signal a failure in parsing an XML document.">xml_parse_error</a>(<span class="stringliteral">"Cannot find element \""</span> + label + <span class="stringliteral">"\"."</span>), <span class="stringliteral">""</span>);
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409   }
<a name="l00410"></a>00410 <span class="comment"></span>
<a name="l00411"></a>00411 <span class="comment">//! Serialize boost::optional \a opt using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.</span>
<a name="l00412"></a>00412 <span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00413"></a><a class="code" href="classPersistXML.html#89aff78d91246230072598796ef78534">00413</a>   <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">PersistXML::serialize</a>(std::string <span class="keyword">const</span>&amp; label, boost::optional&lt;T&gt;&amp; opt)
<a name="l00414"></a>00414   {
<a name="l00415"></a>00415     <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda332ebd1dc31393255a2a6ed1ddcb0270" title="Open for writing objects to the archive.">store</a>)
<a name="l00416"></a>00416     {
<a name="l00417"></a>00417       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", (boost::optional&lt;"</span> &lt;&lt;
<a name="l00418"></a>00418           type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt;)) is called."</span>);
<a name="l00419"></a>00419       <span class="keywordflow">if</span> (opt)
<a name="l00420"></a>00420         this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(label, *opt);
<a name="l00421"></a>00421       <span class="keywordflow">else</span>
<a name="l00422"></a>00422       {
<a name="l00423"></a>00423         std::string unknown(<span class="stringliteral">"unknown"</span>);
<a name="l00424"></a>00424         this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(label, unknown);
<a name="l00425"></a>00425       }
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda312929ba0cd974a84c9edeaad046c922" title="Open for reading objects from the archive.">load</a>)
<a name="l00428"></a>00428     {
<a name="l00429"></a>00429       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", (boost::optional&lt;"</span> &lt;&lt;
<a name="l00430"></a>00430           type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt;) @"</span> &lt;&lt; (<span class="keywordtype">void</span>*)&amp;opt &lt;&lt; <span class="stringliteral">") is called."</span>);
<a name="l00431"></a>00431       <span class="keywordtype">bool</span> unknown = <span class="keyword">false</span>;
<a name="l00432"></a>00432       <span class="comment">// Peek ahead (look for the label).</span>
<a name="l00433"></a>00433       <span class="keywordflow">while</span> (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00434"></a>00434       {
<a name="l00435"></a>00435         Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"M_cur is \""</span> &lt;&lt; <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name &lt;&lt; <span class="stringliteral">"\"."</span>);
<a name="l00436"></a>00436         <span class="keywordflow">if</span> (!xmlStrcmp(<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;name, (xmlChar <span class="keyword">const</span>*) label.c_str()))
<a name="l00437"></a>00437         {
<a name="l00438"></a>00438           unknown = (<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;children-&gt;type == XML_TEXT_NODE &amp;&amp;
<a name="l00439"></a>00439                      !strcmp((<span class="keywordtype">char</span>*)<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;children-&gt;name, <span class="stringliteral">"text"</span>) &amp;&amp;
<a name="l00440"></a>00440                      !strcmp((<span class="keywordtype">char</span>*)<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;children-&gt;content, <span class="stringliteral">"unknown"</span>));
<a name="l00441"></a>00441           <span class="keywordflow">break</span>;
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443         <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a> = <a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>-&gt;next;
<a name="l00444"></a>00444       }
<a name="l00445"></a>00445       <span class="keywordflow">if</span> (!<a class="code" href="classPersistXML.html#ffe7f6b77657b09a8e5c22e0d85d3442" title="Current node in M_doc.">M_cur</a>)
<a name="l00446"></a>00446         <a class="code" href="exceptions_8h.html#038a5f95e87598cdf451fa27eca0601c" title="Throw an exception.">THROW_EXCEPTION</a>(<a class="code" href="classxml__parse__error.html" title="Exception class used to signal a failure in parsing an XML document.">xml_parse_error</a>(<span class="stringliteral">"Cannot find element \""</span> + label + <span class="stringliteral">"\"."</span>), <span class="stringliteral">""</span>);
<a name="l00447"></a>00447       <span class="comment">// Read the content.</span>
<a name="l00448"></a>00448       <span class="keywordflow">if</span> (unknown)
<a name="l00449"></a>00449       {
<a name="l00450"></a>00450         std::string unknown;
<a name="l00451"></a>00451         this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(label, unknown);
<a name="l00452"></a>00452         <a class="code" href="debug_8h.html#ca68c0d4ac8df0838e209fb5300f7be3" title="Assert if debugging is turned on.">ASSERT</a>(unknown == <span class="stringliteral">"unknown"</span>);
<a name="l00453"></a>00453         opt = boost::none;
<a name="l00454"></a>00454       }
<a name="l00455"></a>00455       <span class="keywordflow">else</span>
<a name="l00456"></a>00456       {
<a name="l00457"></a>00457         T value;
<a name="l00458"></a>00458         this-&gt;<a class="code" href="classPersistXML.html#5612c3e53fee8ffb21a228536fea9595" title="Serialize object using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">serialize</a>(label, value);
<a name="l00459"></a>00459         opt = value;
<a name="l00460"></a>00460       }
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462   }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464 <span class="comment">// Specializations.</span>
<a name="l00465"></a>00465 <span class="comment"></span>
<a name="l00466"></a>00466 <span class="comment">//! \internal Helper macro to define serialization specializations for the builtin types.</span>
<a name="l00467"></a><a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">00467</a> <span class="comment"></span><span class="preprocessor">#define SERIALIZE_BUILTINTYPE(type) \</span>
<a name="l00468"></a>00468 <span class="preprocessor">  template&lt;&gt; inline void PersistXML::serialize(std::string const&amp; label, type&amp; builtin) \</span>
<a name="l00469"></a>00469 <span class="preprocessor">    { this-&gt;serialize_builtin(label, builtin); }</span>
<a name="l00470"></a>00470 <span class="preprocessor"></span>
<a name="l00471"></a>00471 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(std::string);
<a name="l00472"></a>00472 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(<span class="keywordtype">signed</span> <span class="keywordtype">char</span>);
<a name="l00473"></a>00473 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>);
<a name="l00474"></a>00474 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(<span class="keywordtype">short</span>);
<a name="l00475"></a>00475 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
<a name="l00476"></a>00476 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(<span class="keywordtype">int</span>);
<a name="l00477"></a>00477 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>);
<a name="l00478"></a>00478 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(<span class="keywordtype">long</span>);
<a name="l00479"></a>00479 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>);
<a name="l00480"></a>00480 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(<span class="keywordtype">float</span>);
<a name="l00481"></a>00481 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(<span class="keywordtype">double</span>);
<a name="l00482"></a>00482 <a class="code" href="PersistXML_8h.html#61b4e124abdc78ea4746050433d4e145">SERIALIZE_BUILTINTYPE</a>(<span class="keywordtype">bool</span>);
<a name="l00483"></a>00483 <span class="comment"></span>
<a name="l00484"></a>00484 <span class="comment">//! Write builtin-type \a builtin to archive.</span>
<a name="l00485"></a>00485 <span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00486"></a><a class="code" href="classPersistXML.html#84c22189a1765ecd9e7972a36e4f202f">00486</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#84c22189a1765ecd9e7972a36e4f202f" title="Write builtin-type builtin to archive.">PersistXML::write_escaped</a>(T <span class="keyword">const</span>&amp; builtin) { <a class="code" href="classPersistXML.html#6d5a8241c4e060671c2bd3a33bcb755d" title="The file stream of an open archive.">M_archive</a> &lt;&lt; builtin; }<span class="comment"></span>
<a name="l00487"></a>00487 <span class="comment">//! Write char \a c to archive.</span>
<a name="l00488"></a>00488 <span class="comment"></span><span class="keyword">template</span>&lt;&gt;
<a name="l00489"></a>00489   <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#84c22189a1765ecd9e7972a36e4f202f" title="Write builtin-type builtin to archive.">PersistXML::write_escaped</a>(<span class="keywordtype">char</span> <span class="keyword">const</span>&amp; c);<span class="comment"></span>
<a name="l00490"></a>00490 <span class="comment">//! Write unsigned char \a c to archive.</span>
<a name="l00491"></a>00491 <span class="comment"></span><span class="keyword">template</span>&lt;&gt;
<a name="l00492"></a><a class="code" href="classPersistXML.html#c543180c1cadac8ad327d71888cc6ca8">00492</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#84c22189a1765ecd9e7972a36e4f202f" title="Write builtin-type builtin to archive.">PersistXML::write_escaped</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <span class="keyword">const</span>&amp; c) { <a class="code" href="classPersistXML.html#84c22189a1765ecd9e7972a36e4f202f" title="Write builtin-type builtin to archive.">write_escaped</a>(reinterpret_cast&lt;char const&amp;&gt;(c)); }<span class="comment"></span>
<a name="l00493"></a>00493 <span class="comment">//! Write string \a s to archive.</span>
<a name="l00494"></a>00494 <span class="comment"></span><span class="keyword">template</span>&lt;&gt;
<a name="l00495"></a>00495   <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#84c22189a1765ecd9e7972a36e4f202f" title="Write builtin-type builtin to archive.">PersistXML::write_escaped</a>(std::string <span class="keyword">const</span>&amp; s);
<a name="l00496"></a>00496 <span class="comment"></span>
<a name="l00497"></a>00497 <span class="comment">//! Read \a builtin from stringstream \a ss.</span>
<a name="l00498"></a>00498 <span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00499"></a><a class="code" href="classPersistXML.html#b72f4766b98469f36bdc43e9788f9951">00499</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#b72f4766b98469f36bdc43e9788f9951" title="Read builtin from stringstream ss.">PersistXML::read_data</a>(std::stringstream&amp; ss, T&amp; builtin) { ss &gt;&gt; builtin; }<span class="comment"></span>
<a name="l00500"></a>00500 <span class="comment">//! Read string \a s from stringstream \a ss.</span>
<a name="l00501"></a>00501 <span class="comment"></span><span class="keyword">template</span>&lt;&gt;
<a name="l00502"></a><a class="code" href="classPersistXML.html#3bbc8083eb86c6265a2136a8999e78e1">00502</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#b72f4766b98469f36bdc43e9788f9951" title="Read builtin from stringstream ss.">PersistXML::read_data</a>(std::stringstream&amp; ss, std::string&amp; s) { s = ss.str(); }
<a name="l00503"></a>00503 <span class="comment"></span>
<a name="l00504"></a>00504 <span class="comment">//! Serialize builtin type \a builtin using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.</span>
<a name="l00505"></a>00505 <span class="comment"></span><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00506"></a><a class="code" href="classPersistXML.html#5e61b58d1792c76c85a31d850864bb06">00506</a>   <span class="keywordtype">void</span> <a class="code" href="classPersistXML.html#5e61b58d1792c76c85a31d850864bb06" title="Serialize builtin type builtin using the xml tag &amp;lt;label&amp;gt;&amp;lt;/label&amp;gt;.">PersistXML::serialize_builtin</a>(std::string <span class="keyword">const</span>&amp; label, T&amp; builtin)
<a name="l00507"></a>00507   {
<a name="l00508"></a>00508     <span class="keywordflow">if</span> (<a class="code" href="classPersistXML.html#2b18e69338f77033f4308a56ee111419" title="Whether or not the archive is opened for reading or writing.">M_openmode</a> == <a class="code" href="classPersistXML.html#ebe6d1165a2ef09b5cc722f09d145eda332ebd1dc31393255a2a6ed1ddcb0270" title="Open for writing objects to the archive.">store</a>)
<a name="l00509"></a>00509     {
<a name="l00510"></a>00510       Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4df69f2eaea85a2436897d76669e43a5" title="This debug channel is used for XMLPersist.">dc::persist</a>, <span class="stringliteral">"PersistXML::serialize_builtin&lt;"</span> &lt;&lt;
<a name="l00511"></a>00511           type_info_of&lt;T&gt;().demangled_name() &lt;&lt; <span class="stringliteral">"&gt;(\""</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">"\", "</span> &lt;&lt; builtin &lt;&lt; <span class="stringliteral">") is called."</span>);
<a name="l00512"></a>00512       M_archive &lt;&lt; M_indent &lt;&lt; '&lt;' &lt;&lt; label &lt;&lt; '&gt;<span class="stringliteral">';</span>
<a name="l00513"></a>00513 <span class="stringliteral">      write_escaped(builtin);</span>
<a name="l00514"></a>00514 <span class="stringliteral">      M_archive &lt;&lt; "&lt;/" &lt;&lt; label &lt;&lt; "&gt;\n";</span>
<a name="l00515"></a>00515 <span class="stringliteral">    }</span>
<a name="l00516"></a>00516 <span class="stringliteral">    else if (M_openmode == load)</span>
<a name="l00517"></a>00517 <span class="stringliteral">    {</span>
<a name="l00518"></a>00518 <span class="stringliteral">      Dout(dc::persist, "PersistXML::serialize_builtin&lt;" &lt;&lt;</span>
<a name="l00519"></a>00519 <span class="stringliteral">          type_info_of&lt;T&gt;().demangled_name() &lt;&lt; "&gt;(\"" &lt;&lt; label &lt;&lt; "\", @" &lt;&lt; (void*)&amp;builtin &lt;&lt; ") is called.");</span>
<a name="l00520"></a>00520 <span class="stringliteral">      while (M_cur)</span>
<a name="l00521"></a>00521 <span class="stringliteral">      {</span>
<a name="l00522"></a>00522 <span class="stringliteral">        Dout(dc::persist, "M_cur is \"" &lt;&lt; M_cur-&gt;name &lt;&lt; "\".");</span>
<a name="l00523"></a>00523 <span class="stringliteral">        if (!xmlStrcmp(M_cur-&gt;name, (xmlChar const*) label.c_str()))</span>
<a name="l00524"></a>00524 <span class="stringliteral">        {</span>
<a name="l00525"></a>00525 <span class="stringliteral">          if (M_cur-&gt;children)</span>
<a name="l00526"></a>00526 <span class="stringliteral">          {</span>
<a name="l00527"></a>00527 <span class="stringliteral">            std::stringstream is;</span>
<a name="l00528"></a>00528 <span class="stringliteral">            is &lt;&lt; M_cur-&gt;children-&gt;content;</span>
<a name="l00529"></a>00529 <span class="stringliteral">            read_data(is, builtin);</span>
<a name="l00530"></a>00530 <span class="stringliteral">          }</span>
<a name="l00531"></a>00531 <span class="stringliteral">          else</span>
<a name="l00532"></a>00532 <span class="stringliteral">            builtin = T();      // Should only be used for std::string.</span>
<a name="l00533"></a>00533 <span class="stringliteral">          return;</span>
<a name="l00534"></a>00534 <span class="stringliteral">        }</span>
<a name="l00535"></a>00535 <span class="stringliteral">        M_cur = M_cur-&gt;next;</span>
<a name="l00536"></a>00536 <span class="stringliteral">      }</span>
<a name="l00537"></a>00537 <span class="stringliteral">      if (!M_cur)</span>
<a name="l00538"></a>00538 <span class="stringliteral">        THROW_EXCEPTION(xml_parse_error("Cannot find element \"" + label + "\"."), "");</span>
<a name="l00539"></a>00539 <span class="stringliteral">    }</span>
<a name="l00540"></a>00540 <span class="stringliteral">  }</span>
<a name="l00541"></a>00541 <span class="stringliteral"></span>
<a name="l00542"></a>00542 <span class="stringliteral">#endif // PERSISTXML_H</span>
</pre></div></div>
<hr>

<TABLE WIDTH=100% BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR>
<TH ALIGN=left BGCOLOR="#e8feff"><ADDRESS>Copyright &copy; 2005-2007 Carlo Wood.&nbsp; All rights reserved.</ADDRESS></TH>
</TR>
</TABLE>

</DIV>
</BODY>
</HTML>

