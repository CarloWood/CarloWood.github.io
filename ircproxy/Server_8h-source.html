<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML LANG="en-us">
 
<HEAD>
<META name="Author" content="Carlo Wood">
<META name="description" content="IRC proxy">
<META name="keywords" content="IRC, proxy, bnc, security, protection">
<META http-equiv="content-type" content="text/html; charset=iso-8859-1">
<TITLE>ircproxy documentation</TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
<LINK HREF="main.css" REL="stylesheet" TYPE="text/css">
</HEAD>

<BODY>

<TABLE class="header" BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR>
<TD WIDTH=120><IMG SRC="images/ircproxy.png" BORDER=0></TD>
<TD VALIGN=center ALIGN=center BGCOLOR="#0A0607"><FONT size=+4 color="#ffffff"><B>&nbsp;ircproxy</B>&nbsp;</FONT>
<FONT size=+3 color="#ffffff">The&nbsp;Ultimate&nbsp;Cyborg</FONT></TD>
</TR>
</TABLE>

<DIV class="normal">
<hr>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>Server.h</h1><a href="Server_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// ircproxy -- An intelligent IRC proxy</span>
<a name="l00002"></a>00002 <span class="comment">//</span><span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">//! @file Server.h</span>
<a name="l00004"></a>00004 <span class="comment">//! @brief Header of class Server</span>
<a name="l00005"></a>00005 <span class="comment"></span><span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// Copyright (C) 2005 - 2007 by</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// Carlo Wood, Run on IRC &lt;carlo@alinoe.com&gt;</span>
<a name="l00009"></a>00009 <span class="comment">// RSA-1024 0x624ACAD5 1997-01-26                    Sign &amp; Encrypt</span>
<a name="l00010"></a>00010 <span class="comment">// Fingerprint16 = 32 EC A7 B6 AC DB 65 A6  F6 F6 55 DD 1C DC FF 61</span>
<a name="l00011"></a>00011 <span class="comment">//</span>
<a name="l00012"></a>00012 <span class="comment">// This file may be distributed under the terms of the Q Public License</span>
<a name="l00013"></a>00013 <span class="comment">// version 1.0 as appearing in the file LICENSE.QPL included in the</span>
<a name="l00014"></a>00014 <span class="comment">// packaging of this file.</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#ifndef SERVER_H</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#define SERVER_H</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span>
<a name="l00019"></a>00019 <span class="preprocessor">#ifndef USE_PCH</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;netinet/in.h&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="debug_8h.html" title="This file contains the declaration of debug related macros, objects and functions...">debug.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;libcw/timing.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#endif</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="ServerVersion_8h.html" title="This file contains the declaration of class ServerVersion.">ServerVersion.h</a>"</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">class </span><a class="code" href="classPersistXML.html" title="A persistent object archiver.">PersistXML</a>;
<a name="l00029"></a>00029 <span class="comment"></span>
<a name="l00030"></a>00030 <span class="comment">/*! @brief An IRC server.</span>
<a name="l00031"></a>00031 <span class="comment"> * </span>
<a name="l00032"></a>00032 <span class="comment"> * This class represents an IRC server.</span>
<a name="l00033"></a>00033 <span class="comment"> */</span>
<a name="l00034"></a><a class="code" href="classServer.html">00034</a> <span class="keyword">class </span><a class="code" href="classServer.html" title="An IRC server.">Server</a> {
<a name="l00035"></a>00035 <span class="keyword">public</span>:
<a name="l00036"></a><a class="code" href="classServer.html#c0b06efa7753a0831c84391a87dbc5e1">00036</a>   <span class="keyword">typedef</span> std::vector&lt;unsigned short&gt; <a class="code" href="classServer.html#c0b06efa7753a0831c84391a87dbc5e1" title="The type of the list with ports.">ports_type</a>;       <span class="comment">//!&lt; The type of the list with ports.</span>
<a name="l00037"></a>00037 <span class="comment"></span>
<a name="l00038"></a>00038 <span class="keyword">private</span>:<span class="comment"></span>
<a name="l00039"></a>00039 <span class="comment">  //! The resolvable name of the server, or IP number if there is no hostname available.</span>
<a name="l00040"></a><a class="code" href="classServer.html#9d36829098a2ea2a3cf846b7f3f70d95">00040</a> <span class="comment"></span>  std::string           <a class="code" href="classServer.html#9d36829098a2ea2a3cf846b7f3f70d95" title="The resolvable name of the server, or IP number if there is no hostname available...">M_hostname</a>;             
<a name="l00041"></a>00041 <span class="comment"></span>
<a name="l00042"></a>00042 <span class="comment">  //! The IRC name of the server, as received by the proxy during connect.</span>
<a name="l00043"></a><a class="code" href="classServer.html#f96de84fa0e0edffdf9136ccb73faa48">00043</a> <span class="comment"></span>  std::string           <a class="code" href="classServer.html#f96de84fa0e0edffdf9136ccb73faa48" title="The IRC name of the server, as received by the proxy during connect.">M_irc_name</a>;             
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01">00045</a>   <a class="code" href="classServer.html#c0b06efa7753a0831c84391a87dbc5e1" title="The type of the list with ports.">ports_type</a>            <a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>;                        <span class="comment">//!&lt; Client listen ports that we successfully connected to in the past.</span>
<a name="l00046"></a><a class="code" href="classServer.html#1164ee722f2090877ea7f2e68bdb4b63">00046</a> <span class="comment"></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>        <a class="code" href="classServer.html#1164ee722f2090877ea7f2e68bdb4b63" title="The last port that was successfully connected to.">M_default_port</a>;                 <span class="comment">//!&lt; The last port that was successfully connected to.</span>
<a name="l00047"></a><a class="code" href="classServer.html#c6b4846c649fc6e1d21cec5968795c7d">00047</a> <span class="comment"></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>        <a class="code" href="classServer.html#c6b4846c649fc6e1d21cec5968795c7d" title="The next port that we will try to connect to.">M_next_port</a>;                    <span class="comment">//!&lt; The next port that we will try to connect to.</span>
<a name="l00048"></a><a class="code" href="classServer.html#a36e1abdc551a21b37a6ce5f03dd49d6">00048</a> <span class="comment"></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>        <a class="code" href="classServer.html#a36e1abdc551a21b37a6ce5f03dd49d6" title="The port that we try to connect to.">M_port</a>;                         <span class="comment">//!&lt; The port that we try to connect to.</span>
<a name="l00049"></a>00049 <span class="comment"></span>
<a name="l00050"></a><a class="code" href="classServer.html#b2338b3f475db8591fdcf1f9fd06b87c">00050</a>   <span class="keyword">struct </span>in_addr        <a class="code" href="classServer.html#b2338b3f475db8591fdcf1f9fd06b87c" title="Vhost to use to connect to server.">M_vhost</a>;                        <span class="comment">//!&lt; Vhost to use to connect to server.</span>
<a name="l00051"></a>00051 <span class="comment"></span>
<a name="l00052"></a><a class="code" href="classServer.html#39372fd406f5aea414d524b6a2464665">00052</a>   <a class="code" href="classNetwork.html" title="An IRC network.">Network</a>*              <a class="code" href="classServer.html#39372fd406f5aea414d524b6a2464665" title="Reference to the corresponding network.">M_network</a>;                      <span class="comment">//!&lt; Reference to the corresponding network.</span>
<a name="l00053"></a><a class="code" href="classServer.html#d774341f1d874886e08a1b1d2c3069bf">00053</a> <span class="comment"></span>  timeval               <a class="code" href="classServer.html#d774341f1d874886e08a1b1d2c3069bf" title="Last time we disconnected or tried to connect to this server.">M_last_connection_event</a>;        <span class="comment">//!&lt; Last time we disconnected or tried to connect to this server.</span>
<a name="l00054"></a>00054 <span class="comment"></span>
<a name="l00055"></a><a class="code" href="classServer.html#bb2d52ec4eca38606a773ed6d69d758c">00055</a>   <span class="keyword">static</span> timeval        <a class="code" href="classServer.html#bb2d52ec4eca38606a773ed6d69d758c" title="Initial value for M_last_connection_event.">S_last_connection_event_init</a>;   <span class="comment">//!&lt; Initial value for M_last_connection_event.</span>
<a name="l00056"></a>00056 <span class="comment"></span>
<a name="l00057"></a><a class="code" href="classServer.html#a466bcb3dbf0936b904084609f5b146a">00057</a>   <a class="code" href="classServerVersion.html" title="Server version and characteristics cache.">ServerVersion</a>         <a class="code" href="classServer.html#a466bcb3dbf0936b904084609f5b146a" title="Information about the server version.">M_version</a>;                      <span class="comment">//!&lt; Information about the server version.</span>
<a name="l00058"></a>00058 <span class="comment"></span>
<a name="l00059"></a>00059 <span class="keyword">public</span>:<span class="comment"></span>
<a name="l00060"></a>00060 <span class="comment">  //! Construct a Server object with DNS name \a hostname and default listen port \a default_port.</span>
<a name="l00061"></a><a class="code" href="classServer.html#f5e22d8615336fdaf958094fc02e1c39">00061</a> <span class="comment"></span>  <a class="code" href="classServer.html#e8df2df494913617b098be2ed7261d3d" title="Construct an uninitialized object for the given network.">Server</a>(<a class="code" href="classNetwork.html" title="An IRC network.">Network</a>&amp; <a class="code" href="classServer.html#a5b46fc63911bc170778cc3615a1cd15" title="Return the corresponding network.">network</a>, std::string <span class="keyword">const</span>&amp; <a class="code" href="classServer.html#7f16e82ee6e62acef38c093963f40c81" title="The resolvable name of the server that one can connect to (as passed to the constructor)...">hostname</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classServer.html#9d7dc751400eceb6df50befb7be1f64e" title="Returns the port we last tried to connect to.">port</a>, <span class="keyword">struct</span> in_addr <a class="code" href="classServer.html#f2980aabea620b4ba0d9340c9190d2b7" title="Returns a reference to the vhost of this server.">vhost</a>) :
<a name="l00062"></a>00062       <a class="code" href="classServer.html#9d36829098a2ea2a3cf846b7f3f70d95" title="The resolvable name of the server, or IP number if there is no hostname available...">M_hostname</a>(hostname), <a class="code" href="classServer.html#1164ee722f2090877ea7f2e68bdb4b63" title="The last port that was successfully connected to.">M_default_port</a>(port), <a class="code" href="classServer.html#c6b4846c649fc6e1d21cec5968795c7d" title="The next port that we will try to connect to.">M_next_port</a>(port), <a class="code" href="classServer.html#a36e1abdc551a21b37a6ce5f03dd49d6" title="The port that we try to connect to.">M_port</a>(0), <a class="code" href="classServer.html#b2338b3f475db8591fdcf1f9fd06b87c" title="Vhost to use to connect to server.">M_vhost</a>(vhost),
<a name="l00063"></a>00063       <a class="code" href="classServer.html#39372fd406f5aea414d524b6a2464665" title="Reference to the corresponding network.">M_network</a>(&amp;network), <a class="code" href="classServer.html#d774341f1d874886e08a1b1d2c3069bf" title="Last time we disconnected or tried to connect to this server.">M_last_connection_event</a>(<a class="code" href="classServer.html#bb2d52ec4eca38606a773ed6d69d758c" title="Initial value for M_last_connection_event.">S_last_connection_event_init</a>)
<a name="l00064"></a>00064       {
<a name="l00065"></a>00065         Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4fad4911d56fc2bccbb8ed9041454394" title="This debug channel is used for object construction/destruction tracking.">dc::objects</a>, <span class="stringliteral">"Constructing Server("</span> &lt;&lt; network &lt;&lt; <span class="stringliteral">", \""</span> &lt;&lt; hostname &lt;&lt; <span class="stringliteral">"\", "</span> &lt;&lt; port &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt; vhost &lt;&lt; <span class="stringliteral">")"</span>);
<a name="l00066"></a>00066       }
<a name="l00067"></a>00067 <span class="comment"></span>
<a name="l00068"></a>00068 <span class="comment">  //! Construct an uninitialized object for the given network.</span>
<a name="l00069"></a><a class="code" href="classServer.html#e8df2df494913617b098be2ed7261d3d">00069</a> <span class="comment"></span>  <a class="code" href="classServer.html#e8df2df494913617b098be2ed7261d3d" title="Construct an uninitialized object for the given network.">Server</a>(<span class="keywordtype">void</span>) : <a class="code" href="classServer.html#c6b4846c649fc6e1d21cec5968795c7d" title="The next port that we will try to connect to.">M_next_port</a>(0), <a class="code" href="classServer.html#39372fd406f5aea414d524b6a2464665" title="Reference to the corresponding network.">M_network</a>(NULL)
<a name="l00070"></a>00070       {
<a name="l00071"></a>00071         Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4fad4911d56fc2bccbb8ed9041454394" title="This debug channel is used for object construction/destruction tracking.">dc::objects</a>, <span class="stringliteral">"Constructing Server()"</span>);
<a name="l00072"></a>00072         std::memset(&amp;<a class="code" href="classServer.html#b2338b3f475db8591fdcf1f9fd06b87c" title="Vhost to use to connect to server.">M_vhost</a>, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> in_addr));
<a name="l00073"></a>00073       }
<a name="l00074"></a>00074 <span class="comment"></span>
<a name="l00075"></a>00075 <span class="comment">  //! Copy constructor.</span>
<a name="l00076"></a><a class="code" href="classServer.html#0b338841dc23b9905b117362d395da0d">00076</a> <span class="comment"></span>  <a class="code" href="classServer.html#e8df2df494913617b098be2ed7261d3d" title="Construct an uninitialized object for the given network.">Server</a>(<a class="code" href="classServer.html" title="An IRC server.">Server</a> <span class="keyword">const</span>&amp; server) :
<a name="l00077"></a>00077       <a class="code" href="classServer.html#9d36829098a2ea2a3cf846b7f3f70d95" title="The resolvable name of the server, or IP number if there is no hostname available...">M_hostname</a>(server.<a class="code" href="classServer.html#9d36829098a2ea2a3cf846b7f3f70d95" title="The resolvable name of the server, or IP number if there is no hostname available...">M_hostname</a>),
<a name="l00078"></a>00078       <a class="code" href="classServer.html#f96de84fa0e0edffdf9136ccb73faa48" title="The IRC name of the server, as received by the proxy during connect.">M_irc_name</a>(server.<a class="code" href="classServer.html#f96de84fa0e0edffdf9136ccb73faa48" title="The IRC name of the server, as received by the proxy during connect.">M_irc_name</a>),
<a name="l00079"></a>00079       <a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>(server.<a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>),
<a name="l00080"></a>00080       <a class="code" href="classServer.html#1164ee722f2090877ea7f2e68bdb4b63" title="The last port that was successfully connected to.">M_default_port</a>(server.<a class="code" href="classServer.html#1164ee722f2090877ea7f2e68bdb4b63" title="The last port that was successfully connected to.">M_default_port</a>),
<a name="l00081"></a>00081       <a class="code" href="classServer.html#c6b4846c649fc6e1d21cec5968795c7d" title="The next port that we will try to connect to.">M_next_port</a>(server.<a class="code" href="classServer.html#c6b4846c649fc6e1d21cec5968795c7d" title="The next port that we will try to connect to.">M_next_port</a>),
<a name="l00082"></a>00082       <a class="code" href="classServer.html#a36e1abdc551a21b37a6ce5f03dd49d6" title="The port that we try to connect to.">M_port</a>(server.<a class="code" href="classServer.html#a36e1abdc551a21b37a6ce5f03dd49d6" title="The port that we try to connect to.">M_port</a>),
<a name="l00083"></a>00083       <a class="code" href="classServer.html#b2338b3f475db8591fdcf1f9fd06b87c" title="Vhost to use to connect to server.">M_vhost</a>(server.<a class="code" href="classServer.html#b2338b3f475db8591fdcf1f9fd06b87c" title="Vhost to use to connect to server.">M_vhost</a>),
<a name="l00084"></a>00084       <a class="code" href="classServer.html#39372fd406f5aea414d524b6a2464665" title="Reference to the corresponding network.">M_network</a>(server.<a class="code" href="classServer.html#39372fd406f5aea414d524b6a2464665" title="Reference to the corresponding network.">M_network</a>),
<a name="l00085"></a>00085       <a class="code" href="classServer.html#d774341f1d874886e08a1b1d2c3069bf" title="Last time we disconnected or tried to connect to this server.">M_last_connection_event</a>(server.<a class="code" href="classServer.html#d774341f1d874886e08a1b1d2c3069bf" title="Last time we disconnected or tried to connect to this server.">M_last_connection_event</a>)
<a name="l00086"></a>00086       { Dout(<a class="code" href="namespacedebug_1_1channels_1_1dc.html#4fad4911d56fc2bccbb8ed9041454394" title="This debug channel is used for object construction/destruction tracking.">dc::objects</a>, <span class="stringliteral">"Copy-constructing Server from "</span> &lt;&lt; server); }
<a name="l00087"></a>00087 <span class="comment"></span>
<a name="l00088"></a>00088 <span class="comment">  //! The resolvable name of the server that one can connect to (as passed to the constructor).</span>
<a name="l00089"></a><a class="code" href="classServer.html#7f16e82ee6e62acef38c093963f40c81">00089</a> <span class="comment"></span>  std::string <span class="keyword">const</span>&amp; <a class="code" href="classServer.html#7f16e82ee6e62acef38c093963f40c81" title="The resolvable name of the server that one can connect to (as passed to the constructor)...">hostname</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classServer.html#9d36829098a2ea2a3cf846b7f3f70d95" title="The resolvable name of the server, or IP number if there is no hostname available...">M_hostname</a>; }
<a name="l00090"></a>00090 <span class="comment"></span>
<a name="l00091"></a>00091 <span class="comment">  //! Return the next port we will try to connect to.</span>
<a name="l00092"></a><a class="code" href="classServer.html#f878be477a5e92983c577edaf80fc02a">00092</a> <span class="comment"></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classServer.html#f878be477a5e92983c577edaf80fc02a" title="Return the next port we will try to connect to.">next_port</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classServer.html#c6b4846c649fc6e1d21cec5968795c7d" title="The next port that we will try to connect to.">M_next_port</a>; }
<a name="l00093"></a>00093 <span class="comment"></span>
<a name="l00094"></a>00094 <span class="comment">  //! Set the next port to connect to.</span>
<a name="l00095"></a><a class="code" href="classServer.html#984a20dd8f62c155e1284a282f661964">00095</a> <span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classServer.html#984a20dd8f62c155e1284a282f661964" title="Set the next port to connect to.">set_next_port</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classServer.html#f878be477a5e92983c577edaf80fc02a" title="Return the next port we will try to connect to.">next_port</a>) { <a class="code" href="classServer.html#c6b4846c649fc6e1d21cec5968795c7d" title="The next port that we will try to connect to.">M_next_port</a> = next_port; }
<a name="l00096"></a>00096 <span class="comment"></span>
<a name="l00097"></a>00097 <span class="comment">  //! Returns one of the ports of the server that one can connect to.</span>
<a name="l00098"></a>00098 <span class="comment"></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classServer.html#41f4e78a93f414228a5deced8efdb018" title="Returns one of the ports of the server that one can connect to.">random_port</a>(<span class="keywordtype">void</span>) <span class="keyword">const</span>;
<a name="l00099"></a>00099 <span class="comment"></span>
<a name="l00100"></a>00100 <span class="comment">  //! Returns the port we last tried to connect to.</span>
<a name="l00101"></a><a class="code" href="classServer.html#9d7dc751400eceb6df50befb7be1f64e">00101</a> <span class="comment"></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classServer.html#9d7dc751400eceb6df50befb7be1f64e" title="Returns the port we last tried to connect to.">port</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classServer.html#a36e1abdc551a21b37a6ce5f03dd49d6" title="The port that we try to connect to.">M_port</a>; }
<a name="l00102"></a>00102 <span class="comment"></span>
<a name="l00103"></a>00103 <span class="comment">  //! Returns a reference to the vhost of this server.</span>
<a name="l00104"></a><a class="code" href="classServer.html#f2980aabea620b4ba0d9340c9190d2b7">00104</a> <span class="comment"></span>  <span class="keyword">struct </span>in_addr&amp; <a class="code" href="classServer.html#f2980aabea620b4ba0d9340c9190d2b7" title="Returns a reference to the vhost of this server.">vhost</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> <a class="code" href="classServer.html#b2338b3f475db8591fdcf1f9fd06b87c" title="Vhost to use to connect to server.">M_vhost</a>; }
<a name="l00105"></a>00105 <span class="comment"></span>
<a name="l00106"></a>00106 <span class="comment">  //! Returns the vhost that should be used for this server.</span>
<a name="l00107"></a><a class="code" href="classServer.html#665596428ad8136b2defd706b7326f69">00107</a> <span class="comment"></span>  <span class="keyword">struct </span>in_addr <a class="code" href="classServer.html#f2980aabea620b4ba0d9340c9190d2b7" title="Returns a reference to the vhost of this server.">vhost</a>(void) const { <span class="keywordflow">return</span> <a class="code" href="classServer.html#b2338b3f475db8591fdcf1f9fd06b87c" title="Vhost to use to connect to server.">M_vhost</a>; }
<a name="l00108"></a>00108 <span class="comment"></span>
<a name="l00109"></a>00109 <span class="comment">  //! A const reference to the list with known port numbers of this server.</span>
<a name="l00110"></a><a class="code" href="classServer.html#65efb5341875925d2d0fe3cb3808c161">00110</a> <span class="comment"></span>  <a class="code" href="classServer.html#c0b06efa7753a0831c84391a87dbc5e1" title="The type of the list with ports.">ports_type</a> <span class="keyword">const</span>&amp; <a class="code" href="classServer.html#65efb5341875925d2d0fe3cb3808c161" title="A const reference to the list with known port numbers of this server.">ports</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>; }
<a name="l00111"></a>00111 <span class="comment"></span>
<a name="l00112"></a>00112 <span class="comment">  //! Return the corresponding network.</span>
<a name="l00113"></a><a class="code" href="classServer.html#a5b46fc63911bc170778cc3615a1cd15">00113</a> <span class="comment"></span>  <a class="code" href="classNetwork.html" title="An IRC network.">Network</a> <span class="keyword">const</span>&amp; <a class="code" href="classServer.html#a5b46fc63911bc170778cc3615a1cd15" title="Return the corresponding network.">network</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> *<a class="code" href="classServer.html#39372fd406f5aea414d524b6a2464665" title="Reference to the corresponding network.">M_network</a>; }
<a name="l00114"></a>00114 <span class="comment"></span>
<a name="l00115"></a>00115 <span class="comment">  //! Return the corresponding network.</span>
<a name="l00116"></a><a class="code" href="classServer.html#c5db3a88d9cf4de97f7e4700841ab1e0">00116</a> <span class="comment"></span>  <a class="code" href="classNetwork.html" title="An IRC network.">Network</a>&amp; <a class="code" href="classServer.html#a5b46fc63911bc170778cc3615a1cd15" title="Return the corresponding network.">network</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> *<a class="code" href="classServer.html#39372fd406f5aea414d524b6a2464665" title="Reference to the corresponding network.">M_network</a>; }
<a name="l00117"></a>00117 <span class="comment"></span>
<a name="l00118"></a>00118 <span class="comment">  //! Set the final network. Called from Identity::detected_network.</span>
<a name="l00119"></a><a class="code" href="classServer.html#afae54a917af70efb7f38b4905c0516f">00119</a> <span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classServer.html#afae54a917af70efb7f38b4905c0516f" title="Set the final network. Called from Identity::detected_network.">set_network</a>(<a class="code" href="classNetwork.html" title="An IRC network.">Network</a>* <a class="code" href="classServer.html#a5b46fc63911bc170778cc3615a1cd15" title="Return the corresponding network.">network</a>) { <a class="code" href="classServer.html#39372fd406f5aea414d524b6a2464665" title="Reference to the corresponding network.">M_network</a> = network; }
<a name="l00120"></a>00120 <span class="comment"></span>
<a name="l00121"></a>00121 <span class="comment">  //! The server version object.</span>
<a name="l00122"></a><a class="code" href="classServer.html#61988b3fb4d7c3d758ba5e8ad2fbf503">00122</a> <span class="comment"></span>  <a class="code" href="classServerVersion.html" title="Server version and characteristics cache.">ServerVersion</a> <span class="keyword">const</span>&amp; <a class="code" href="classServer.html#61988b3fb4d7c3d758ba5e8ad2fbf503" title="The server version object.">version</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classServer.html#a466bcb3dbf0936b904084609f5b146a" title="Information about the server version.">M_version</a>; }
<a name="l00123"></a>00123 <span class="comment"></span>
<a name="l00124"></a>00124 <span class="comment">  //! The server version object.</span>
<a name="l00125"></a><a class="code" href="classServer.html#cee310a9dbbebf380f0564440726d871">00125</a> <span class="comment"></span>  <a class="code" href="classServerVersion.html" title="Server version and characteristics cache.">ServerVersion</a>&amp; <a class="code" href="classServer.html#61988b3fb4d7c3d758ba5e8ad2fbf503" title="The server version object.">version</a>(<span class="keywordtype">void</span>) { <span class="keywordflow">return</span> <a class="code" href="classServer.html#a466bcb3dbf0936b904084609f5b146a" title="Information about the server version.">M_version</a>; }
<a name="l00126"></a>00126 <span class="comment"></span>
<a name="l00127"></a>00127 <span class="comment">  //! Return true if port \a port is known.</span>
<a name="l00128"></a><a class="code" href="classServer.html#21e6907a1e09e6b8562a573da64c1334">00128</a> <span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classServer.html#21e6907a1e09e6b8562a573da64c1334" title="Return true if port port is known.">find_port</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classServer.html#9d7dc751400eceb6df50befb7be1f64e" title="Returns the port we last tried to connect to.">port</a>)<span class="keyword"> const</span>
<a name="l00129"></a>00129 <span class="keyword">  </span>{
<a name="l00130"></a>00130     ports_type::const_iterator iter = std::find(<a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>.begin(), <a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>.end(), port);
<a name="l00131"></a>00131     <span class="keywordflow">return</span> iter != <a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>.end(); 
<a name="l00132"></a>00132   }
<a name="l00133"></a>00133 <span class="comment"></span>
<a name="l00134"></a>00134 <span class="comment">  //! Add port \a port (duplicates are ignored). Return true when it was a new port.</span>
<a name="l00135"></a><a class="code" href="classServer.html#17eebbb705dddc9faf5789337f4e3f4b">00135</a> <span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classServer.html#17eebbb705dddc9faf5789337f4e3f4b" title="Add port port (duplicates are ignored). Return true when it was a new port.">add_port</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classServer.html#9d7dc751400eceb6df50befb7be1f64e" title="Returns the port we last tried to connect to.">port</a>)
<a name="l00136"></a>00136     {
<a name="l00137"></a>00137       <span class="keywordtype">bool</span> new_port = !this-&gt;<a class="code" href="classServer.html#21e6907a1e09e6b8562a573da64c1334" title="Return true if port port is known.">find_port</a>(port);
<a name="l00138"></a>00138       <span class="keywordflow">if</span> (new_port)
<a name="l00139"></a>00139         <a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>.push_back(port);
<a name="l00140"></a>00140       <span class="keywordflow">return</span> new_port;
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142 <span class="comment"></span>
<a name="l00143"></a>00143 <span class="comment">  //! Delete port \a port. Return true when the port was found.</span>
<a name="l00144"></a><a class="code" href="classServer.html#61a4ecd95a311252caa65e53ff99c98f">00144</a> <span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classServer.html#61a4ecd95a311252caa65e53ff99c98f" title="Delete port port. Return true when the port was found.">delete_port</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classServer.html#9d7dc751400eceb6df50befb7be1f64e" title="Returns the port we last tried to connect to.">port</a>)
<a name="l00145"></a>00145     {
<a name="l00146"></a>00146       ports_type::iterator iter = std::find(<a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>.begin(), <a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>.end(), port);
<a name="l00147"></a>00147       <span class="keywordtype">bool</span> found = iter != <a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>.end();
<a name="l00148"></a>00148       <span class="keywordflow">if</span> (found)
<a name="l00149"></a>00149         <a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>.erase(iter);
<a name="l00150"></a>00150       <span class="keywordflow">return</span> found;
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 <span class="comment"></span>
<a name="l00153"></a>00153 <span class="comment">  //! Make \a port the port returned by port().</span>
<a name="l00154"></a><a class="code" href="classServer.html#ee2c799aa891081b249daec365b78ed2">00154</a> <span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classServer.html#ee2c799aa891081b249daec365b78ed2" title="Make port the port returned by port().">set_port</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="classServer.html#9d7dc751400eceb6df50befb7be1f64e" title="Returns the port we last tried to connect to.">port</a>)
<a name="l00155"></a>00155     {
<a name="l00156"></a>00156       <a class="code" href="classServer.html#61a4ecd95a311252caa65e53ff99c98f" title="Delete port port. Return true when the port was found.">delete_port</a>(port);
<a name="l00157"></a>00157       <a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>.insert(<a class="code" href="classServer.html#eef4dd99f4ec842ff8341eb2d7c24d01" title="Client listen ports that we successfully connected to in the past.">M_ports</a>.begin(), port);
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159 <span class="comment"></span>
<a name="l00160"></a>00160 <span class="comment">  //! Set the IRC name of this server. Returns true when not set before.</span>
<a name="l00161"></a><a class="code" href="classServer.html#de5ffdc7bc02434b2942df386a0b5ec1">00161</a> <span class="comment"></span>  <span class="keywordtype">bool</span> <a class="code" href="classServer.html#de5ffdc7bc02434b2942df386a0b5ec1" title="Set the IRC name of this server. Returns true when not set before.">set_irc_name</a>(std::string <span class="keyword">const</span>&amp; irc_name)
<a name="l00162"></a>00162     {
<a name="l00163"></a>00163       <span class="keywordtype">bool</span> empty = <a class="code" href="classServer.html#f96de84fa0e0edffdf9136ccb73faa48" title="The IRC name of the server, as received by the proxy during connect.">M_irc_name</a>.empty();
<a name="l00164"></a>00164       <a class="code" href="classServer.html#f96de84fa0e0edffdf9136ccb73faa48" title="The IRC name of the server, as received by the proxy during connect.">M_irc_name</a> = irc_name;
<a name="l00165"></a>00165       <span class="keywordflow">return</span> empty;
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167 <span class="comment"></span>
<a name="l00168"></a>00168 <span class="comment">  //! IRC name of the server as set with set_irc_name.</span>
<a name="l00169"></a><a class="code" href="classServer.html#af5c0e7d9196b346a147e51655b7bcf9">00169</a> <span class="comment"></span>  std::string <span class="keyword">const</span>&amp; <a class="code" href="classServer.html#af5c0e7d9196b346a147e51655b7bcf9" title="IRC name of the server as set with set_irc_name.">get_irc_name</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classServer.html#f96de84fa0e0edffdf9136ccb73faa48" title="The IRC name of the server, as received by the proxy during connect.">M_irc_name</a>; }
<a name="l00170"></a>00170 <span class="comment"></span>
<a name="l00171"></a>00171 <span class="comment">  //! Last we attempted to connect to this server.</span>
<a name="l00172"></a><a class="code" href="classServer.html#32260f1f045bcbafbe6c8bf16ca868e1">00172</a> <span class="comment"></span>  timeval <span class="keyword">const</span>&amp; <a class="code" href="classServer.html#32260f1f045bcbafbe6c8bf16ca868e1" title="Last we attempted to connect to this server.">last_connection_event</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classServer.html#d774341f1d874886e08a1b1d2c3069bf" title="Last time we disconnected or tried to connect to this server.">M_last_connection_event</a>; }
<a name="l00173"></a>00173 <span class="comment"></span>
<a name="l00174"></a>00174 <span class="comment">  //! Called when a connect attempt to the server is being made.</span>
<a name="l00175"></a><a class="code" href="classServer.html#783109bcfd17252939c2928e1e4c2908">00175</a> <span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classServer.html#783109bcfd17252939c2928e1e4c2908" title="Called when a connect attempt to the server is being made.">attempting_to_connect</a>(<span class="keywordtype">void</span>)
<a name="l00176"></a>00176       {
<a name="l00177"></a>00177         <a class="code" href="classServer.html#a36e1abdc551a21b37a6ce5f03dd49d6" title="The port that we try to connect to.">M_port</a> = <a class="code" href="classServer.html#c6b4846c649fc6e1d21cec5968795c7d" title="The next port that we will try to connect to.">M_next_port</a>;
<a name="l00178"></a>00178         <a class="code" href="classServer.html#c6b4846c649fc6e1d21cec5968795c7d" title="The next port that we will try to connect to.">M_next_port</a> = <a class="code" href="classServer.html#41f4e78a93f414228a5deced8efdb018" title="Returns one of the ports of the server that one can connect to.">random_port</a>();
<a name="l00179"></a>00179         <a class="code" href="classServer.html#d774341f1d874886e08a1b1d2c3069bf" title="Last time we disconnected or tried to connect to this server.">M_last_connection_event</a> = timerRequest.get_now();
<a name="l00180"></a>00180       }
<a name="l00181"></a>00181 <span class="comment"></span>
<a name="l00182"></a>00182 <span class="comment">  //! Called when we disconnected from this server.</span>
<a name="l00183"></a><a class="code" href="classServer.html#ebe7d5998578035b8f4d4772626cf44f">00183</a> <span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="classServer.html#ebe7d5998578035b8f4d4772626cf44f" title="Called when we disconnected from this server.">connection_lost</a>(<span class="keywordtype">void</span>) { <a class="code" href="classServer.html#d774341f1d874886e08a1b1d2c3069bf" title="Last time we disconnected or tried to connect to this server.">M_last_connection_event</a> = timerRequest.get_now(); }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185   <span class="keywordtype">void</span> <a class="code" href="classServer.html#21af89ae8ffd6d40fac1d680035639c9" title="Serialize object to XML.">serialize</a>(<a class="code" href="classPersistXML.html" title="A persistent object archiver.">PersistXML</a>&amp; xml);
<a name="l00186"></a>00186 };
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="preprocessor">#endif // SERVER_H</span>
</pre></div></div>
<hr>

<TABLE WIDTH=100% BORDER=0 CELLSPACING=0 CELLPADDING=0>
<TR>
<TH ALIGN=left BGCOLOR="#e8feff"><ADDRESS>Copyright &copy; 2005-2007 Carlo Wood.&nbsp; All rights reserved.</ADDRESS></TH>
</TR>
</TABLE>

</DIV>
</BODY>
</HTML>

