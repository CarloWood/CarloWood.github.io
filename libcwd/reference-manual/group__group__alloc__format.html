<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML LANG="en-us">
<HEAD>
<META name="Author" content="Carlo Wood">
<META name="description" content="C++ debugging support library with ostream debug output">
<META name="keywords" content="libcwd, debug output, debug facility, debug channel, object orientation, OO, C++, nested debug output, ostream, memory allocation, debugging, source file and line number">
<META http-equiv="content-type" content="text/html; charset=iso-8859-1">
<META http-equiv="content-script-type" content="text/javascript">
<TITLE>libcwd: The C++ Debugging Support Library - Reference Manual</TITLE>
<SCRIPT src="../scripts/detect_browser.js"></SCRIPT>
<SCRIPT>need_style_doxygen=1</SCRIPT>
<SCRIPT src="../scripts/load_style_sheets.js"></SCRIPT>
</HEAD>
<BODY>
<DIV class="normal">
<center>
<a class="qindex" href="../index.html">Main Page</a> &nbsp;
<a class="qindex" href="index.html">Reference Manual</a> &nbsp;
<a class="qindex" href="namespaces.html">Namespace List</a> &nbsp;
<a class="qindex" href="annotated.html">Compound List</a> &nbsp;
<a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp;
<a class="qindex" href="functions.html">Compound Members</a> &nbsp;
<a class="qindex" href="globals.html">File Members</a> &nbsp;
</center>
<HR SIZE=1 NOSHADE>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a>  </div>
  <div class="headertitle">
<div class="title">Format Of The Overview Of Allocated Memory<div class="ingroups"><a class="el" href="group__book__allocations.html">Memory Allocation Debug Support</a> &raquo; <a class="el" href="group__group__overview.html">Overview Of Allocated Memory</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Format Of The Overview Of Allocated Memory:</div>
<div class="dyncontent">
<div class="center"><img src="group__group__alloc__format.png" border="0" usemap="#agroup____group____alloc____format" alt=""/></div>
<map name="agroup____group____alloc____format" id="agroup____group____alloc____format">
<area shape="rect" href="group__group__overview.html" title=" " alt="" coords="5,5,173,45"/>
<area shape="rect" title=" " alt="" coords="221,5,403,45"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gaf6d599b2243eee3c6b815d47847841a8"><td class="memItemLeft" align="right" valign="top"><a id="gaf6d599b2243eee3c6b815d47847841a8"></a>
typedef unsigned short int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__alloc__format.html#gaf6d599b2243eee3c6b815d47847841a8">libcwd::alloc_format_t</a></td></tr>
<tr class="memdesc:gaf6d599b2243eee3c6b815d47847841a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">The type used for the formatting flags of an alloc_filter_ct object. <br /></td></tr>
<tr class="separator:gaf6d599b2243eee3c6b815d47847841a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><hr  />
<h2>Detailed Description</h2>
The format of the <a class="el" href="group__group__overview.html">Overview Of Allocated Memory </a> can be altered and/or the content can be filtered by passing an object of type libcwd::alloc_filter_ct to the function <a class="el" href="group__group__overview.html#ga14575b33a03ebfcf9825320cf2d12aea">libcwd::list_allocations_on</a>. This object is constructed out of <code>alloc_format_t</code> constants which act as bits in a bit-mask.It is possible to include the time at which each allocation was made by passing the bit <code>show_time</code>. This will prepend "hours:minutes:seconds.microseconds" to the output:<div class="fragment"><div class="line">04:07:16.712874 <a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">malloc</a>    0x8078648          alloctag.cc:65   <span class="keywordtype">void</span>*; (sz = 220)</div>
<div class="ttc" id="agroup__group__default__dc_html_ga104365cb3a621bb5e2683ffda2da5919"><div class="ttname"><a href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">libcwd::channels::dc::malloc</a></div><div class="ttdeci">channel_ct malloc</div><div class="ttdef"><b>Definition:</b> debug.cc:474</div></div>
</div><!-- fragment -->It is also possible to show the full path of the location file by passing the bit <code>show_path</code>. This makes the output look like:<div class="fragment"><div class="line"><a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">malloc</a>    0x8078648 /home/carlo/c++/<a class="code" href="namespacelibcwd.html">libcwd</a>/testsuite/<a class="code" href="namespacelibcwd.html">libcwd</a>.tst/alloctag.cc:65   <span class="keywordtype">void</span>*; (sz = 220)</div>
<div class="ttc" id="anamespacelibcwd_html"><div class="ttname"><a href="namespacelibcwd.html">libcwd</a></div><div class="ttdoc">namespace for libcwd.</div><div class="ttdef"><b>Definition:</b> debug.cc:87</div></div>
</div><!-- fragment -->It is also possible to show the name of the object file (shared library or executable name) to which the allocation belongs by using the bit <code>show_objectfile</code>. The name of the corresponding object file is prepended to the location:<div class="fragment"><div class="line"><a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">malloc</a>    0x8078648 tst_alloctag_shared:         alloctag.cc:65   <span class="keywordtype">void</span>*; (sz = 220)</div>
</div><!-- fragment -->Finally, it is possible to show the mangled function name where the allocation was done by using the bit <code>show_function</code>. The mangled name of the corresponding function is prepended to the location:<div class="fragment"><div class="line"><span class="keyword">new</span>[]     0x8199158 _Z7new1000j           module.cc:47   <span class="keywordtype">char</span>[1000]; (sz = 1000)</div>
</div><!-- fragment -->The flags can be combined with the bit-wise OR operator.<b>Example:</b><div class="fragment"><div class="line"><span class="preprocessor">#ifdef CWDEBUG</span></div>
<div class="line">libcwd::alloc_filter_ct filter(libcwd::show_time | libcwd::show_path);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__overview.html#ga14575b33a03ebfcf9825320cf2d12aea">list_allocations_on</a>(libcw_do, filter) );</div>
<div class="ttc" id="adebug_8h_html_a40bdb8fcccb3c8293bd57ca9abef0dd7"><div class="ttname"><a href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a></div><div class="ttdeci">#define Debug(STATEMENTS...)</div><div class="ttdoc">Encapsulation macro for general debugging code.</div><div class="ttdef"><b>Definition:</b> debug.h:124</div></div>
<div class="ttc" id="agroup__group__overview_html_ga14575b33a03ebfcf9825320cf2d12aea"><div class="ttname"><a href="group__group__overview.html#ga14575b33a03ebfcf9825320cf2d12aea">libcwd::list_allocations_on</a></div><div class="ttdeci">unsigned long list_allocations_on(debug_ct &amp;debug_object)</div><div class="ttdoc">List all current allocations to a given debug object.</div><div class="ttdef"><b>Definition:</b> debugmalloc.cc:3020</div></div>
</div><!-- fragment --><b>Filtering</b>There are four criteria on which can be filtered: the time at which an allocation was made, the shared library that an allocation belongs too, the name of the source file from which an allocation was made and whether or not an AllocTag was used for the allocation.It is possible to give a time interval of the allocations that should be shown. For each of the limits (start and end) one can use the constant struct timeval libcwd::alloc_filter_ct::no_time_limit to indicate that there is no limit required.It is also possible to specify a list of wildcard masks (of the kind where a '*' matches anything) that will be matched against the names of the shared libraries, hiding the allocations that belong to the libraries whose name match.It is also possible to specify a list of wildcard masks (of the kind where a '*' matches anything) that will be matched against the names of the source file from which the allocation was done, only showing the allocations that whose name match.Finally, it is also possible to hide all allocations except when one of the <a class="el" href="group__group__annotation.html">AllocTag </a> macros was used. Please note that using this option makes it hard to see whether or not your application has any memory leaks in the case the leak has no <code>AllocTag</code> added.<b>Examples:</b>In order to show all allocations that were done one hour or more ago, one could do:<div class="fragment"><div class="line"><span class="preprocessor">#ifdef CWDEBUG</span></div>
<div class="line">libcwd::alloc_filter_ct filter(libcwd::show_time);</div>
<div class="line"><span class="keyword">struct </span>timeval end;</div>
<div class="line">gettimeofday(&amp;end, 0);</div>
<div class="line">end.tv_sec -= 3600;</div>
<div class="line">filter.set_time_interval(libcwd::alloc_filter_ct::no_time_limit, end);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__overview.html#ga14575b33a03ebfcf9825320cf2d12aea">list_allocations_on</a>(libcw_do, filter) );</div>
</div><!-- fragment -->In order to hide all allocations that belong to any shared library (only leaving the allocations that belong to the executable), one could do:<div class="fragment"><div class="line"><span class="preprocessor">#ifdef CWDEBUG</span></div>
<div class="line">libcwd::alloc_filter_ct filter(libcwd::show_objectfile);</div>
<div class="line">std::vector&lt;std::string&gt; masks;</div>
<div class="line">masks.push_back(<span class="stringliteral">&quot;lib*&quot;</span>);</div>
<div class="line">filter.hide_objectfiles_matching(masks);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__overview.html#ga14575b33a03ebfcf9825320cf2d12aea">list_allocations_on</a>(libcw_do, filter) );</div>
</div><!-- fragment -->In order to hide allocations done from a specific function in a specific shared library, one could do:<div class="fragment"><div class="line"><span class="preprocessor">#ifdef CWDEBUG</span></div>
<div class="line">libcwd::alloc_filter_ct filter(libcwd::show_objectfile|libcwd::show_function);</div>
<div class="line">std::vector&lt;std::pair&lt;std::string, std::string&gt; &gt; hide_list;</div>
<div class="line">hide_list.push_back(std::pair&lt;std::string, std::string&gt;(<span class="stringliteral">&quot;libdl.so.2&quot;</span>, <span class="stringliteral">&quot;_dlerror_run&quot;</span>));</div>
<div class="line">hide_list.push_back(std::pair&lt;std::string, std::string&gt;(<span class="stringliteral">&quot;libstdc++.so.6&quot;</span>, <span class="stringliteral">&quot;__cxa_get_globals&quot;</span>));</div>
<div class="line">filter.hide_functions_matching(hide_list);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__overview.html#ga14575b33a03ebfcf9825320cf2d12aea">list_allocations_on</a>(libcw_do, filter) );</div>
</div><!-- fragment -->Note that also here it is allowed to use masks, for both the object file as well as the mangled function name.In order to hide all allocations that are done from inside the header files of installed libraries (like the STL), one could do:<div class="fragment"><div class="line"><span class="preprocessor">#ifdef CWDEBUG</span></div>
<div class="line">libcwd::alloc_filter_ct filter(libcwd::show_path);</div>
<div class="line">std::vector&lt;std::string&gt; masks;</div>
<div class="line">masks.push_back(<span class="stringliteral">&quot;/usr/include/*.h&quot;</span>);</div>
<div class="line">filter.hide_sourcefiles_matching(masks);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__overview.html#ga14575b33a03ebfcf9825320cf2d12aea">list_allocations_on</a>(libcw_do, filter) );</div>
</div><!-- fragment -->In order to hide everything except those allocations that one explicitely added an <a class="el" href="group__group__annotation.html">AllocTag </a> for, one could do:<div class="fragment"><div class="line"><span class="preprocessor">#ifdef CWDEBUG</span></div>
<div class="line">libcwd::alloc_filter_ct filter;</div>
<div class="line">filter.hide_untagged_allocations();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__overview.html#ga14575b33a03ebfcf9825320cf2d12aea">list_allocations_on</a>(libcw_do, filter) );</div>
</div><!-- fragment --> </div></div><!-- contents -->
<ADDRESS>Copyright &copy; 2001 - 2004 Carlo Wood.&nbsp; All rights reserved.</ADDRESS>
</DIV>
</BODY>
</HTML>
