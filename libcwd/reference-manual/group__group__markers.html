<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML LANG="en-us">
<HEAD>
<META name="Author" content="Carlo Wood">
<META name="description" content="C++ debugging support library with ostream debug output">
<META name="keywords" content="libcwd, debug output, debug facility, debug channel, object orientation, OO, C++, nested debug output, ostream, memory allocation, debugging, source file and line number">
<META http-equiv="content-type" content="text/html; charset=iso-8859-1">
<META http-equiv="content-script-type" content="text/javascript">
<TITLE>libcwd: The C++ Debugging Support Library - Reference Manual</TITLE>
<SCRIPT src="../scripts/detect_browser.js"></SCRIPT>
<SCRIPT>need_style_doxygen=1</SCRIPT>
<SCRIPT src="../scripts/load_style_sheets.js"></SCRIPT>
</HEAD>
<BODY>
<DIV class="normal">
<center>
<a class="qindex" href="../index.html">Main Page</a> &nbsp;
<a class="qindex" href="index.html">Reference Manual</a> &nbsp;
<a class="qindex" href="namespaces.html">Namespace List</a> &nbsp;
<a class="qindex" href="annotated.html">Compound List</a> &nbsp;
<a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp;
<a class="qindex" href="functions.html">Compound Members</a> &nbsp;
<a class="qindex" href="globals.html">File Members</a> &nbsp;
</center>
<HR SIZE=1 NOSHADE>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Memory Allocation Markers: Memory Leak Checking<div class="ingroups"><a class="el" href="group__book__allocations.html">Memory Allocation Debug Support</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Memory Allocation Markers: Memory Leak Checking:</div>
<div class="dyncontent">
<div class="center"><img src="group__group__markers.png" border="0" usemap="#agroup____group____markers" alt=""/></div>
<map name="agroup____group____markers" id="agroup____group____markers">
<area shape="rect" title=" " alt="" coords="244,5,445,45"/>
<area shape="rect" href="group__book__allocations.html" title=" " alt="" coords="5,5,196,45"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibcwd_1_1marker__ct.html">libcwd::marker_ct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A memory allocation marker.  <a href="classlibcwd_1_1marker__ct.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga8e702bf97bd5d43575c4c1b24396df1d"><td class="memItemLeft" align="right" valign="top"><a id="ga8e702bf97bd5d43575c4c1b24396df1d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__markers.html#ga8e702bf97bd5d43575c4c1b24396df1d">libcwd::move_outside</a> (<a class="el" href="classlibcwd_1_1marker__ct.html">marker_ct</a> *marker, void const *void_ptr)</td></tr>
<tr class="memdesc:ga8e702bf97bd5d43575c4c1b24396df1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move memory allocation pointed to by <em>ptr</em> outside <em>marker</em>. <br /></td></tr>
<tr class="separator:ga8e702bf97bd5d43575c4c1b24396df1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><hr  />
<h2>Detailed Description</h2>
Libcwd does a weak attempt to support debugging of memory leaks.&#160; I hope to greatly improve this in the future.It is possible to mark allocations that are done till that moment, and then later check for memory leaks by expecting no other memory allocations than those that already existed before the mark.&#160; This is done by creating a marker_ct object.&#160; The check for memory leaks is done when the marker is removed again.&#160; This can be done recursively.A <em>marker</em> is created by passing it a description:<div class="fragment"><div class="line"><span class="preprocessor">#if CWDEBUG_MARKER</span></div>
<div class="line">  <a class="code" href="classlibcwd_1_1marker__ct.html">libcwd::marker_ct</a>* marker = <span class="keyword">new</span> <a class="code" href="classlibcwd_1_1marker__ct.html">libcwd::marker_ct</a>(<span class="stringliteral">&quot;Description of the marker&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="ttc" id="aclasslibcwd_1_1marker__ct_html"><div class="ttname"><a href="classlibcwd_1_1marker__ct.html">libcwd::marker_ct</a></div><div class="ttdoc">A memory allocation marker.</div><div class="ttdef"><b>Definition:</b> class_marker.h:33</div></div>
</div><!-- fragment -->Any allocation done <em>after</em> the creation of this marker will be reported as a <b>leak</b> at the moment the <em>marker</em> is deleted.Markers are clearly visible in the Allocated memory Overview.&#160; They are labeled MARKER (see also the <a href="group__group__overview.html#AMO_allocator">allocator type</a> table).&#160; All memory that is allocated after a <em>marker</em>, is displayed indented and below that marker in the Allocated memory Overview.Finally, it is possible to move specific memory blocks outside markers, so they will not cause a memory leak detection.&#160; This is done with the function<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespacelibcwd.html">libcwd</a> {</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="group__group__markers.html#ga8e702bf97bd5d43575c4c1b24396df1d">move_outside</a>(marker_ct* marker, <span class="keywordtype">void</span> <span class="keyword">const</span>* ptr);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__group__markers_html_ga8e702bf97bd5d43575c4c1b24396df1d"><div class="ttname"><a href="group__group__markers.html#ga8e702bf97bd5d43575c4c1b24396df1d">libcwd::move_outside</a></div><div class="ttdeci">void move_outside(marker_ct *marker, void const *void_ptr)</div><div class="ttdoc">Move memory allocation pointed to by ptr outside marker.</div><div class="ttdef"><b>Definition:</b> debugmalloc.cc:3487</div></div>
<div class="ttc" id="anamespacelibcwd_html"><div class="ttname"><a href="namespacelibcwd.html">libcwd</a></div><div class="ttdoc">namespace for libcwd.</div><div class="ttdef"><b>Definition:</b> debug.cc:87</div></div>
</div><!-- fragment -->which would move the memory allocation pointed to by <em>ptr</em> outside the test region of <em>marker</em>.A complete example program with output is given here:<div class="fragment"><div class="line"><span class="preprocessor">#ifndef _GNU_SOURCE</span></div>
<div class="line"><span class="preprocessor">#define _GNU_SOURCE</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sys_8h.html">libcwd/sys.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="debug_8h.html">libcwd/debug.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// A dummy class</span></div>
<div class="line"><span class="keyword">class </span>A {</div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line">  <span class="keywordtype">int</span> j;</div>
<div class="line">  <span class="keywordtype">char</span> k;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Don&#39;t show allocations that are allocated before main()</span></div>
<div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__invisible.html#gac086535865f146e706fb9d5e2959bd32">make_all_allocations_invisible_except</a>(NULL) );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Select channels</span></div>
<div class="line">  <a class="code" href="group__group__special.html#gadda3d19f06091c0f61a0e664e548f134">ForAllDebugChannels</a>( <span class="keywordflow">if</span> (debugChannel.is_on()) debugChannel.off() );</div>
<div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__default__dc.html#ga75332c24852742e646f1a05bc9c1e270">dc::notice</a>.on() );</div>
<div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">dc::malloc</a>.on() );</div>
<div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__default__dc.html#gaec68402e99fbc02d720bab71cef0d8d0">dc::warning</a>.on() );</div>
<div class="line">  <span class="comment">// Debug( dc::bfd.on() );</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Write debug output to cout</span></div>
<div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.<a class="code" href="group__group__destination.html#gad3186732962fa4d461489fbd0e891dc0">set_ostream</a>(&amp;cout) );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Turn debug object on</span></div>
<div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.<a class="code" href="classlibcwd_1_1debug__ct.html#ab551645032e1910ce51294797716ef58">on</a>() );</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Allocate new object</span></div>
<div class="line">  A* a1 = <span class="keyword">new</span> A;</div>
<div class="line">  AllocTag(a1, <span class="stringliteral">&quot;First created&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if CWDEBUG_MARKER</span></div>
<div class="line">  <span class="comment">// Create marker</span></div>
<div class="line">  <a class="code" href="classlibcwd_1_1marker__ct.html">libcwd::marker_ct</a>* marker = <span class="keyword">new</span> <a class="code" href="classlibcwd_1_1marker__ct.html">libcwd::marker_ct</a>(<span class="stringliteral">&quot;A test marker&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Allocate more objects</span></div>
<div class="line">  A* a2 = <span class="keyword">new</span> A[10];</div>
<div class="line">  AllocTag(a2, <span class="stringliteral">&quot;Created after the marker&quot;</span>);</div>
<div class="line">  <span class="keywordtype">int</span>* p = <span class="keyword">new</span> <span class="keywordtype">int</span>[30];</div>
<div class="line">  AllocTag(p, <span class="stringliteral">&quot;Created after the marker&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Show Memory Allocation Overview</span></div>
<div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__overview.html#ga14575b33a03ebfcf9825320cf2d12aea">list_allocations_on</a>(libcw_do) );</div>
<div class="line"> </div>
<div class="line">  <a class="code" href="debug_8h.html#a345365647bad2709dac5955a83d33aa3">Dout</a>(<a class="code" href="group__group__default__dc.html#ga75332c24852742e646f1a05bc9c1e270">dc::notice</a>, <span class="stringliteral">&quot;Moving the int array outside of the marker...&quot;</span>);</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_MARKER</span></div>
<div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__markers.html#ga8e702bf97bd5d43575c4c1b24396df1d">move_outside</a>(marker, p) );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Show Memory Allocation Overview</span></div>
<div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="group__group__overview.html#ga14575b33a03ebfcf9825320cf2d12aea">list_allocations_on</a>(libcw_do) );</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if CWDEBUG_MARKER</span></div>
<div class="line">  <span class="comment">// Delete the marker</span></div>
<div class="line">  <span class="keyword">delete</span> marker;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">  <a class="code" href="debug_8h.html#a345365647bad2709dac5955a83d33aa3">Dout</a>(<a class="code" href="group__group__default__dc.html#ga75332c24852742e646f1a05bc9c1e270">dc::notice</a>, <span class="stringliteral">&quot;Finished successfully.&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#ga3f5c48783b250b79e642077534b52d7c">dc::fatal</a>, <span class="stringliteral">&quot;Please reconfigure libcwd with --enable-alloc.&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
<div class="ttc" id="aclasslibcwd_1_1debug__ct_html_ab551645032e1910ce51294797716ef58"><div class="ttname"><a href="classlibcwd_1_1debug__ct.html#ab551645032e1910ce51294797716ef58">libcwd::debug_ct::on</a></div><div class="ttdeci">void on()</div><div class="ttdoc">Cancel last call to off().</div><div class="ttdef"><b>Definition:</b> class_debug.inl:202</div></div>
<div class="ttc" id="adebug_8h_html"><div class="ttname"><a href="debug_8h.html">debug.h</a></div><div class="ttdoc">This is the main header file of libcwd.</div></div>
<div class="ttc" id="adebug_8h_html_a345365647bad2709dac5955a83d33aa3"><div class="ttname"><a href="debug_8h.html#a345365647bad2709dac5955a83d33aa3">Dout</a></div><div class="ttdeci">#define Dout(cntrl, data)</div><div class="ttdoc">Macro for writing debug output.</div><div class="ttdef"><b>Definition:</b> debug.h:154</div></div>
<div class="ttc" id="adebug_8h_html_a40bdb8fcccb3c8293bd57ca9abef0dd7"><div class="ttname"><a href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a></div><div class="ttdeci">#define Debug(STATEMENTS...)</div><div class="ttdoc">Encapsulation macro for general debugging code.</div><div class="ttdef"><b>Definition:</b> debug.h:124</div></div>
<div class="ttc" id="agroup__group__default__dc_html_ga104365cb3a621bb5e2683ffda2da5919"><div class="ttname"><a href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">libcwd::channels::dc::malloc</a></div><div class="ttdeci">channel_ct malloc</div><div class="ttdef"><b>Definition:</b> debug.cc:474</div></div>
<div class="ttc" id="agroup__group__default__dc_html_ga3f5c48783b250b79e642077534b52d7c"><div class="ttname"><a href="group__group__default__dc.html#ga3f5c48783b250b79e642077534b52d7c">libcwd::channels::dc::fatal</a></div><div class="ttdeci">fatal_channel_ct fatal</div><div class="ttdef"><b>Definition:</b> debug.cc:527</div></div>
<div class="ttc" id="agroup__group__default__dc_html_ga75332c24852742e646f1a05bc9c1e270"><div class="ttname"><a href="group__group__default__dc.html#ga75332c24852742e646f1a05bc9c1e270">libcwd::channels::dc::notice</a></div><div class="ttdeci">channel_ct notice</div><div class="ttdef"><b>Definition:</b> debug.cc:460</div></div>
<div class="ttc" id="agroup__group__default__dc_html_gaec68402e99fbc02d720bab71cef0d8d0"><div class="ttname"><a href="group__group__default__dc.html#gaec68402e99fbc02d720bab71cef0d8d0">libcwd::channels::dc::warning</a></div><div class="ttdeci">channel_ct warning</div><div class="ttdef"><b>Definition:</b> debug.cc:485</div></div>
<div class="ttc" id="agroup__group__destination_html_gad3186732962fa4d461489fbd0e891dc0"><div class="ttname"><a href="group__group__destination.html#gad3186732962fa4d461489fbd0e891dc0">libcwd::debug_ct::set_ostream</a></div><div class="ttdeci">void set_ostream(std::ostream *os)</div><div class="ttdoc">Set output device (single threaded applications).</div><div class="ttdef"><b>Definition:</b> debug.cc:2041</div></div>
<div class="ttc" id="agroup__group__fatal__output_html_gaa45bf8d78ed558bebec07438c4f8abf1"><div class="ttname"><a href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a></div><div class="ttdeci">#define DoutFatal(cntrl, data)</div><div class="ttdoc">Macro for writing fatal debug output to the default debug object libcw_do .</div><div class="ttdef"><b>Definition:</b> debug.h:164</div></div>
<div class="ttc" id="agroup__group__invisible_html_gac086535865f146e706fb9d5e2959bd32"><div class="ttname"><a href="group__group__invisible.html#gac086535865f146e706fb9d5e2959bd32">libcwd::make_all_allocations_invisible_except</a></div><div class="ttdeci">void make_all_allocations_invisible_except(void const *ptr)</div><div class="ttdoc">Make all current allocations invisible except the given pointer.</div><div class="ttdef"><b>Definition:</b> debugmalloc.cc:3219</div></div>
<div class="ttc" id="agroup__group__overview_html_ga14575b33a03ebfcf9825320cf2d12aea"><div class="ttname"><a href="group__group__overview.html#ga14575b33a03ebfcf9825320cf2d12aea">libcwd::list_allocations_on</a></div><div class="ttdeci">unsigned long list_allocations_on(debug_ct &amp;debug_object)</div><div class="ttdoc">List all current allocations to a given debug object.</div><div class="ttdef"><b>Definition:</b> debugmalloc.cc:3020</div></div>
<div class="ttc" id="agroup__group__special_html_gadda3d19f06091c0f61a0e664e548f134"><div class="ttname"><a href="group__group__special.html#gadda3d19f06091c0f61a0e664e548f134">ForAllDebugChannels</a></div><div class="ttdeci">#define ForAllDebugChannels(STATEMENT...)</div><div class="ttdoc">Looping over all debug channels.</div><div class="ttdef"><b>Definition:</b> debug.h:190</div></div>
<div class="ttc" id="anamespacelibcwd_html_a1b75e612b9e13134de69602543699370"><div class="ttname"><a href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcwd::libcw_do</a></div><div class="ttdeci">debug_ct libcw_do</div><div class="ttdoc">The default debug object.</div><div class="ttdef"><b>Definition:</b> debug.cc:429</div></div>
<div class="ttc" id="asys_8h_html"><div class="ttname"><a href="sys_8h.html">sys.h</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
<ADDRESS>Copyright &copy; 2001 - 2004 Carlo Wood.&nbsp; All rights reserved.</ADDRESS>
</DIV>
</BODY>
</HTML>
