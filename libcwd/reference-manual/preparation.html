<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML LANG="en-us">
<HEAD>
<META name="Author" content="Carlo Wood">
<META name="description" content="C++ debugging support library with ostream debug output">
<META name="keywords" content="libcwd, debug output, debug facility, debug channel, object orientation, OO, C++, nested debug output, ostream, memory allocation, debugging, source file and line number">
<META http-equiv="content-type" content="text/html; charset=iso-8859-1">
<META http-equiv="content-script-type" content="text/javascript">
<TITLE>libcwd: The C++ Debugging Support Library - Reference Manual</TITLE>
<SCRIPT src="../scripts/detect_browser.js"></SCRIPT>
<SCRIPT>need_style_doxygen=1</SCRIPT>
<SCRIPT src="../scripts/load_style_sheets.js"></SCRIPT>
</HEAD>
<BODY>
<DIV class="normal">
<center>
<a class="qindex" href="../index.html">Main Page</a> &nbsp;
<a class="qindex" href="index.html">Reference Manual</a> &nbsp;
<a class="qindex" href="namespaces.html">Namespace List</a> &nbsp;
<a class="qindex" href="annotated.html">Compound List</a> &nbsp;
<a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp;
<a class="qindex" href="functions.html">Compound Members</a> &nbsp;
<a class="qindex" href="globals.html">File Members</a> &nbsp;
</center>
<HR SIZE=1 NOSHADE>
<!-- Generated by Doxygen 1.9.1 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Preparation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="preparation_section"></a>
Preparation</h1>
<p>This page describes the preparations that you need to perform before starting to use libcwd in your applications source code.</p>
<h2><a class="anchor" id="installation"></a>
Step 1: Installing libcwd</h2>
<p>Binary distributions should be installed the usual way.</p>
<p>If you are installing libcwd from source then please read the  <A HREF="../external/INSTALL"> INSTALL </A>  file that is included in the source distribution.<br  />
 See also: <a class="el" href="group__group__configuration.html">Configuration Options And Macros</a></p>
<p><a class="anchor" id="preparation_step2"></a></p>
<h2><a class="anchor" id="header_files"></a>
Step 2: Creating the custom header files</h2>
<p>You need to add two custom header files to your application.<br  />
 The recommended names are "debug.h" and "<a class="code" href="#preparation_step2">sys.h</a>".</p>
<p>You can use the following templates for a quick start:</p>
<dl class="section user"><dt>sys.h example template</dt><dd><div class="fragment"><div class="line"><span class="comment">// sys.h</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This header file is included at the top of every source file,</span></div>
<div class="line"><span class="comment">// before any other header file.</span></div>
<div class="line"><span class="comment">// It is intended to add defines that are needed globally and</span></div>
<div class="line"><span class="comment">// to work around Operating System dependend incompatibilities.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// The following includes the libcwd related mandatory part,</span></div>
<div class="line"><span class="comment">// which must be included before any system header file is included!</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Piggy back on cwds.</span></div>
<div class="line"><span class="preprocessor">#include &quot;cwds/sys.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Add project specific parts here.</span></div>
</div><!-- fragment -->  &laquo;<A HREF="../external/sys.h">download</A>&raquo;</dd></dl>
<dl class="section user"><dt>debug.h example template</dt><dd><div class="fragment"><div class="line"><span class="comment">// Piggyback on cwds</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NAMESPACE_DEBUG myproject::debug</span></div>
<div class="line"><span class="preprocessor">#define NAMESPACE_DEBUG_START namespace myproject { namespace debug {</span></div>
<div class="line"><span class="preprocessor">#define NAMESPACE_DEBUG_END } }</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;cwds/debug.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Declare project-wide debug channels here, or in some other (more) appropriate header file.</span></div>
<div class="line">NAMESPACE_DEBUG_CHANNELS_START</div>
<div class="line"><span class="keyword">extern</span> channel_ct custom;</div>
<div class="line">NAMESPACE_DEBUG_CHANNELS_END</div>
<div class="line"> </div>
<div class="line"><span class="comment">// And define them in a .cpp file like:</span></div>
<div class="line"><span class="comment">//NAMESPACE_DEBUG_CHANNELS_START</span></div>
<div class="line"><span class="comment">//channel_ct custom(&quot;CUSTOM&quot;);</span></div>
<div class="line"><span class="comment">//NAMESPACE_DEBUG_CHANNELS_END</span></div>
</div><!-- fragment -->  &laquo;<A HREF="../external/debug.h">download</A>&raquo;</dd></dl>
<p>This debug.h file is for applications; for more detailed information and for information for library developers who want to use libcwd, please also read <a class="el" href="group__chapter__custom__debug__h.html">The Custom debug.h File</a>.</p>
<h2><a class="anchor" id="custom_debug_cc"></a>
Step 3: Creating the custom source file</h2>
<p>If you added one or more custom debug channels to your namespace <code>DEBUGCHANNELS</code> in your custom "debug.h", then of course you also need to add the definition somewhere.&#160; You can do that anywhere, or you could add a special source file for it.&#160;</p>
<dl class="section user"><dt>debug.cc example template</dt><dd><div class="fragment"><div class="line"><span class="comment">// $Header$</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Copyright (C) 2000 - 2004, by</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Carlo Wood, Run on IRC &lt;carlo@alinoe.com&gt;</span></div>
<div class="line"><span class="comment">// RSA-1024 0x624ACAD5 1997-01-26                    Sign &amp; Encrypt</span></div>
<div class="line"><span class="comment">// Fingerprint16 = 32 EC A7 B6 AC DB 65 A6  F6 F6 55 DD 1C DC FF 61</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This file may be distributed under the terms of the Q Public License</span></div>
<div class="line"><span class="comment">// version 1.0 as appearing in the file LICENSE.QPL included in the</span></div>
<div class="line"><span class="comment">// packaging of this file.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="sys_8h.html">sys.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="config_8h.html">libcwd/config.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE &amp;&amp; CWDEBUG_ALLOC &amp;&amp; __GNUC__ == 3</span></div>
<div class="line"><span class="comment">// This has to be very early (must not have been included elsewhere already).</span></div>
<div class="line"><span class="preprocessor">#define private public  </span><span class="comment">// Ugly, I know.</span></div>
<div class="line"><span class="preprocessor">#if (__GNUC__ == 3 &amp;&amp; __GNUC_MINOR__ &lt; 4)</span></div>
<div class="line"><span class="preprocessor">#include &lt;bits/stl_alloc.h&gt;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span>              <span class="comment">// Needed for getenv, needed by ext/pool_allocator.h.</span></div>
<div class="line"><span class="preprocessor">#include &lt;ext/pool_allocator.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#undef private</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// LIBCWD_THREAD_SAFE &amp;&amp; CWDEBUG_ALLOC</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;cerrno&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#ifdef HAVE_SYS_RESOURCE_H</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span>   <span class="comment">// Needed for setrlimit()</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/resource.h&gt;</span>       <span class="comment">// Needed for setrlimit()</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span>              <span class="comment">// Needed for _Exit() (C99)</span></div>
<div class="line"><span class="preprocessor">#include &lt;new&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;cwd_debug.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;macros.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="debug_8h.html">libcwd/debug.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="strerrno_8h.html">libcwd/strerrno.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="private__internal__stringbuf_8h.html">libcwd/private_internal_stringbuf.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="private__bufferstream_8h.html">libcwd/private_bufferstream.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;private_debug_stack.inl&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;libcwd/class_location.inl&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">int</span> <span class="keyword">raise</span>(int);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line"><span class="keyword">using</span> libcwd::_private_::rwlock_tct;</div>
<div class="line"><span class="keyword">using</span> libcwd::_private_::debug_objects_instance;</div>
<div class="line"><span class="keyword">using</span> libcwd::_private_::debug_channels_instance;</div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_ACQUIRE_WRITE_LOCK        rwlock_tct&lt;libcwd::_private_::debug_objects_instance&gt;::wrlock()</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_RELEASE_WRITE_LOCK        rwlock_tct&lt;libcwd::_private_::debug_objects_instance&gt;::wrunlock()</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_ACQUIRE_READ_LOCK         rwlock_tct&lt;libcwd::_private_::debug_objects_instance&gt;::rdlock()</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_RELEASE_READ_LOCK         rwlock_tct&lt;libcwd::_private_::debug_objects_instance&gt;::rdunlock()</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_ACQUIRE_READ2WRITE_LOCK   rwlock_tct&lt;libcwd::_private_::debug_objects_instance&gt;::rd2wrlock()</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_ACQUIRE_WRITE2READ_LOCK   rwlock_tct&lt;libcwd::_private_::debug_objects_instance&gt;::wr2rdlock()</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_ACQUIRE_WRITE_LOCK       rwlock_tct&lt;libcwd::_private_::debug_channels_instance&gt;::wrlock()</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_RELEASE_WRITE_LOCK       rwlock_tct&lt;libcwd::_private_::debug_channels_instance&gt;::wrunlock()</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_ACQUIRE_READ_LOCK        rwlock_tct&lt;libcwd::_private_::debug_channels_instance&gt;::rdlock()</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_RELEASE_READ_LOCK        rwlock_tct&lt;libcwd::_private_::debug_channels_instance&gt;::rdunlock()</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_ACQUIRE_READ2WRITE_LOCK  rwlock_tct&lt;libcwd::_private_::debug_channels_instance&gt;::rd2wrlock()</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_ACQUIRE_WRITE2READ_LOCK  rwlock_tct&lt;libcwd::_private_::debug_channels_instance&gt;::wr2rdlock()</span></div>
<div class="line"><span class="preprocessor">#define COMMA_IFTHREADS(x) ,x</span></div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">// !LIBCWD_THREAD_SAFE</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_ACQUIRE_WRITE_LOCK</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_RELEASE_WRITE_LOCK</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_ACQUIRE_READ_LOCK</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_RELEASE_READ_LOCK</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_ACQUIRE_READ2WRITE_LOCK</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_OBJECTS_ACQUIRE_WRITE2READ_LOCK</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_ACQUIRE_WRITE_LOCK</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_RELEASE_WRITE_LOCK</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_ACQUIRE_READ_LOCK</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_RELEASE_READ_LOCK</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_ACQUIRE_READ2WRITE_LOCK</span></div>
<div class="line"><span class="preprocessor">#define DEBUG_CHANNELS_ACQUIRE_WRITE2READ_LOCK</span></div>
<div class="line"><span class="preprocessor">#define COMMA_IFTHREADS(x)</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// !LIBCWD_THREAD_SAFE</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NEED_SUPRESSION_OF_MALLOC_AND_BFD (__GNUC__ == 3 &amp;&amp; \</span></div>
<div class="line"><span class="preprocessor">    ((__GNUC_MINOR__ == 2 &amp;&amp; __GNUC_PATCHLEVEL__ == 0) || \</span></div>
<div class="line"><span class="preprocessor">     (__GNUC_MINOR__ == 1 &amp;&amp; __GNUC_PATCHLEVEL__ == 1) || \</span></div>
<div class="line"><span class="preprocessor">     (__GNUC_MINOR__ == 0)))</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespacelibcwd.html">libcwd</a> {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>_private_ {</div>
<div class="line"> </div>
<div class="line"><span class="comment">// gcc 4.0 use mt_allocator.h as default, which doesn&#39;t use locks at all.</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE &amp;&amp; CWDEBUG_ALLOC &amp;&amp; __GNUC__ == 3</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if (__GNUC_MINOR__ == 4)</span></div>
<div class="line"><span class="preprocessor">#if (__GNUC_PATCHLEVEL__ &lt;= 1)</span></div>
<div class="line">__gnu_cxx::_STL_mutex_lock* pool_allocator_lock_symbol_ptr;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">__gthread_mutex_t* pool_allocator_lock_symbol_ptr;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// The following tries to take the &quot;node allocator&quot; lock -- the lock of the</span></div>
<div class="line"><span class="comment">// default allocator for threaded applications.</span></div>
<div class="line"><span class="keyword">inline</span></div>
<div class="line"><span class="keywordtype">bool</span> allocator_trylock()</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if (__GNUC_MINOR__ &lt; 4)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if !defined(__GTHREAD_MUTEX_INIT) &amp;&amp; defined(__GTHREAD_MUTEX_INIT_FUNCTION)</span></div>
<div class="line">  <span class="keywordflow">if</span> (!std::__default_alloc_template&lt;true, 0&gt;::_S_node_allocator_lock._M_init_flag)</div>
<div class="line">    std::__default_alloc_template&lt;true, 0&gt;::_S_node_allocator_lock._M_initialize();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> (__gthread_mutex_trylock(&amp;std::__default_alloc_template&lt;true, 0&gt;::_S_node_allocator_lock._M_lock) == 0);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">// __GNUC_MINOR__ == 4</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (!pool_allocator_lock_symbol_ptr)</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">  #if !defined(__GTHREAD_MUTEX_INIT) &amp;&amp; defined(__GTHREAD_MUTEX_INIT_FUNCTION)</span></div>
<div class="line"><span class="preprocessor">  #if (__GNUC_PATCHLEVEL__ &lt;= 1)</span></div>
<div class="line">    <span class="keywordflow">if</span> (!pool_allocator_lock_symbol_ptr-&gt;_M_init_flag)</div>
<div class="line">      pool_allocator_lock_symbol_ptr-&gt;_M_initialize();</div>
<div class="line"><span class="preprocessor">  #else</span></div>
<div class="line">  <span class="comment">// If the lock is not initialized, it should be initialized here.</span></div>
<div class="line"><span class="preprocessor">  #error &quot;Sorry, not implemented yet.&quot;</span></div>
<div class="line"><span class="preprocessor">  #endif</span></div>
<div class="line"><span class="preprocessor">  #endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if (__GNUC_PATCHLEVEL__ &lt;= 1)</span></div>
<div class="line">  <span class="keywordflow">return</span> (__gthread_mutex_trylock(&amp;pool_allocator_lock_symbol_ptr-&gt;_M_lock) == 0);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  <span class="keywordflow">return</span> (__gthread_mutex_trylock(pool_allocator_lock_symbol_ptr) == 0);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// __GNUC_MINOR__ == 4</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The following unlocks the node allocator.</span></div>
<div class="line"><span class="keyword">inline</span></div>
<div class="line"><span class="keywordtype">void</span> allocator_unlock()</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if (__GNUC_MINOR__ &lt; 4)</span></div>
<div class="line"><span class="preprocessor">#if !defined(__GTHREAD_MUTEX_INIT) &amp;&amp; defined(__GTHREAD_MUTEX_INIT_FUNCTION)</span></div>
<div class="line">  <span class="keywordflow">if</span> (!std::__default_alloc_template&lt;true, 0&gt;::_S_node_allocator_lock._M_init_flag)</div>
<div class="line">    std::__default_alloc_template&lt;true, 0&gt;::_S_node_allocator_lock._M_initialize();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  __gthread_mutex_unlock(&amp;std::__default_alloc_template&lt;true, 0&gt;::_S_node_allocator_lock._M_lock);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">// __GNUC_MINOR__ == 4</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if (__GNUC_PATCHLEVEL__ &lt;= 1)</span></div>
<div class="line">  __gthread_mutex_unlock(&amp;pool_allocator_lock_symbol_ptr-&gt;_M_lock);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  __gthread_mutex_unlock(pool_allocator_lock_symbol_ptr);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// __GNUC_MINOR__ == 4</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// LIBCWD_THREAD_SAFE &amp;&amp; CWDEBUG_ALLOC &amp;&amp; __GNUC__ == 3</span></div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace _private_</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using</span> _private_::set_alloc_checking_on;</div>
<div class="line">    <span class="keyword">using</span> _private_::set_alloc_checking_off;</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">    <span class="keyword">using</span> _private_::debug_message_st;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">class </span>buffer_ct : <span class="keyword">public</span> _private_::auto_internal_stringbuf {</div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">      <span class="keyword">typedef</span> pos_type streampos_t;</div>
<div class="line">      streampos_t position;</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      <span class="comment">// These two are protected by the ostream lock of a debug object.</span></div>
<div class="line">      <span class="keywordtype">bool</span> unfinished_already_printed;</div>
<div class="line">      <span class="keywordtype">bool</span> continued_needed;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      buffer_ct() : unfinished_already_printed(false), continued_needed(false) { }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      <span class="keywordtype">void</span> writeto(std::ostream* os LIBCWD_COMMA_TSD_PARAM, debug_ct&amp; debug_object,</div>
<div class="line">          <span class="keywordtype">bool</span> request_unfinished, <span class="keywordtype">bool</span> do_flush COMMA_IFTHREADS(<span class="keywordtype">bool</span> ends_on_newline)</div>
<div class="line">          COMMA_IFTHREADS(<span class="keywordtype">bool</span> possible_nonewline_cf));</div>
<div class="line">      <span class="keywordtype">void</span> store_position() {</div>
<div class="line">        position = this-&gt;pubseekoff(0, std::ios_base::cur, std::ios_base::out);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordtype">void</span> restore_position() {</div>
<div class="line">        this-&gt;pubseekpos(position, std::ios_base::out);</div>
<div class="line">        this-&gt;pubseekpos(0, std::ios_base::in);</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">        continued_needed = <span class="keyword">false</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      }</div>
<div class="line">      <span class="keywordtype">void</span> write_prefix_to(std::ostream* os)</div>
<div class="line">      {</div>
<div class="line">        streampos_t old_in_pos = this-&gt;pubseekoff(0, std::ios_base::cur, std::ios_base::in);</div>
<div class="line">        this-&gt;pubseekpos(0, std::ios_base::in);</div>
<div class="line">        os-&gt;put(this-&gt;sgetc());</div>
<div class="line">        <span class="keywordtype">int</span> size = position - std::streampos(0);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c = 1; c &lt; size; ++c)</div>
<div class="line">          os-&gt;put(this-&gt;snextc());</div>
<div class="line">        this-&gt;pubseekpos(old_in_pos, std::ios_base::in);</div>
<div class="line">      }</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> buffer_ct::writeto(std::ostream* os LIBCWD_COMMA_TSD_PARAM,</div>
<div class="line">#<span class="keywordflow">if</span> LIBCWD_THREAD_SAFE</div>
<div class="line">        debug_ct&amp; debug_object,</div>
<div class="line">#<span class="keywordflow">else</span></div>
<div class="line">        debug_ct&amp;,</div>
<div class="line">#endif</div>
<div class="line">        <span class="keywordtype">bool</span> request_unfinished, <span class="keywordtype">bool</span> do_flush COMMA_IFTHREADS(<span class="keywordtype">bool</span> ends_on_newline)</div>
<div class="line">        COMMA_IFTHREADS(<span class="keywordtype">bool</span> possible_nonewline_cf))</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// os                     : The ostream that we need to write to.</span></div>
<div class="line">      <span class="comment">// __libcwd_tsd           : The Thread Specific context.</span></div>
<div class="line">      <span class="comment">// debug_object           : The debug object context.</span></div>
<div class="line">      <span class="comment">// request_unfinished     : When set, then this thread is writing output that is interrupting</span></div>
<div class="line">      <span class="comment">//                          unfinished debug output of its own.</span></div>
<div class="line">      <span class="comment">// do_flush               : Flush the ostream after writing to it.</span></div>
<div class="line">      <span class="comment">// ends_on_newline        : This output ends on a newline.</span></div>
<div class="line">      <span class="comment">// possible_nonewline_cf  : When `ends_on_newline&#39; is false, then that was caused by the use of nonewline_cf.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE &amp;&amp; CWDEBUG_ALLOC &amp;&amp; __GNUC__ == 3</span></div>
<div class="line">      <span class="keyword">typedef</span> debug_message_st* msgbuf_t;</div>
<div class="line">      msgbuf_t msgbuf;</div>
<div class="line">      <span class="comment">// Queue the message when the default (STL) allocator is locked and it could be that we</span></div>
<div class="line">      <span class="comment">// did that (because we got here via malloc or free).  At least as important: if</span></div>
<div class="line">      <span class="comment">// this is the last thread, just prior to exiting the application, and we CAN</span></div>
<div class="line">      <span class="comment">// get the lock - then DON&#39;T queue the message (and thus flush all possibly queued</span></div>
<div class="line">      <span class="comment">// messages); this garantees that there will never messages be left in the queue</span></div>
<div class="line">      <span class="comment">// when the application exits.</span></div>
<div class="line">      <span class="keywordtype">bool</span> <span class="keyword">const</span> queue_msg = __libcwd_tsd.inside_malloc_or_free &amp;&amp; !_private_::allocator_trylock();</div>
<div class="line">      <span class="keywordflow">if</span> (__libcwd_tsd.inside_malloc_or_free &amp;&amp; !queue_msg)</div>
<div class="line">        _private_::allocator_unlock();  <span class="comment">// Always immedeately release the lock again.</span></div>
<div class="line">      <span class="keywordtype">int</span> <span class="keyword">const</span> extra_size = <span class="keyword">sizeof</span>(debug_message_st) - <span class="keyword">sizeof</span>(msgbuf-&gt;buf);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      <span class="keyword">typedef</span> <span class="keywordtype">char</span>* msgbuf_t;</div>
<div class="line">      msgbuf_t msgbuf;</div>
<div class="line">      <span class="keywordtype">bool</span> <span class="keyword">const</span> queue_msg = <span class="keyword">false</span>;</div>
<div class="line">      <span class="keywordtype">int</span> <span class="keyword">const</span> extra_size = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      <span class="keywordtype">int</span> curlen;</div>
<div class="line">      curlen = this-&gt;pubseekoff(0, std::ios_base::cur, std::ios_base::out) - this-&gt;pubseekoff(0, std::ios_base::cur, std::ios_base::in);</div>
<div class="line">      <span class="keywordtype">bool</span> free_msgbuf = <span class="keyword">false</span>;</div>
<div class="line">      <span class="keywordflow">if</span> (queue_msg)</div>
<div class="line">        msgbuf = (msgbuf_t)<a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">malloc</a>(curlen + extra_size);</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curlen &gt; 512 || !(msgbuf = (msgbuf_t)__builtin_alloca(curlen + extra_size)))</div>
<div class="line">      {</div>
<div class="line">        msgbuf = (msgbuf_t)<a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">malloc</a>(curlen + extra_size);</div>
<div class="line">        free_msgbuf = <span class="keyword">true</span>;</div>
<div class="line">      }</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE &amp;&amp; CWDEBUG_ALLOC &amp;&amp; __GNUC__ == 3</span></div>
<div class="line">      this-&gt;sgetn(msgbuf-&gt;buf, curlen);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      this-&gt;sgetn(msgbuf, curlen);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE &amp;&amp; CWDEBUG_ALLOC &amp;&amp; __GNUC__ == 3</span></div>
<div class="line">      <span class="keywordflow">if</span> (queue_msg)    <span class="comment">// Inside a call to malloc and possibly owning lock of std::LIBCWD_POOL_ALLOC&lt;true, 0&gt;?</span></div>
<div class="line">      {</div>
<div class="line">        <span class="comment">// We don&#39;t write debug output to the final ostream when inside malloc and std::LIBCWD_POOL_ALLOC&lt;true, 0&gt; is locked.</span></div>
<div class="line">        <span class="comment">// It is namely possible that this will again try to acquire the lock in std::LIBCWD_POOL_ALLOC&lt;true, 0&gt;, resulting</span></div>
<div class="line">        <span class="comment">// in a deadlock.  Append it to the queue instead.</span></div>
<div class="line">        msgbuf-&gt;curlen = curlen;</div>
<div class="line">        msgbuf-&gt;prev = NULL;</div>
<div class="line">        msgbuf-&gt;next = debug_object.queue;</div>
<div class="line">        <span class="keywordflow">if</span> (debug_object.queue)</div>
<div class="line">          debug_object.queue-&gt;prev = msgbuf;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          debug_object.queue_top = msgbuf;</div>
<div class="line">        debug_object.queue = msgbuf;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">        <span class="comment">// Writing to the final std::ostream (ie std::cerr) must be non-internal!</span></div>
<div class="line">        <span class="comment">// LIBCWD_DISABLE_CANCEL/LIBCWD_ENABLE_CANCEL must be done non-internal too.</span></div>
<div class="line">        <span class="keywordtype">int</span> saved_internal = _private_::set_library_call_on(LIBCWD_TSD);</div>
<div class="line">        ++LIBCWD_DO_TSD_MEMBER_OFF(<a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">        LIBCWD_DISABLE_CANCEL;                  <span class="comment">// We don&#39;t want Dout() to be a cancellation point.</span></div>
<div class="line">        _private_::mutex_tct&lt;_private_::set_ostream_instance&gt;::lock();</div>
<div class="line">        <span class="keywordtype">bool</span> got_lock = debug_object.M_mutex;</div>
<div class="line">        <span class="keywordflow">if</span> (got_lock)</div>
<div class="line">        {</div>
<div class="line">          debug_object.M_mutex-&gt;lock();</div>
<div class="line">          __libcwd_tsd.pthread_lock_interface_is_locked = <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">        std::ostream* locked_os = os;</div>
<div class="line">        _private_::mutex_tct&lt;_private_::set_ostream_instance&gt;::unlock();</div>
<div class="line">        <span class="keywordflow">if</span> (!got_lock &amp;&amp; _private_::WST_multi_threaded)</div>
<div class="line">        {</div>
<div class="line">          <span class="keyword">static</span> <span class="keywordtype">bool</span> WST_second_time = <span class="keyword">false</span>;  <span class="comment">// Break infinite loop.</span></div>
<div class="line">          <span class="keywordflow">if</span> (!WST_second_time)</div>
<div class="line">          {</div>
<div class="line">            WST_second_time = <span class="keyword">true</span>;</div>
<div class="line">            <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;When using multiple threads, you must provide a locking mechanism for the debug output stream.  &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;You can pass a pointer to a mutex with `debug_ct::set_ostream&#39; (see documentation/reference-manual/group__group__destination.html).&quot;</span>);</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">        <span class="keywordflow">if</span> (debug_object.newlineless_tsd &amp;&amp; debug_object.newlineless_tsd != &amp;__libcwd_tsd)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">if</span> (debug_object.unfinished_oss)</div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">if</span> (debug_object.unfinished_oss != <span class="keyword">this</span>)</div>
<div class="line">            {</div>
<div class="line">              locked_os-&gt;write(<span class="stringliteral">&quot;&lt;unfinished&gt;\n&quot;</span>, 13);</div>
<div class="line">              debug_object.unfinished_oss-&gt;unfinished_already_printed = <span class="keyword">true</span>;</div>
<div class="line">              debug_object.unfinished_oss-&gt;continued_needed = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            locked_os-&gt;write(<span class="stringliteral">&quot;&lt;no newline&gt;\n&quot;</span>, 13);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (continued_needed &amp;&amp; curlen &gt; 0)</div>
<div class="line">        {</div>
<div class="line">          continued_needed = <span class="keyword">false</span>;</div>
<div class="line">          write_prefix_to(locked_os);</div>
<div class="line">          locked_os-&gt;write(<span class="stringliteral">&quot;&lt;continued&gt; &quot;</span>, 12);</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// LIBCWD_THREAD_SAFE</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE &amp;&amp; CWDEBUG_ALLOC &amp;&amp; __GNUC__ == 3</span></div>
<div class="line">        debug_message_st* message = debug_object.queue_top;</div>
<div class="line">        <span class="keywordflow">if</span> (message)</div>
<div class="line">        {</div>
<div class="line">          <span class="comment">// First empty the whole queue.</span></div>
<div class="line">          debug_message_st* next_message;</div>
<div class="line">          <span class="keywordflow">do</span></div>
<div class="line">          {</div>
<div class="line">            next_message = message-&gt;prev;</div>
<div class="line">            locked_os-&gt;write(message-&gt;buf, message-&gt;curlen);</div>
<div class="line">            __libcwd_tsd.internal = 1;</div>
<div class="line">            free(message);</div>
<div class="line">            __libcwd_tsd.internal = 0;</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">while</span> ((message = next_message));</div>
<div class="line">          debug_object.queue_top = debug_object.queue = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Then write the new message.</span></div>
<div class="line">        locked_os-&gt;write(msgbuf-&gt;buf, curlen);</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">// !(CWDEBUG_ALLOC &amp;&amp; LIBCWD_THREAD_SAFE)</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">        locked_os-&gt;write(msgbuf, curlen);</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">// !LIBCWD_THREAD_SAFE</span></div>
<div class="line">        os-&gt;write(msgbuf, curlen);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// !LIBCWD_THREAD_SAFE</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// !(CWDEBUG_ALLOC &amp;&amp; LIBCWD_THREAD_SAFE)</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">        <span class="keywordflow">if</span> (request_unfinished &amp;&amp; !unfinished_already_printed)</div>
<div class="line">          locked_os-&gt;write(<span class="stringliteral">&quot;&lt;unfinished&gt;\n&quot;</span>, 13);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        <span class="keywordflow">if</span> (request_unfinished)</div>
<div class="line">          os-&gt;write(<span class="stringliteral">&quot;&lt;unfinished&gt;\n&quot;</span>, 13);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        <span class="keywordflow">if</span> (do_flush)</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">          locked_os-&gt;flush();</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">          os-&gt;flush();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">        unfinished_already_printed = ends_on_newline;</div>
<div class="line">        <span class="keywordflow">if</span> (ends_on_newline)</div>
<div class="line">        {</div>
<div class="line">          debug_object.unfinished_oss = NULL;</div>
<div class="line">          debug_object.newlineless_tsd = NULL;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curlen &gt; 0)</div>
<div class="line">        {</div>
<div class="line">          debug_object.newlineless_tsd = &amp;__libcwd_tsd;</div>
<div class="line">          <span class="keywordflow">if</span> (possible_nonewline_cf)</div>
<div class="line">            debug_object.unfinished_oss = NULL;</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            debug_object.unfinished_oss = <span class="keyword">this</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (got_lock)</div>
<div class="line">        {</div>
<div class="line">          __libcwd_tsd.pthread_lock_interface_is_locked = <span class="keyword">false</span>;</div>
<div class="line">          debug_object.M_mutex-&gt;unlock();</div>
<div class="line">        }</div>
<div class="line">        LIBCWD_ENABLE_CANCEL;</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// !LIBCWD_THREAD_SAFE</span></div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">        --LIBCWD_DO_TSD_MEMBER_OFF(<a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>);</div>
<div class="line">        _private_::set_library_call_off(saved_internal LIBCWD_COMMA_TSD);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE &amp;&amp; CWDEBUG_ALLOC &amp;&amp; __GNUC__ == 3</span></div>
<div class="line">      }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      <span class="keywordflow">if</span> (free_msgbuf)</div>
<div class="line">        free(msgbuf);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Configuration signature</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keyword">const</span> config_signature_lib_c = config_signature_header_c;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Return the configuration signature of the .so file.</span></div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> get_config_signature_lib_c()</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">return</span> config_signature_lib_c;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Put this here to decrease the code size of `check_configuration&#39;</span></div>
<div class="line">    <span class="keywordtype">void</span> conf_check_failed()</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#ga3f5c48783b250b79e642077534b52d7c">dc::fatal</a>, <span class="stringliteral">&quot;check_configuration: This version of libcwd was compiled with a different configuration than is currently used in libcwd/config.h!&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> version_check_failed()</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#ga3f5c48783b250b79e642077534b52d7c">dc::fatal</a>, <span class="stringliteral">&quot;check_configuration: This version of libcwd does not match the version of libcwd/config.h! Are your paths correct? Did you recently upgrade libcwd and forgot to recompile this application?&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    debug_ct <a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">namespace </span>{</div>
<div class="line">      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> WST_max_len = 8;       <span class="comment">// The length of the longest label.  Is adjusted automatically</span></div>
<div class="line">                                                <span class="comment">// if a custom channel has a longer label.</span></div>
<div class="line">    } <span class="comment">// namespace</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">namespace </span>channels {</div>
<div class="line">      <span class="keyword">namespace </span>dc {</div>
<div class="line"> </div>
<div class="line">        channel_ct <a class="code" href="group__group__default__dc.html#gac0005e6a66a3a30b9e0df12b8efb38f7">debug</a></div>
<div class="line"><span class="preprocessor">#ifndef HIDE_FROM_DOXYGEN</span></div>
<div class="line">            (<span class="stringliteral">&quot;DEBUG&quot;</span>)</div>
<div class="line">#endif</div>
<div class="line">            ;</div>
<div class="line"> </div>
<div class="line">        channel_ct <a class="code" href="group__group__default__dc.html#ga75332c24852742e646f1a05bc9c1e270">notice</a></div>
<div class="line"><span class="preprocessor">#ifndef HIDE_FROM_DOXYGEN</span></div>
<div class="line">           (<span class="stringliteral">&quot;NOTICE&quot;</span>)</div>
<div class="line">#endif</div>
<div class="line">           ;</div>
<div class="line"> </div>
<div class="line">        channel_ct <a class="code" href="group__group__default__dc.html#ga06f27a7560f652ec93e140b967ffbd58">system</a></div>
<div class="line"><span class="preprocessor">#ifndef HIDE_FROM_DOXYGEN</span></div>
<div class="line">            (<span class="stringliteral">&quot;SYSTEM&quot;</span>)</div>
<div class="line">#endif</div>
<div class="line">            ;</div>
<div class="line"> </div>
<div class="line">        channel_ct <a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">malloc</a></div>
<div class="line"><span class="preprocessor">#ifndef HIDE_FROM_DOXYGEN</span></div>
<div class="line">            (<span class="stringliteral">&quot;MALLOC&quot;</span>)</div>
<div class="line">#endif</div>
<div class="line">            ;</div>
<div class="line"> </div>
<div class="line">        channel_ct <a class="code" href="group__group__default__dc.html#gaec68402e99fbc02d720bab71cef0d8d0">warning</a></div>
<div class="line"><span class="preprocessor">#ifndef HIDE_FROM_DOXYGEN</span></div>
<div class="line">            (<span class="stringliteral">&quot;WARNING&quot;</span>)</div>
<div class="line">#endif</div>
<div class="line">            ;</div>
<div class="line"> </div>
<div class="line">        always_channel_ct <a class="code" href="group__group__default__dc.html#gaddaee3d6d01f64f1ded1d346bdbcad4e">always</a>;</div>
<div class="line"> </div>
<div class="line">        continued_channel_ct <a class="code" href="group__group__default__dc.html#ga7ddfec3fc9aa18c556a62f7d820c74e1">continued</a></div>
<div class="line"><span class="preprocessor">#ifndef HIDE_FROM_DOXYGEN</span></div>
<div class="line">            (continued_maskbit)</div>
<div class="line">#endif</div>
<div class="line">            ;</div>
<div class="line"> </div>
<div class="line">        continued_channel_ct <a class="code" href="group__group__default__dc.html#ga33bc4b6cb3a23b09521bfa69e0da3e7c">finish</a></div>
<div class="line"><span class="preprocessor">#ifndef HIDE_FROM_DOXYGEN</span></div>
<div class="line">            (finish_maskbit)</div>
<div class="line">#endif</div>
<div class="line">            ;</div>
<div class="line"> </div>
<div class="line">        fatal_channel_ct <a class="code" href="group__group__default__dc.html#ga3f5c48783b250b79e642077534b52d7c">fatal</a></div>
<div class="line"><span class="preprocessor">#ifndef HIDE_FROM_DOXYGEN</span></div>
<div class="line">            (<span class="stringliteral">&quot;FATAL&quot;</span>, fatal_maskbit)</div>
<div class="line">#endif</div>
<div class="line">            ;</div>
<div class="line"> </div>
<div class="line">        fatal_channel_ct <a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">core</a></div>
<div class="line"><span class="preprocessor">#ifndef HIDE_FROM_DOXYGEN</span></div>
<div class="line">            (<span class="stringliteral">&quot;COREDUMP&quot;</span>, coredump_maskbit)</div>
<div class="line">#endif</div>
<div class="line">            ;</div>
<div class="line"> </div>
<div class="line">      } <span class="comment">// namespace dc</span></div>
<div class="line">    } <span class="comment">// namespace channels</span></div>
<div class="line"> </div>
<div class="line">    channel_ct <span class="keyword">const</span> channel_ct::off_channel</div>
<div class="line"><span class="preprocessor">#ifndef HIDE_FROM_DOXYGEN</span></div>
<div class="line">        (<span class="stringliteral">&quot;!NEVER!&quot;</span>, <span class="keyword">false</span>)</div>
<div class="line">#endif</div>
<div class="line">        ;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if CWDEBUG_LOCATION</span></div>
<div class="line">    <span class="keyword">namespace </span>cwbfd {</div>
<div class="line">      <span class="keyword">extern</span> <span class="keywordtype">bool</span> ST_init(LIBCWD_TSD_PARAM);</div>
<div class="line">    } <span class="comment">// namespace cwbfd</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> ST_initialize_globals(LIBCWD_TSD_PARAM)</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">bool</span> ST_already_called;</div>
<div class="line">      <span class="keywordflow">if</span> (ST_already_called)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      ST_already_called = <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">      init_debugmalloc();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      _private_::initialize_global_mutexes();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      _private_::process_environment_variables();</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Fatal channels need to be marked fatal, otherwise we get into an endless loop</span></div>
<div class="line">      <span class="comment">// when they are used before they are created.</span></div>
<div class="line">      <a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">channels::dc::core</a>.NS_initialize(<span class="stringliteral">&quot;COREDUMP&quot;</span>, coredump_maskbit LIBCWD_COMMA_TSD);</div>
<div class="line">      <a class="code" href="group__group__default__dc.html#ga3f5c48783b250b79e642077534b52d7c">channels::dc::fatal</a>.NS_initialize(<span class="stringliteral">&quot;FATAL&quot;</span>, fatal_maskbit LIBCWD_COMMA_TSD);</div>
<div class="line">      <span class="comment">// Initialize other debug channels that might be used before we reach main().</span></div>
<div class="line">      <a class="code" href="group__group__default__dc.html#gac0005e6a66a3a30b9e0df12b8efb38f7">channels::dc::debug</a>.NS_initialize(<span class="stringliteral">&quot;DEBUG&quot;</span> LIBCWD_COMMA_TSD, <span class="keyword">true</span>);</div>
<div class="line">      <a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">channels::dc::malloc</a>.NS_initialize(<span class="stringliteral">&quot;MALLOC&quot;</span> LIBCWD_COMMA_TSD, <span class="keyword">true</span>);</div>
<div class="line">      <a class="code" href="group__group__default__dc.html#ga7ddfec3fc9aa18c556a62f7d820c74e1">channels::dc::continued</a>.NS_initialize(continued_maskbit);</div>
<div class="line">      <a class="code" href="group__group__default__dc.html#ga33bc4b6cb3a23b09521bfa69e0da3e7c">channels::dc::finish</a>.NS_initialize(finish_maskbit);</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_LOCATION</span></div>
<div class="line">      <a class="code" href="group__group__default__dc.html#ga1a335257af682a5f32ac33fd583fcbd1">channels::dc::bfd</a>.NS_initialize(<span class="stringliteral">&quot;BFD&quot;</span> LIBCWD_COMMA_TSD, <span class="keyword">true</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      <span class="comment">// What the heck, initialize all other debug channels too</span></div>
<div class="line">      <a class="code" href="group__group__default__dc.html#gaec68402e99fbc02d720bab71cef0d8d0">channels::dc::warning</a>.NS_initialize(<span class="stringliteral">&quot;WARNING&quot;</span> LIBCWD_COMMA_TSD, <span class="keyword">true</span>);</div>
<div class="line">      <a class="code" href="group__group__default__dc.html#ga75332c24852742e646f1a05bc9c1e270">channels::dc::notice</a>.NS_initialize(<span class="stringliteral">&quot;NOTICE&quot;</span> LIBCWD_COMMA_TSD, <span class="keyword">true</span>);</div>
<div class="line">      <a class="code" href="group__group__default__dc.html#ga06f27a7560f652ec93e140b967ffbd58">channels::dc::system</a>.NS_initialize(<span class="stringliteral">&quot;SYSTEM&quot;</span> LIBCWD_COMMA_TSD, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (!<a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.NS_init(LIBCWD_TSD))        <span class="comment">// Initialize debug code.</span></div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;Calling debug_ct::NS_init recursively from ST_initialize_globals&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Unlimit core size.</span></div>
<div class="line"><span class="preprocessor">#ifdef RLIMIT_CORE</span></div>
<div class="line">      <span class="keyword">struct </span>rlimit corelim;</div>
<div class="line">      <span class="keywordflow">if</span> (getrlimit(RLIMIT_CORE, &amp;corelim))</div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#ga3f5c48783b250b79e642077534b52d7c">dc::fatal</a>|<a class="code" href="group__group__control__flags.html#gabd3b35330f68a89067c99df07928c486">error_cf</a>, <span class="stringliteral">&quot;getrlimit(RLIMIT_CORE, &amp;corelim)&quot;</span>);</div>
<div class="line">      corelim.rlim_cur = corelim.rlim_max;</div>
<div class="line">      <span class="keywordflow">if</span> (corelim.rlim_max != RLIM_INFINITY &amp;&amp; !_private_::suppress_startup_msgs)</div>
<div class="line">      {</div>
<div class="line">        debug_ct::OnOffState state;</div>
<div class="line">        <a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.force_on(state);</div>
<div class="line">        <span class="comment">// The cast is necessary on platforms where corelim.rlim_max is long long</span></div>
<div class="line">        <span class="comment">// and libstdc++ was not compiled with support for long long.</span></div>
<div class="line">        <a class="code" href="debug_8h.html#a345365647bad2709dac5955a83d33aa3">Dout</a>(<a class="code" href="group__group__default__dc.html#gaec68402e99fbc02d720bab71cef0d8d0">dc::warning</a>, <span class="stringliteral">&quot;core size is limited (hard limit: &quot;</span> &lt;&lt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(corelim.rlim_max / 1024) &lt;&lt; <span class="stringliteral">&quot; kb).  Core dumps might be truncated!&quot;</span>);</div>
<div class="line">        <a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.restore(state);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span> (setrlimit(RLIMIT_CORE, &amp;corelim))</div>
<div class="line">          <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#ga3f5c48783b250b79e642077534b52d7c">dc::fatal</a>|<a class="code" href="group__group__control__flags.html#gabd3b35330f68a89067c99df07928c486">error_cf</a>, <span class="stringliteral">&quot;unlimit core size failed&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      <span class="keywordflow">if</span> (!_private_::suppress_startup_msgs)</div>
<div class="line">      {</div>
<div class="line">        debug_ct::OnOffState state;</div>
<div class="line">        <a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.force_on(state);</div>
<div class="line">        <a class="code" href="debug_8h.html#a345365647bad2709dac5955a83d33aa3">Dout</a>(<a class="code" href="group__group__default__dc.html#gaec68402e99fbc02d720bab71cef0d8d0">dc::warning</a>, <span class="stringliteral">&quot;Please unlimit core size manually&quot;</span>);</div>
<div class="line">        <a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.restore(state);</div>
<div class="line">      }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if CWDEBUG_LOCATION</span></div>
<div class="line">      cwbfd::ST_init(LIBCWD_TSD);               <span class="comment">// Initialize BFD code.</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG &amp;&amp; !CWDEBUG_DEBUGOUTPUT</span></div>
<div class="line">      <span class="comment">// Force allocation of a __cxa_eh_globals struct in libsupc++.</span></div>
<div class="line">      (void)std::uncaught_exceptions();         <span class="comment">// Leaks memory.</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">namespace </span>_private_ {</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if !LIBCWD_THREAD_SAFE</span></div>
<div class="line">      TSD_st __libcwd_tsd;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      <span class="keyword">extern</span> <span class="keywordtype">bool</span> WST_is_NPTL;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">      debug_channels_ct debug_channels;         <span class="comment">// List with all channel_ct objects.</span></div>
<div class="line">      debug_objects_ct debug_objects;           <span class="comment">// List with all debug devices.</span></div>
<div class="line"> </div>
<div class="line">      <span class="comment">// _private_::</span></div>
<div class="line">      <span class="keywordtype">void</span> debug_channels_ct::init(LIBCWD_TSD_PARAM)</div>
<div class="line">      {</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">        _private_::rwlock_tct&lt;libcwd::_private_::debug_channels_instance&gt;::initialize();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        DEBUG_CHANNELS_ACQUIRE_READ_LOCK;</div>
<div class="line">        <span class="keywordflow">if</span> (!WNS_debug_channels)                        <span class="comment">// MT: `WNS_debug_channels&#39; is only false when this object is still Non_Shared.</span></div>
<div class="line">        {</div>
<div class="line">          DEBUG_CHANNELS_ACQUIRE_READ2WRITE_LOCK;</div>
<div class="line">          set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">          WNS_debug_channels = <span class="keyword">new</span> debug_channels_ct::container_type;           <span class="comment">// LEAK2</span></div>
<div class="line">          set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">          DEBUG_CHANNELS_RELEASE_WRITE_LOCK;</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          DEBUG_CHANNELS_RELEASE_READ_LOCK;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      <span class="comment">// _private_::</span></div>
<div class="line">      <span class="keywordtype">void</span> debug_channels_ct::init_and_rdlock()</div>
<div class="line">      {</div>
<div class="line">        _private_::rwlock_tct&lt;libcwd::_private_::debug_channels_instance&gt;::initialize();</div>
<div class="line">        DEBUG_CHANNELS_ACQUIRE_READ_LOCK;</div>
<div class="line">        <span class="keywordflow">if</span> (!WNS_debug_channels)                        <span class="comment">// MT: `WNS_debug_channels&#39; is only false when this object is still Non_Shared.</span></div>
<div class="line">        {</div>
<div class="line">          LIBCWD_TSD_DECLARATION;</div>
<div class="line">          set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">          DEBUG_CHANNELS_ACQUIRE_READ2WRITE_LOCK;</div>
<div class="line">          WNS_debug_channels = <span class="keyword">new</span> debug_channels_ct::container_type;           <span class="comment">// LEAK3</span></div>
<div class="line">          DEBUG_CHANNELS_ACQUIRE_WRITE2READ_LOCK;</div>
<div class="line">          set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">      <span class="comment">// _private_::</span></div>
<div class="line">      <span class="keywordtype">void</span> debug_objects_ct::init(LIBCWD_TSD_PARAM)</div>
<div class="line">      {</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">        _private_::rwlock_tct&lt;libcwd::_private_::debug_objects_instance&gt;::initialize();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        DEBUG_OBJECTS_ACQUIRE_READ_LOCK;</div>
<div class="line">        <span class="keywordflow">if</span> (!WNS_debug_objects)                         <span class="comment">// MT: `WNS_debug_objects&#39; is only false when this object is still Non_Shared.</span></div>
<div class="line">        {</div>
<div class="line">          DEBUGDEBUG_CERR( (<span class="keywordtype">char</span> <span class="keyword">const</span>*)<span class="stringliteral">&quot;_debug_objects == NULL; initializing it&quot;</span> );</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">          <span class="comment">// It is possible that malloc is not initialized yet.</span></div>
<div class="line">          init_debugmalloc();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">          DEBUG_OBJECTS_ACQUIRE_READ2WRITE_LOCK;</div>
<div class="line">          set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">          WNS_debug_objects = <span class="keyword">new</span> debug_objects_ct::container_type;</div>
<div class="line">          set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">          DEBUG_OBJECTS_RELEASE_WRITE_LOCK;</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          DEBUG_OBJECTS_RELEASE_READ_LOCK;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      <span class="comment">// _private_::</span></div>
<div class="line">      <span class="keywordtype">void</span> debug_objects_ct::init_and_rdlock()</div>
<div class="line">      {</div>
<div class="line">        _private_::rwlock_tct&lt;libcwd::_private_::debug_objects_instance&gt;::initialize();</div>
<div class="line">        DEBUG_OBJECTS_ACQUIRE_READ_LOCK;</div>
<div class="line">        <span class="keywordflow">if</span> (!WNS_debug_objects)                         <span class="comment">// MT: `WNS_debug_objects&#39; is only false when this object is still Non_Shared.</span></div>
<div class="line">        {</div>
<div class="line">          DEBUGDEBUG_CERR( <span class="stringliteral">&quot;_debug_objects == NULL; initializing it&quot;</span> );</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">          <span class="comment">// It is possible that malloc is not initialized yet.</span></div>
<div class="line">          init_debugmalloc();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">          LIBCWD_TSD_DECLARATION;</div>
<div class="line">          set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">          DEBUG_OBJECTS_ACQUIRE_READ2WRITE_LOCK;</div>
<div class="line">          WNS_debug_objects = <span class="keyword">new</span> debug_objects_ct::container_type;</div>
<div class="line">          DEBUG_OBJECTS_ACQUIRE_WRITE2READ_LOCK;</div>
<div class="line">          set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">      <span class="comment">// _private_::</span></div>
<div class="line">      <span class="keywordtype">void</span> debug_objects_ct::ST_uninit()</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (WNS_debug_objects)</div>
<div class="line">        {</div>
<div class="line">          LIBCWD_TSD_DECLARATION;</div>
<div class="line">          set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">          <span class="keyword">delete</span> WNS_debug_objects;</div>
<div class="line">          set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">          WNS_debug_objects = NULL;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    } <span class="comment">// namespace _private_</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">long</span> WST_debug_object_init_magic = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> init_debug_object_init_magic()</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">struct </span>timeval rn;</div>
<div class="line">      gettimeofday(&amp;rn, NULL);</div>
<div class="line">      WST_debug_object_init_magic = rn.tv_usec;</div>
<div class="line">      <span class="keywordflow">if</span> (!WST_debug_object_init_magic)</div>
<div class="line">        WST_debug_object_init_magic = 1;</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Set WST_debug_object_init_magic to &quot;</span> &lt;&lt; WST_debug_object_init_magic );</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">class </span>laf_ct {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">      buffer_ct buffer;</div>
<div class="line">        <span class="comment">// The temporary output buffer.</span></div>
<div class="line"> </div>
<div class="line">      _private_::bufferstream_ct bufferstream;</div>
<div class="line">        <span class="comment">// Our &#39;stringstream&#39;.</span></div>
<div class="line"> </div>
<div class="line">      <a class="code" href="group__group__control__flags.html#ga4aeae06f97b04d5db2b57ca5f0ded615">control_flag_t</a> mask;</div>
<div class="line">        <span class="comment">// The previous control bits.</span></div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">char</span> <span class="keyword">const</span>* label;</div>
<div class="line">        <span class="comment">// The previous label.</span></div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">int</span> err;</div>
<div class="line">        <span class="comment">// The current errno.</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">      laf_ct(<a class="code" href="group__group__control__flags.html#ga4aeae06f97b04d5db2b57ca5f0ded615">control_flag_t</a> m, <span class="keywordtype">char</span> <span class="keyword">const</span>* l, <span class="keywordtype">int</span> e) : bufferstream(&amp;buffer), mask(m), label(l), err(e) { }</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> write_whitespace_to(std::ostream&amp; os, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = size; i &gt; 0; --i)</div>
<div class="line">        os.put(<span class="charliteral">&#39; &#39;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">namespace </span>_private_ {</div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">char</span> WST_dummy_laf[<span class="keyword">sizeof</span>(laf_ct)] __attribute__((__aligned__));</div>
<div class="line">    } <span class="comment">// namespace _private_</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="group__chapter__core__dump.html#ga3a9ce22a745dc31b20a25615dc4b28cb">core_dump</a>()</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      <span class="comment">// Are we the first thread that tries to generate a core?</span></div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUGT || CWDEBUG_ALLOC</span></div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      LIBCWD_DISABLE_CANCEL;</div>
<div class="line">      <span class="keywordflow">if</span> (!_private_::mutex_tct&lt;_private_::kill_threads_instance&gt;::try_lock())</div>
<div class="line">      {</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">        __libcwd_tsd.internal = 0;      <span class="comment">// Dunno if this is needed, but it looks consistant.</span></div>
<div class="line">        ++__libcwd_tsd.library_call;;   <span class="comment">// So our sanity checks allow us to call free() again in</span></div>
<div class="line">                                        <span class="comment">// pthread_exit when we get here from malloc et al.</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        <span class="comment">// Another thread is already trying to generate a core dump.</span></div>
<div class="line">        pthread_setcancelstate(PTHREAD_CANCEL_ENABLE, NULL);</div>
<div class="line">        pthread_setcanceltype(PTHREAD_CANCEL_ASYNCHRONOUS, NULL);</div>
<div class="line">        pthread_exit(PTHREAD_CANCELED);</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// Leave cancelation disabled because otherwise it might be that another thread is generating the core.</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE &amp;&amp; CWDEBUG_DEBUG &amp;&amp; defined(__linux)</span></div>
<div class="line">      <span class="keywordflow">if</span> (!_private_::WST_is_NPTL &amp;&amp; pthread_self() == (pthread_t)2049)</div>
<div class="line">      {</div>
<div class="line">        ::write(1, <span class="stringliteral">&quot;WARNING: Thread manager core dumped.  Going into infinite loop.  Please detach process with gdb.\n&quot;</span>, 97);</div>
<div class="line">        <span class="keywordflow">while</span>(1) ;</div>
<div class="line">      }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      <span class="keyword">raise</span>(6);</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      LIBCWD_ENABLE_CANCEL;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      _Exit(6);         <span class="comment">// Never reached.</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> debug_string_ct::calculate_capacity(<span class="keywordtype">size_t</span> size)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">size_t</span> capacity_plus_one = M_default_capacity + 1;                        <span class="comment">// For the terminating zero.</span></div>
<div class="line">      <span class="keywordflow">while</span>(<a class="code" href="classlibcwd_1_1debug__string__ct.html#a013b5a96ba4dd0225497583a1847de52">size</a> &gt;= capacity_plus_one)</div>
<div class="line">        capacity_plus_one *= 2;</div>
<div class="line">      <span class="keywordflow">return</span> capacity_plus_one - 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> debug_string_ct::NS_internal_init(<span class="keywordtype">char</span> <span class="keyword">const</span>* str, <span class="keywordtype">size_t</span> len)</div>
<div class="line">    {</div>
<div class="line">      M_default_capacity = min_capacity_c;</div>
<div class="line">      M_str = (<span class="keywordtype">char</span>*)<a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">malloc</a>((M_default_capacity = M_capacity = calculate_capacity(len)) + 1);   <span class="comment">// Add one for the terminating zero. LEAK46</span></div>
<div class="line">      strncpy(M_str, str, len);</div>
<div class="line">      M_size = len;</div>
<div class="line">      M_str[M_size] = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// This is called with alloc checking off.</span></div>
<div class="line">    <span class="keywordtype">void</span> debug_string_ct::deinitialize()</div>
<div class="line">    {</div>
<div class="line">      free(M_str);</div>
<div class="line">      M_str = NULL;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// This is called with alloc checking on (or off).</span></div>
<div class="line">    debug_string_ct::~debug_string_ct()</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG &amp;&amp; LIBCWD_THREAD_SAFE</span></div>
<div class="line">      LIBCWD_ASSERT(M_str == NULL);     <span class="comment">// Need to call debug_string_ct::deinitialize() before destructor.</span></div>
<div class="line">                                        <span class="comment">// But not in the non-threaded case, see debug_tsd_st::~debug_tsd_st.</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> debug_string_ct::internal_assign(<span class="keywordtype">char</span> <span class="keyword">const</span>* str, <span class="keywordtype">size_t</span> len)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (len &gt; M_capacity || (M_capacity &gt; M_default_capacity &amp;&amp; len &lt; M_default_capacity))</div>
<div class="line">        M_str = (<span class="keywordtype">char</span>*)realloc(M_str, (M_capacity = calculate_capacity(len)) + 1);</div>
<div class="line">      strncpy(M_str, str, len);</div>
<div class="line">      M_size = len;</div>
<div class="line">      M_str[M_size] = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> debug_string_ct::internal_append(<span class="keywordtype">char</span> <span class="keyword">const</span>* str, <span class="keywordtype">size_t</span> len)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (M_size + len &gt; M_capacity || (M_capacity &gt; M_default_capacity &amp;&amp; M_size + len &lt; M_default_capacity))</div>
<div class="line">        M_str = (<span class="keywordtype">char</span>*)realloc(M_str, (M_capacity = calculate_capacity(M_size + len)) + 1);</div>
<div class="line">      strncpy(M_str + M_size, str, len);</div>
<div class="line">      M_size += len;</div>
<div class="line">      M_str[M_size] = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> debug_string_ct::internal_prepend(<span class="keywordtype">char</span> <span class="keyword">const</span>* str, <span class="keywordtype">size_t</span> len)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (M_size + len &gt; M_capacity || (M_capacity &gt; M_default_capacity &amp;&amp; M_size + len &lt; M_default_capacity))</div>
<div class="line">        M_str = (<span class="keywordtype">char</span>*)realloc(M_str, (M_capacity = calculate_capacity(M_size + len)) + 1);</div>
<div class="line">      memmove(M_str + len, M_str, M_size + 1);</div>
<div class="line">      strncpy(M_str, str, len);</div>
<div class="line">      M_size += len;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="classlibcwd_1_1debug__string__ct.html#a3f380134ad3effcfb89ea2b74ceda989">debug_string_ct::reserve</a>(<span class="keywordtype">size_t</span> size)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="classlibcwd_1_1debug__string__ct.html#a013b5a96ba4dd0225497583a1847de52">size</a> &lt; M_size)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">      M_default_capacity = min_capacity_c;</div>
<div class="line">      M_str = (<span class="keywordtype">char</span>*)realloc(M_str, (M_default_capacity = M_capacity = calculate_capacity(<a class="code" href="classlibcwd_1_1debug__string__ct.html#a013b5a96ba4dd0225497583a1847de52">size</a>)) + 1);</div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> debug_string_ct::internal_swallow(debug_string_ct <span class="keyword">const</span>&amp; ds)</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// `this&#39; and `ds&#39; are both initialized.  `internal&#39; is set.</span></div>
<div class="line">      free(M_str);</div>
<div class="line">      M_str = ds.M_str;</div>
<div class="line">      M_size = ds.M_size;</div>
<div class="line">      M_capacity = ds.M_capacity;</div>
<div class="line">      M_default_capacity = ds.M_default_capacity;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="group__group__formatting.html#ga6b04359bdee53e41e5e477494d4b9348">debug_ct::push_margin</a>()</div>
<div class="line">    {</div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      debug_string_stack_element_ct* current_margin_stack = LIBCWD_TSD_MEMBER(M_margin_stack);</div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">      <span class="keywordtype">void</span>* new_debug_string = <a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">malloc</a>(<span class="keyword">sizeof</span>(debug_string_stack_element_ct));</div>
<div class="line">      LIBCWD_TSD_MEMBER(M_margin_stack) = <span class="keyword">new</span> (new_debug_string) debug_string_stack_element_ct(LIBCWD_TSD_MEMBER(<a class="code" href="group__group__formatting.html#gaf25600b372a15939f8c18307197f08ad">margin</a>));</div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">      LIBCWD_TSD_MEMBER(M_margin_stack)-&gt;next = current_margin_stack;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="group__group__formatting.html#ga006847cf0abd778f8fe7dbe1e3a262bf">debug_ct::pop_margin</a>()</div>
<div class="line">    {</div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      <span class="keywordflow">if</span> (!LIBCWD_TSD_MEMBER(M_margin_stack))</div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;Calling `debug_ct::pop_margin&#39; more often than `debug_ct::push_margin&#39;.&quot;</span>);</div>
<div class="line">      debug_string_stack_element_ct* next = LIBCWD_TSD_MEMBER(M_margin_stack)-&gt;next;</div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">      LIBCWD_TSD_MEMBER(<a class="code" href="group__group__formatting.html#gaf25600b372a15939f8c18307197f08ad">margin</a>).internal_swallow(LIBCWD_TSD_MEMBER(M_margin_stack)-&gt;debug_string);</div>
<div class="line">      free(LIBCWD_TSD_MEMBER(M_margin_stack));</div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">      LIBCWD_TSD_MEMBER(M_margin_stack) = next;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="group__group__formatting.html#ga1efdf25804c8f63fd2c97460ab9d21fc">debug_ct::push_marker</a>()</div>
<div class="line">    {</div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      debug_string_stack_element_ct* current_marker_stack = LIBCWD_TSD_MEMBER(M_marker_stack);</div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">      <span class="keywordtype">void</span>* new_debug_string = <a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">malloc</a>(<span class="keyword">sizeof</span>(debug_string_stack_element_ct));</div>
<div class="line">      LIBCWD_TSD_MEMBER(M_marker_stack) = <span class="keyword">new</span> (new_debug_string) debug_string_stack_element_ct(LIBCWD_TSD_MEMBER(<a class="code" href="group__group__formatting.html#gafad5c668902370b6b084bf54f3f37bc3">marker</a>));</div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">      LIBCWD_TSD_MEMBER(M_marker_stack)-&gt;next = current_marker_stack;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="group__group__formatting.html#ga52d93e7b3c62f9282e6009d5c7e05966">debug_ct::pop_marker</a>()</div>
<div class="line">    {</div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      <span class="keywordflow">if</span> (!LIBCWD_TSD_MEMBER(M_marker_stack))</div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;Calling `debug_ct::pop_marker&#39; more often than `debug_ct::push_marker&#39;.&quot;</span>);</div>
<div class="line">      debug_string_stack_element_ct* next = LIBCWD_TSD_MEMBER(M_marker_stack)-&gt;next;</div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">      LIBCWD_TSD_MEMBER(<a class="code" href="group__group__formatting.html#gafad5c668902370b6b084bf54f3f37bc3">marker</a>).internal_swallow(LIBCWD_TSD_MEMBER(M_marker_stack)-&gt;debug_string);</div>
<div class="line">      free(LIBCWD_TSD_MEMBER(M_marker_stack));</div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">      LIBCWD_TSD_MEMBER(M_marker_stack) = next;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> debug_tsd_st::start(debug_ct&amp; debug_object, channel_set_data_st&amp; channel_set LIBCWD_COMMA_TSD_PARAM)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG || CWDEBUG_DEBUGT</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      <span class="comment">// Initialisation of the TSD part should be done from LIBCWD_TSD_DECLARATION inside Dout et al.</span></div>
<div class="line">      LIBCWD_ASSERT( tsd_initialized );</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      <span class="keywordflow">if</span> (!tsd_initialized)</div>
<div class="line">        init();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (NEED_SUPRESSION_OF_MALLOC_AND_BFD)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">channels::dc::malloc</a>.<a class="code" href="classlibcwd_1_1channel__ct.html#a86c94f9631697791669c414e89dc6696">off</a>();</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_LOCATION</span></div>
<div class="line">        <a class="code" href="group__group__default__dc.html#ga1a335257af682a5f32ac33fd583fcbd1">channels::dc::bfd</a>.<a class="code" href="classlibcwd_1_1channel__ct.html#a86c94f9631697791669c414e89dc6696">off</a>();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Skip `start()&#39; for a `continued&#39; debug output.</span></div>
<div class="line">      <span class="comment">// Generating the &quot;prefix: &lt;continued&gt;&quot; is already taken care</span></div>
<div class="line">      <span class="comment">// of while generating the &quot;&lt;unfinished&gt;&quot; (see next `if&#39; block).</span></div>
<div class="line">      <span class="keywordflow">if</span> ((channel_set.mask &amp; (continued_maskbit|finish_maskbit)))</div>
<div class="line">      {</div>
<div class="line">        current-&gt;err = errno;                           <span class="comment">// Always keep the last errno as set at the start of LibcwDout()</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(current-&gt;mask &amp; continued_expected_maskbit))</div>
<div class="line">        {</div>
<div class="line">          std::ostream* target_os = (channel_set.mask &amp; <a class="code" href="group__group__control__flags.html#gac218bd7ea538df198acf2f6627da9769">cerr_cf</a>) ? &amp;std::cerr : debug_object.real_os;</div>
<div class="line">#<span class="keywordflow">if</span> LIBCWD_THREAD_SAFE</div>
<div class="line">          <span class="comment">// Try to get the lock, but don&#39;t try too long...</span></div>
<div class="line">          <span class="keywordtype">int</span> res;</div>
<div class="line">          <span class="keyword">struct</span> timespec <span class="keyword">const</span> t = { 0, 5000000 };</div>
<div class="line">          <span class="keywordtype">int</span> count = 0;</div>
<div class="line">          <span class="keywordflow">do</span></div>
<div class="line">          {</div>
<div class="line">            <span class="keywordflow">if</span> (!(res = debug_object.M_mutex-&gt;try_lock()))</div>
<div class="line">              <span class="keywordflow">break</span>;</div>
<div class="line">            nanosleep(&amp;t, NULL);</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">while</span>(++count &lt; 40);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">          target_os-&gt;put(<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">          <span class="keywordflow">if</span> (res == 0)</div>
<div class="line">            debug_object.M_mutex-&gt;unlock();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">          <span class="keywordtype">char</span> <span class="keyword">const</span>* channame = (channel_set.mask &amp; finish_maskbit) ? <span class="stringliteral">&quot;finish&quot;</span> : <span class="stringliteral">&quot;continued&quot;</span>;</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_LOCATION</span></div>
<div class="line">          <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;Using `dc::&quot;</span> &lt;&lt; channame &lt;&lt; <span class="stringliteral">&quot;&#39; in &quot;</span> &lt;&lt;</div>
<div class="line">              location_ct((<span class="keywordtype">char</span>*)__builtin_return_address(0) + <a class="code" href="namespacelibcwd.html#a2c5332fbeb7993b5c8b687f37afa5b75">builtin_return_address_offset</a>) &lt;&lt;</div>
<div class="line">              <span class="stringliteral">&quot; without (first using) a matching `continued_cf&#39;.&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">          <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;Using `dc::&quot;</span> &lt;&lt; channame &lt;&lt;</div>
<div class="line">              <span class="stringliteral">&quot;&#39; without (first using) a matching `continued_cf&#39;.&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG</span></div>
<div class="line">        <span class="comment">// MT: current != _private_::WST_dummy_laf, otherwise we didn&#39;t pass the previous if.</span></div>
<div class="line">        LIBCWD_ASSERT( current != <span class="keyword">reinterpret_cast&lt;</span>laf_ct*<span class="keyword">&gt;</span>(_private_::WST_dummy_laf) );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        current-&gt;mask = channel_set.mask;               <span class="comment">// New bits might have been added</span></div>
<div class="line">        <span class="keywordflow">if</span> ((current-&gt;mask &amp; finish_maskbit))</div>
<div class="line">          current-&gt;mask &amp;= ~continued_expected_maskbit;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line"> </div>
<div class="line">      ++LIBCWD_DO_TSD_MEMBER_OFF(debug_object);</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Entering debug_ct::start(), _off became &quot;</span> &lt;&lt; LIBCWD_DO_TSD_MEMBER_OFF(debug_object) );</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Is this an interrupting debug output (in the middle of a continued debug output)?</span></div>
<div class="line">      <span class="keywordflow">if</span> ((current-&gt;mask &amp; continued_cf_maskbit) &amp;&amp; unfinished_expected)</div>
<div class="line">      {</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG</span></div>
<div class="line">        <span class="comment">// MT: if current == _private_::WST_dummy_laf then</span></div>
<div class="line">        <span class="comment">//     (current-&gt;mask &amp; continued_cf_maskbit) is false and this if is skipped.</span></div>
<div class="line">        LIBCWD_ASSERT( current != <span class="keyword">reinterpret_cast&lt;</span>laf_ct*<span class="keyword">&gt;</span>(_private_::WST_dummy_laf) );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        <span class="keywordtype">int</span> saved_errno = errno;                                <span class="comment">// The writeto below changes errno.</span></div>
<div class="line">        <span class="comment">// And write out what is in the buffer till now.</span></div>
<div class="line">        std::ostream* target_os = (channel_set.mask &amp; <a class="code" href="group__group__control__flags.html#gac218bd7ea538df198acf2f6627da9769">cerr_cf</a>) ? &amp;std::cerr : debug_object.real_os;</div>
<div class="line">        current-&gt;buffer.writeto(target_os LIBCWD_COMMA_TSD, debug_object,</div>
<div class="line">            <span class="keyword">true</span>,                       <span class="comment">// This thread requests an &lt;unfinished&gt; because of previous, unfinished &#39;continued&#39; output.</span></div>
<div class="line">            <span class="keyword">false</span>                       <span class="comment">// Don&#39;t flush.</span></div>
<div class="line">            COMMA_IFTHREADS(<span class="keyword">true</span>)       <span class="comment">// This output ends on a newline by itself.</span></div>
<div class="line">            COMMA_IFTHREADS(<span class="keyword">false</span>));    <span class="comment">// The newline is not missing as a result of nonewline_cf.</span></div>
<div class="line">        <span class="comment">// Truncate the buffer to its prefix and append &quot;&lt;continued&gt;&quot; to it already.</span></div>
<div class="line">        current-&gt;buffer.restore_position();</div>
<div class="line">        current_bufferstream-&gt;write(<span class="stringliteral">&quot;&lt;continued&gt; &quot;</span>, 12);        <span class="comment">// therefore we repeat the space here.</span></div>
<div class="line">        errno = saved_errno;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Is this a nested debug output (the first of a series in the middle of another debug output)?</span></div>
<div class="line">      <span class="comment">// MT: if current == _private_::WST_dummy_laf then</span></div>
<div class="line">      <span class="comment">//     start_expected is true and this if is skipped.</span></div>
<div class="line">      <span class="keywordflow">if</span> (!start_expected)</div>
<div class="line">      {</div>
<div class="line">        <span class="comment">// Put current stringstream on the stack.</span></div>
<div class="line">        laf_stack.push(current);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Indent nested debug output with 4 extra spaces.</span></div>
<div class="line">        indent += 4;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// If the previous target was written to cerr, then</span></div>
<div class="line">        <span class="comment">// write this interrupting output to cerr too.</span></div>
<div class="line">        channel_set.mask |= (current-&gt;mask &amp; <a class="code" href="group__group__control__flags.html#gac218bd7ea538df198acf2f6627da9769">cerr_cf</a>);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Create a new laf.</span></div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;creating new laf_ct&quot;</span> );</div>
<div class="line">      <span class="keywordtype">int</span> saved_internal = _private_::set_library_call_on(LIBCWD_TSD);</div>
<div class="line">      _private_::set_invisible_on(LIBCWD_TSD);</div>
<div class="line">      current = <span class="keyword">new</span> laf_ct(channel_set.mask, channel_set.label, errno);         <span class="comment">// LEAK5: This allocation + location_ct.</span></div>
<div class="line">      _private_::set_invisible_off(LIBCWD_TSD);</div>
<div class="line">      _private_::set_library_call_off(saved_internal LIBCWD_COMMA_TSD);</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;current = &quot;</span> &lt;&lt; (<span class="keywordtype">void</span>*)current );</div>
<div class="line">      current_bufferstream = &amp;current-&gt;bufferstream;</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;laf_ct created&quot;</span> );</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Without a new nested Dout() call, we expect to see a finish() call: The finish belonging to *this* Dout() call.</span></div>
<div class="line">      start_expected = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// If this is a `continued&#39; debug output, then we want to print &quot;&lt;unfinished&gt;&quot; if next we see a start().</span></div>
<div class="line">      unfinished_expected = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Print prefix if requested.</span></div>
<div class="line">      <span class="comment">// Handle most common case first: no special flags set</span></div>
<div class="line">      <span class="keywordflow">if</span> (!(channel_set.mask &amp; (<a class="code" href="group__group__control__flags.html#ga33e668c19cc109120b759bcdfabfccfd">noprefix_cf</a>|<a class="code" href="group__group__control__flags.html#ga34149bed4b7201128a8d71d616467791">nolabel_cf</a>|<a class="code" href="group__group__control__flags.html#ga7d5eb3d700662ff7ecbde3d705691a4d">blank_margin_cf</a>|<a class="code" href="group__group__control__flags.html#gac79dd61edec06bb4671eaf8d1642d874">blank_label_cf</a>|<a class="code" href="group__group__control__flags.html#ga2cfa1c3a533cfeb49224e78fda458505">blank_marker_cf</a>)))</div>
<div class="line">      {</div>
<div class="line">        current_bufferstream-&gt;write(margin.c_str(), margin.size());</div>
<div class="line">        current_bufferstream-&gt;write(channel_set.label, WST_max_len);</div>
<div class="line">        current_bufferstream-&gt;write(marker.c_str(), marker.size());</div>
<div class="line">        write_whitespace_to(*current_bufferstream, indent);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(channel_set.mask &amp; <a class="code" href="group__group__control__flags.html#ga33e668c19cc109120b759bcdfabfccfd">noprefix_cf</a>))</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> ((channel_set.mask &amp; <a class="code" href="group__group__control__flags.html#ga7d5eb3d700662ff7ecbde3d705691a4d">blank_margin_cf</a>))</div>
<div class="line">          write_whitespace_to(*current_bufferstream, margin.size());</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          current_bufferstream-&gt;write(margin.c_str(), margin.size());</div>
<div class="line"><span class="preprocessor">#if !CWDEBUG_DEBUGOUTPUT</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(channel_set.mask &amp; <a class="code" href="group__group__control__flags.html#ga34149bed4b7201128a8d71d616467791">nolabel_cf</a>))</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">if</span> ((channel_set.mask &amp; <a class="code" href="group__group__control__flags.html#gac79dd61edec06bb4671eaf8d1642d874">blank_label_cf</a>))</div>
<div class="line">            write_whitespace_to(*current_bufferstream, WST_max_len);</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            current_bufferstream-&gt;write(channel_set.label, WST_max_len);</div>
<div class="line">          <span class="keywordflow">if</span> ((channel_set.mask &amp; <a class="code" href="group__group__control__flags.html#ga2cfa1c3a533cfeb49224e78fda458505">blank_marker_cf</a>))</div>
<div class="line">            write_whitespace_to(*current_bufferstream, marker.size());</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            current_bufferstream-&gt;write(marker.c_str(), marker.size());</div>
<div class="line">          write_whitespace_to(*current_bufferstream, indent);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> ((channel_set.mask &amp; continued_cf_maskbit))</div>
<div class="line">      {</div>
<div class="line">        <span class="comment">// If this is continued debug output, then it makes sense to remember the prefix length,</span></div>
<div class="line">        <span class="comment">// just in case we need indeed to output &lt;continued&gt; data.</span></div>
<div class="line">        current-&gt;buffer.store_position();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      --LIBCWD_DO_TSD_MEMBER_OFF(debug_object);</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Leaving debug_ct::start(), _off became &quot;</span> &lt;&lt; LIBCWD_DO_TSD_MEMBER_OFF(debug_object) );</div>
<div class="line"> </div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="group__group__default__dc.html#ga33bc4b6cb3a23b09521bfa69e0da3e7c">debug_tsd_st::finish</a>(debug_ct&amp; debug_object, channel_set_data_st&amp; <span class="comment">/*UNUSED, */</span> LIBCWD_COMMA_TSD_PARAM)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG</span></div>
<div class="line">      LIBCWD_ASSERT( current != <span class="keyword">reinterpret_cast&lt;</span>laf_ct*<span class="keyword">&gt;</span>(_private_::WST_dummy_laf) );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      std::ostream* target_os = (current-&gt;mask &amp; <a class="code" href="group__group__control__flags.html#gac218bd7ea538df198acf2f6627da9769">cerr_cf</a>) ? &amp;std::cerr : debug_object.real_os;</div>
<div class="line"> </div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (NEED_SUPRESSION_OF_MALLOC_AND_BFD)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">channels::dc::malloc</a>.<a class="code" href="classlibcwd_1_1channel__ct.html#aaec3cb39b5b3540db261fdcd8f4d91d3">on</a>();</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_LOCATION</span></div>
<div class="line">        <a class="code" href="group__group__default__dc.html#ga1a335257af682a5f32ac33fd583fcbd1">channels::dc::bfd</a>.<a class="code" href="classlibcwd_1_1channel__ct.html#aaec3cb39b5b3540db261fdcd8f4d91d3">on</a>();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Skip `finish()&#39; for a `continued&#39; debug output.</span></div>
<div class="line">      <span class="keywordflow">if</span> ((current-&gt;mask &amp; continued_cf_maskbit) &amp;&amp; !(current-&gt;mask &amp; finish_maskbit))</div>
<div class="line">      {</div>
<div class="line">        <span class="comment">// Allow a subsequent Dout(dc::continued (or dc::finish), ...).</span></div>
<div class="line">        current-&gt;mask |= continued_expected_maskbit;</div>
<div class="line">        <span class="keywordflow">if</span> ((current-&gt;mask &amp; continued_maskbit))</div>
<div class="line">          unfinished_expected = <span class="keyword">true</span>;</div>
<div class="line">        <span class="comment">// If the `flush_cf&#39; control flag is set, flush the ostream at every `finish()&#39; though.</span></div>
<div class="line">        <span class="keywordflow">if</span> ((current-&gt;mask &amp; <a class="code" href="group__group__control__flags.html#gaded9490b57a6872e145374e8cc43a0e0">flush_cf</a>))</div>
<div class="line">        {</div>
<div class="line">          <span class="comment">// Write buffer to ostream.</span></div>
<div class="line">          <span class="comment">// Flush ostream.  Note that in the case of nested debug output this `os&#39; can be an stringstream,</span></div>
<div class="line">          <span class="comment">// in that case, no actual flushing is done until the debug output to the real ostream has</span></div>
<div class="line">          <span class="comment">// finished.</span></div>
<div class="line">          current-&gt;buffer.writeto(target_os LIBCWD_COMMA_TSD, debug_object,</div>
<div class="line">              <span class="keyword">false</span>,                    <span class="comment">// This thread requests &lt;unfinished&gt; because of previous, unfinished &#39;continued&#39; output.</span></div>
<div class="line">              <span class="keyword">true</span>                      <span class="comment">// Flush ostream after printing this.</span></div>
<div class="line">              COMMA_IFTHREADS(<span class="keyword">false</span>)    <span class="comment">// This output does not end on a newline.</span></div>
<div class="line">              COMMA_IFTHREADS(<span class="keyword">false</span>));  <span class="comment">// The newline is not missing as a result of nonewline_cf.</span></div>
<div class="line">        }</div>
<div class="line">        set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      ++LIBCWD_DO_TSD_MEMBER_OFF(debug_object);</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Entering debug_ct::finish(), _off became &quot;</span> &lt;&lt; LIBCWD_DO_TSD_MEMBER_OFF(debug_object) );</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Handle control flags, if any:</span></div>
<div class="line">      <span class="keywordflow">if</span> ((current-&gt;mask &amp; <a class="code" href="group__group__control__flags.html#gabd3b35330f68a89067c99df07928c486">error_cf</a>))</div>
<div class="line">      {</div>
<div class="line">        <span class="comment">// strerror[_r] can call malloc (in gettext()).</span></div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">        <span class="keywordtype">int</span> saved_internal = _private_::set_library_call_on(LIBCWD_TSD);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if !LIBCWD_THREAD_SAFE</span></div>
<div class="line">        <span class="keywordtype">char</span> <span class="keyword">const</span>* error_text = strerror(current-&gt;err);</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">// LIBCWD_THREAD_SAFE</span></div>
<div class="line">        <span class="keywordtype">char</span> error_text_buf[512];</div>
<div class="line">        <span class="keywordtype">char</span> <span class="keyword">const</span>* error_text;</div>
<div class="line"><span class="preprocessor">#ifdef _GNU_SOURCE</span></div>
<div class="line">        error_text = strerror_r(current-&gt;err, error_text_buf, <span class="keyword">sizeof</span>(error_text_buf));</div>
<div class="line"><span class="preprocessor">#else   </span><span class="comment">// POSIX</span></div>
<div class="line">        <span class="keywordflow">if</span> (strerror_r(current-&gt;err, error_text_buf, <span class="keyword">sizeof</span>(error_text_buf)) == -1)</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">if</span> (errno == ERANGE)</div>
<div class="line">            error_text = <span class="stringliteral">&quot;&lt;libcwd: Oops, error text longer than 512 characters&gt;&quot;</span>;</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            error_text = <span class="stringliteral">&quot;Unknown Error&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          error_text = error_text_buf;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">        _private_::set_library_call_off(saved_internal LIBCWD_COMMA_TSD);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        *current_bufferstream &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; strerrno(current-&gt;err) &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; error_text &lt;&lt; <span class="charliteral">&#39;)&#39;</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span> (!(current-&gt;mask &amp; <a class="code" href="group__group__control__flags.html#ga76db767f5c7dfb77c48f5e91936c7114">nonewline_cf</a>))</div>
<div class="line">        current_bufferstream-&gt;put(<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Handle control flags, if any:</span></div>
<div class="line">      <span class="keywordflow">if</span> (current-&gt;mask != 0)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> ((current-&gt;mask &amp; (coredump_maskbit|fatal_maskbit)))</div>
<div class="line">        {</div>
<div class="line">          current-&gt;buffer.writeto(target_os LIBCWD_COMMA_TSD, debug_object,</div>
<div class="line">              <span class="keyword">false</span>,                    <span class="comment">// This thread requests &lt;unfinished&gt; because of previous, unfinished &#39;continued&#39; output.</span></div>
<div class="line">              !__libcwd_tsd.recursive_fatal     <span class="comment">// Flush ostream after printing this when there is no recursive loop yet.</span></div>
<div class="line">              COMMA_IFTHREADS(!(current-&gt;mask &amp; <a class="code" href="group__group__control__flags.html#ga76db767f5c7dfb77c48f5e91936c7114">nonewline_cf</a>))  <span class="comment">// Whether or not this output ends on a newline.</span></div>
<div class="line">              COMMA_IFTHREADS(<span class="keyword">true</span>));   <span class="comment">// If the newline is missing, then it is missing because of the use of nonewline_cf.</span></div>
<div class="line">          __libcwd_tsd.recursive_fatal = <span class="keyword">true</span>;</div>
<div class="line">          <span class="keywordflow">if</span> ((current-&gt;mask &amp; coredump_maskbit))</div>
<div class="line">            <a class="code" href="group__chapter__core__dump.html#ga3a9ce22a745dc31b20a25615dc4b28cb">core_dump</a>();</div>
<div class="line">          DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Deleting `current&#39; &quot;</span> &lt;&lt; (<span class="keywordtype">void</span>*)current );</div>
<div class="line">          <span class="keywordtype">int</span> saved_internal = _private_::set_library_call_on(LIBCWD_TSD);</div>
<div class="line">          _private_::set_invisible_on(LIBCWD_TSD);</div>
<div class="line">          <span class="keyword">delete</span> current;</div>
<div class="line">          _private_::set_invisible_off(LIBCWD_TSD);</div>
<div class="line">          _private_::set_library_call_off(saved_internal LIBCWD_COMMA_TSD);</div>
<div class="line">          DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Done deleting `current&#39;&quot;</span> );</div>
<div class="line">          set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">          <span class="keywordflow">if</span> (__libcwd_tsd.internal)                    <span class="comment">// Still internal?  Are we ever calling DoutFatal while internal?</span></div>
<div class="line">            _private_::set_library_call_on(LIBCWD_TSD); <span class="comment">// Indefinetely turn library call on before terminating threads.</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">          LIBCWD_DISABLE_CANCEL;</div>
<div class="line">          <span class="keywordflow">if</span> (!_private_::mutex_tct&lt;_private_::kill_threads_instance&gt;::try_lock())</div>
<div class="line">          {</div>
<div class="line">            <span class="comment">// Another thread is already trying to generate a core dump.</span></div>
<div class="line">            pthread_setcancelstate(PTHREAD_CANCEL_ENABLE, NULL);</div>
<div class="line">            pthread_setcanceltype(PTHREAD_CANCEL_ASYNCHRONOUS, NULL);</div>
<div class="line">            pthread_exit(PTHREAD_CANCELED);</div>
<div class="line">          }</div>
<div class="line">          _private_::rwlock_tct&lt;_private_::threadlist_instance&gt;::rdlock(<span class="keyword">true</span>);</div>
<div class="line">          <span class="comment">// Terminate all threads that I know of, so that no locks will remain.</span></div>
<div class="line">          <span class="keywordflow">for</span>(_private_::threadlist_t::iterator thread_iter = _private_::threadlist-&gt;begin(); thread_iter != _private_::threadlist-&gt;end(); ++thread_iter)</div>
<div class="line">            <span class="keywordflow">if</span> (!pthread_equal((*thread_iter).tid, pthread_self())</div>
<div class="line">#ifdef __linux</div>
<div class="line">                &amp;&amp; (_private_::WST_is_NPTL || (*thread_iter).tid != (pthread_t)1024)</div>
<div class="line">#endif</div>
<div class="line">                )</div>
<div class="line">              pthread_cancel((*thread_iter).tid);</div>
<div class="line">          _private_::rwlock_tct&lt;_private_::threadlist_instance&gt;::rdunlock();</div>
<div class="line">          LIBCWD_ENABLE_CANCEL;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">          _Exit(254);   <span class="comment">// Exit without calling global destructors.</span></div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> ((current-&gt;mask &amp; <a class="code" href="group__group__control__flags.html#gadb67bb8d9558741b023f3bce3444bfdc">wait_cf</a>))</div>
<div class="line">        {</div>
<div class="line">          current-&gt;buffer.writeto(target_os LIBCWD_COMMA_TSD, debug_object,</div>
<div class="line">              <span class="keyword">false</span>, debug_object.interactive COMMA_IFTHREADS(!(current-&gt;mask &amp; <a class="code" href="group__group__control__flags.html#ga76db767f5c7dfb77c48f5e91936c7114">nonewline_cf</a>))</div>
<div class="line">              COMMA_IFTHREADS(<span class="keyword">true</span>));</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">          debug_object.M_mutex-&gt;lock();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">          *target_os &lt;&lt; <span class="stringliteral">&quot;(type return)&quot;</span>;</div>
<div class="line">          <span class="keywordflow">if</span> (debug_object.interactive)</div>
<div class="line">          {</div>
<div class="line">            *target_os &lt;&lt; std::flush;</div>
<div class="line">            <span class="keywordflow">while</span>(std::cin.get() != <span class="charliteral">&#39;\n&#39;</span>) ;</div>
<div class="line">          }</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">          debug_object.M_mutex-&gt;unlock();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          current-&gt;buffer.writeto(target_os LIBCWD_COMMA_TSD, debug_object,</div>
<div class="line">              <span class="keyword">false</span>, (current-&gt;mask &amp; <a class="code" href="group__group__control__flags.html#gaded9490b57a6872e145374e8cc43a0e0">flush_cf</a>) COMMA_IFTHREADS(!(current-&gt;mask &amp; <a class="code" href="group__group__control__flags.html#ga76db767f5c7dfb77c48f5e91936c7114">nonewline_cf</a>))</div>
<div class="line">              COMMA_IFTHREADS(<span class="keyword">true</span>));</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        current-&gt;buffer.writeto(target_os LIBCWD_COMMA_TSD, debug_object,</div>
<div class="line">            <span class="keyword">false</span>, <span class="keyword">false</span> COMMA_IFTHREADS(!(current-&gt;mask &amp; <a class="code" href="group__group__control__flags.html#ga76db767f5c7dfb77c48f5e91936c7114">nonewline_cf</a>)) COMMA_IFTHREADS(<span class="keyword">true</span>));</div>
<div class="line"> </div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Deleting `current&#39; &quot;</span> &lt;&lt; (<span class="keywordtype">void</span>*)current );</div>
<div class="line">      <span class="keywordtype">int</span> saved_internal = _private_::set_library_call_on(LIBCWD_TSD);</div>
<div class="line">      _private_::set_invisible_on(LIBCWD_TSD);</div>
<div class="line">      <a class="code" href="group__group__control__flags.html#ga4aeae06f97b04d5db2b57ca5f0ded615">control_flag_t</a> mask = current-&gt;mask;      <span class="comment">// Keep this.</span></div>
<div class="line">      <span class="keyword">delete</span> current;</div>
<div class="line">      _private_::set_invisible_off(LIBCWD_TSD);</div>
<div class="line">      _private_::set_library_call_off(saved_internal LIBCWD_COMMA_TSD);</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Done deleting `current&#39;&quot;</span> );</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (start_expected)</div>
<div class="line">      {</div>
<div class="line">        <span class="comment">// Ok, we&#39;re done with the last buffer.</span></div>
<div class="line">        indent -= 4;</div>
<div class="line">        laf_stack.pop();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Restore previous buffer as being the current one, if any.</span></div>
<div class="line">      <span class="keywordflow">if</span> (laf_stack.size())</div>
<div class="line">      {</div>
<div class="line">        current = laf_stack.top();</div>
<div class="line">        DEBUGDEBUG_CERR( <span class="stringliteral">&quot;current = &quot;</span> &lt;&lt; (<span class="keywordtype">void</span>*)current );</div>
<div class="line">        current_bufferstream = &amp;current-&gt;bufferstream;</div>
<div class="line">        <span class="keywordflow">if</span> ((mask &amp; <a class="code" href="group__group__control__flags.html#gaded9490b57a6872e145374e8cc43a0e0">flush_cf</a>))</div>
<div class="line">          current-&gt;mask |= <a class="code" href="group__group__control__flags.html#gaded9490b57a6872e145374e8cc43a0e0">flush_cf</a>;    <span class="comment">// Propagate flush to real ostream.</span></div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        current = <span class="keyword">reinterpret_cast&lt;</span>laf_ct*<span class="keyword">&gt;</span>(_private_::WST_dummy_laf);  <span class="comment">// Used (MT: read-only!) in next debug_ct::start().</span></div>
<div class="line">        DEBUGDEBUG_CERR( <span class="stringliteral">&quot;current = &quot;</span> &lt;&lt; (<span class="keywordtype">void</span>*)current );</div>
<div class="line">        current_bufferstream = NULL;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      start_expected = <span class="keyword">true</span>;</div>
<div class="line">      unfinished_expected = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">      --LIBCWD_DO_TSD_MEMBER_OFF(debug_object);</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Leaving debug_ct::finish(), _off became &quot;</span> &lt;&lt; LIBCWD_DO_TSD_MEMBER_OFF(debug_object) );</div>
<div class="line"> </div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">PRAGMA_DIAGNOSTIC_PUSH_IGNORE_infinite_recursion</div>
<div class="line">    <span class="keywordtype">void</span> debug_tsd_st::fatal_finish(debug_ct&amp; debug_object, channel_set_data_st&amp; channel_set LIBCWD_COMMA_TSD_PARAM)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="group__group__default__dc.html#ga33bc4b6cb3a23b09521bfa69e0da3e7c">finish</a>(debug_object, channel_set LIBCWD_COMMA_TSD);</div>
<div class="line">      <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>( <a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;Don&#39;t use `DoutFatal&#39; together with `continued_cf&#39;, use `Dout&#39; instead.  (This message can also occur when using DoutFatal correctly but from the constructor of a global object).&quot;</span> );</div>
<div class="line">      _Exit(1); <span class="comment">// This is never reached, but g++ 3.3.x -O2 thinks it is.</span></div>
<div class="line">    }</div>
<div class="line">PRAGMA_DIAGNOSTIC_POP</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">    <span class="keywordtype">int</span> debug_ct::S_index_count = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">bool</span> debug_ct::NS_init(LIBCWD_TSD_PARAM)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (NS_being_initialized)</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">      ST_initialize_globals(LIBCWD_TSD);<span class="comment">// Because all allocations for global objects are internal these days, we use</span></div>
<div class="line">                                        <span class="comment">// the constructor of debug_ct to initiate the global initialization of libcwd</span></div>
<div class="line">                                        <span class="comment">// instead of relying on malloc().</span></div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (WNS_initialized)</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">      NS_being_initialized = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      M_mutex = NULL;</div>
<div class="line">      unfinished_oss = NULL;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG</span></div>
<div class="line">      <span class="keywordflow">if</span> (!WST_debug_object_init_magic)</div>
<div class="line">        init_debug_object_init_magic();</div>
<div class="line">      init_magic = WST_debug_object_init_magic;</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Set init_magic to &quot;</span> &lt;&lt; init_magic );</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Setting WNS_initialized to true&quot;</span> );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">      LIBCWD_DEFER_CANCEL;</div>
<div class="line">      _private_::debug_objects.init(LIBCWD_TSD);</div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);               <span class="comment">// debug_objects is internal.</span></div>
<div class="line">      DEBUG_OBJECTS_ACQUIRE_WRITE_LOCK;</div>
<div class="line">      <span class="keywordflow">if</span> (find(_private_::debug_objects.write_locked().begin(),</div>
<div class="line">               _private_::debug_objects.write_locked().end(), <span class="keyword">this</span>)</div>
<div class="line">          == _private_::debug_objects.write_locked().end()) <span class="comment">// Not added before?</span></div>
<div class="line">        _private_::debug_objects.write_locked().push_back(<span class="keyword">this</span>);</div>
<div class="line">      DEBUG_OBJECTS_RELEASE_WRITE_LOCK;</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">      LIBCWD_RESTORE_CANCEL;</div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);               <span class="comment">// debug_objects is internal.</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      <span class="keywordtype">int</span> saved_internal = _private_::set_library_call_on(LIBCWD_TSD);</div>
<div class="line">      _private_::set_invisible_on(LIBCWD_TSD);</div>
<div class="line">      <span class="keyword">new</span> (_private_::WST_dummy_laf) laf_ct(0, <a class="code" href="group__group__default__dc.html#gac0005e6a66a3a30b9e0df12b8efb38f7">channels::dc::debug</a>.get_label(), 0);     <span class="comment">// Leaks 24 bytes of memory</span></div>
<div class="line">      _private_::set_invisible_off(LIBCWD_TSD);</div>
<div class="line">      _private_::set_library_call_off(saved_internal LIBCWD_COMMA_TSD);</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      WNS_index = S_index_count++;</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUGT</span></div>
<div class="line">      LIBCWD_ASSERT( !_private_::WST_multi_threaded ); <span class="comment">// Only the first thread should be initializing debug_ct objects.</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      LIBCWD_ASSERT( __libcwd_tsd.do_array[WNS_index] == NULL );</div>
<div class="line">      debug_tsd_st&amp; tsd(*(__libcwd_tsd.do_array[WNS_index] =  <span class="keyword">new</span> debug_tsd_st));</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      tsd.init();</div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUGOUTPUT</span></div>
<div class="line">      LIBCWD_TSD_MEMBER_OFF = -1;               <span class="comment">// Print as much debug output as possible right away.</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      LIBCWD_TSD_MEMBER_OFF = 0;                <span class="comment">// Don&#39;t print debug output till the REAL initialization of the debug system</span></div>
<div class="line">                                                <span class="comment">// has been performed (ie, the _application_ start (don&#39;t confuse that with</span></div>
<div class="line">                                                <span class="comment">// the constructor - which does nothing)).</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;debug_ct::NS_init(), _off set to &quot;</span> &lt;&lt; LIBCWD_TSD_MEMBER_OFF );</div>
<div class="line"> </div>
<div class="line">      set_ostream(&amp;std::cerr);                  <span class="comment">// Write to std::cerr by default.</span></div>
<div class="line">      interactive = <span class="keyword">true</span>;                       <span class="comment">// and thus we&#39;re interactive.</span></div>
<div class="line"> </div>
<div class="line">      NS_being_initialized = <span class="keyword">false</span>;</div>
<div class="line">      WNS_initialized = <span class="keyword">true</span>;</div>
<div class="line">      <span class="keywordflow">return</span> <span class="keyword">true</span>;                              <span class="comment">// Success.</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> debug_tsd_st::init()</div>
<div class="line">    {</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Entering debug_tsd_st::init (this == &quot;</span> &lt;&lt; (<span class="keywordtype">void</span>*)<span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUGM</span></div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      LIBCWD_ASSERT( __libcwd_tsd.internal );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      start_expected = <span class="keyword">true</span>;                    <span class="comment">// Of course, we start with expecting the beginning of a debug output.</span></div>
<div class="line">      unfinished_expected = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// `current&#39; needs to be non-zero (saving us a check in start()) and</span></div>
<div class="line">      <span class="comment">// current.mask needs to be 0 to avoid a crash in start():</span></div>
<div class="line">      current = <span class="keyword">reinterpret_cast&lt;</span>laf_ct*<span class="keyword">&gt;</span>(_private_::WST_dummy_laf);</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;current = &quot;</span> &lt;&lt; (<span class="keywordtype">void</span>*)current );</div>
<div class="line">      current_bufferstream = NULL;</div>
<div class="line">      laf_stack.init();</div>
<div class="line">      continued_stack.init();</div>
<div class="line">      margin.NS_internal_init(<span class="stringliteral">&quot;&quot;</span>, 0);</div>
<div class="line">      marker.NS_internal_init(<span class="stringliteral">&quot;: &quot;</span>, 2);         <span class="comment">// LEAK7</span></div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUGOUTPUT</span></div>
<div class="line">      first_time = <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      off_count = 0;</div>
<div class="line">      M_margin_stack = NULL;</div>
<div class="line">      M_marker_stack = NULL;</div>
<div class="line">      indent = 0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      tsd_initialized = <span class="keyword">true</span>;</div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Leaving debug_tsd_st::init (this == &quot;</span> &lt;&lt; (<span class="keywordtype">void</span>*)<span class="keyword">this</span> &lt;&lt;</div>
<div class="line">          <span class="stringliteral">&quot;); &amp;tsd_initialized == &quot;</span> &lt;&lt; (<span class="keywordtype">void</span>*)&amp;tsd_initialized );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">    <span class="keyword">namespace </span>_private_ {</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUGT</span></div>
<div class="line">      <span class="keywordtype">void</span> debug_tsd_init(LIBCWD_TSD_PARAM_UNUSED)</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      <span class="keywordtype">void</span> debug_tsd_init(LIBCWD_TSD_PARAM)</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="group__group__special.html#ga2616a7f6d60f8d14beeada0f627de69c">ForAllDebugObjects</a>(</div>
<div class="line">          set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">          LIBCWD_ASSERT( __libcwd_tsd.do_array[(debugObject).WNS_index] == NULL );</div>
<div class="line">          debug_tsd_st&amp; tsd(*(__libcwd_tsd.do_array[(debugObject).WNS_index] =  <span class="keyword">new</span> debug_tsd_st));</div>
<div class="line">          tsd.init();</div>
<div class="line">          set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">          LIBCWD_DO_TSD_MEMBER_OFF(debugObject) = 0;</div>
<div class="line">        );</div>
<div class="line">      }</div>
<div class="line">    } <span class="comment">// namespace _private_</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    debug_tsd_st::~debug_tsd_st()</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      <span class="comment">// In the non-threaded case we do not want to deinitialize these because they</span></div>
<div class="line">      <span class="comment">// might still be needed if dc::malloc (and/or dc::bfd) is turned on and</span></div>
<div class="line">      <span class="comment">// the destructor of some global object that is destructed *after* libcw_do</span></div>
<div class="line">      <span class="comment">// is deleting (or allocating) memory.</span></div>
<div class="line"> </div>
<div class="line">      <span class="comment">// In the threaded case, we are called with `internal&#39; set.</span></div>
<div class="line">      margin.deinitialize();</div>
<div class="line">      marker.deinitialize();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      <span class="keywordflow">if</span> (!tsd_initialized)     <span class="comment">// Skip the rest when it wasn&#39;t initialized.</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      <span class="comment">// Sanity checks:</span></div>
<div class="line">      <span class="keywordflow">if</span> (continued_stack.size())</div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>( <a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>|<a class="code" href="group__group__control__flags.html#gac218bd7ea538df198acf2f6627da9769">cerr_cf</a>, <span class="stringliteral">&quot;Destructing debug_tsd_st with a non-empty continued_stack (missing dc::finish?)&quot;</span> );</div>
<div class="line">      <span class="keywordflow">if</span> (laf_stack.size())</div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>( <a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>|<a class="code" href="group__group__control__flags.html#gac218bd7ea538df198acf2f6627da9769">cerr_cf</a>, <span class="stringliteral">&quot;Destructing debug_tsd_st with a non-empty laf_stack&quot;</span> );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    channel_ct* <a class="code" href="group__group__special.html#ga0d03ab4e0075a22b968a06ab9d6c58e3">find_channel</a>(<span class="keywordtype">char</span> <span class="keyword">const</span>* label)</div>
<div class="line">    {</div>
<div class="line">      channel_ct* tmp = NULL;</div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      LIBCWD_DEFER_CANCEL;</div>
<div class="line">      _private_::debug_channels.init(LIBCWD_TSD);</div>
<div class="line">      DEBUG_CHANNELS_ACQUIRE_READ_LOCK;</div>
<div class="line">      <span class="keywordflow">for</span>(_private_::debug_channels_ct::container_type::const_iterator i(_private_::debug_channels.read_locked().begin());</div>
<div class="line">          i != _private_::debug_channels.read_locked().end(); ++i)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (!strncasecmp(label, (*i)-&gt;get_label(), strlen(label)))</div>
<div class="line">          tmp = (*i);</div>
<div class="line">      }</div>
<div class="line">      DEBUG_CHANNELS_RELEASE_READ_LOCK;</div>
<div class="line">      LIBCWD_RESTORE_CANCEL;</div>
<div class="line">      <span class="keywordflow">return</span> tmp;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="group__group__special.html#ga4471dbaf16aa7885b78b094fe51c5eb8">list_channels_on</a>(debug_ct&amp; debug_object)</div>
<div class="line">    {</div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      <span class="keywordflow">if</span> (LIBCWD_DO_TSD_MEMBER_OFF(debug_object) &lt; 0)</div>
<div class="line">      {</div>
<div class="line">        LIBCWD_DEFER_CANCEL;</div>
<div class="line">        _private_::debug_channels.init(LIBCWD_TSD);</div>
<div class="line">        LIBCWD_RESTORE_CANCEL;</div>
<div class="line">        LIBCWD_DEFER_CLEANUP_PUSH(&amp;rwlock_tct&lt;libcwd::_private_::debug_channels_instance&gt;::cleanup, NULL);</div>
<div class="line">        DEBUG_CHANNELS_ACQUIRE_READ_LOCK;</div>
<div class="line">        <span class="keywordflow">for</span>(_private_::debug_channels_ct::container_type::const_iterator i(_private_::debug_channels.read_locked().begin());</div>
<div class="line">            i != _private_::debug_channels.read_locked().end(); ++i)</div>
<div class="line">        {</div>
<div class="line">          LibcwDoutScopeBegin(LIBCWD_DEBUGCHANNELS, debug_object, <a class="code" href="group__group__default__dc.html#gaddaee3d6d01f64f1ded1d346bdbcad4e">dc::always</a>|<a class="code" href="group__group__control__flags.html#ga33e668c19cc109120b759bcdfabfccfd">noprefix_cf</a>);</div>
<div class="line">          <span class="keywordflow">if</span> (NEED_SUPRESSION_OF_MALLOC_AND_BFD)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">channels::dc::malloc</a>.<a class="code" href="classlibcwd_1_1channel__ct.html#aaec3cb39b5b3540db261fdcd8f4d91d3">on</a>();</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_LOCATION</span></div>
<div class="line">            <a class="code" href="group__group__default__dc.html#ga1a335257af682a5f32ac33fd583fcbd1">channels::dc::bfd</a>.<a class="code" href="classlibcwd_1_1channel__ct.html#aaec3cb39b5b3540db261fdcd8f4d91d3">on</a>();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">          }</div>
<div class="line">          LibcwDoutStream.write(LIBCWD_DO_TSD_MEMBER(debug_object, margin).c_str(), LIBCWD_DO_TSD_MEMBER(debug_object, margin).size());</div>
<div class="line">          LibcwDoutStream.write((*i)-&gt;get_label(), WST_max_len);</div>
<div class="line">          <span class="keywordflow">if</span> ((*i)-&gt;is_on(LIBCWD_TSD))</div>
<div class="line">            LibcwDoutStream.write(<span class="stringliteral">&quot;: Enabled&quot;</span>, 9);</div>
<div class="line">          <span class="keywordflow">else</span></div>
<div class="line">            LibcwDoutStream.write(<span class="stringliteral">&quot;: Disabled&quot;</span>, 10);</div>
<div class="line">          <span class="keywordflow">if</span> (NEED_SUPRESSION_OF_MALLOC_AND_BFD)</div>
<div class="line">          {</div>
<div class="line">            <a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">channels::dc::malloc</a>.<a class="code" href="classlibcwd_1_1channel__ct.html#a86c94f9631697791669c414e89dc6696">off</a>();</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_LOCATION</span></div>
<div class="line">            <a class="code" href="group__group__default__dc.html#ga1a335257af682a5f32ac33fd583fcbd1">channels::dc::bfd</a>.<a class="code" href="classlibcwd_1_1channel__ct.html#a86c94f9631697791669c414e89dc6696">off</a>();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">          }</div>
<div class="line">          LibcwDoutScopeEnd;</div>
<div class="line">        }</div>
<div class="line">        DEBUG_CHANNELS_RELEASE_READ_LOCK;</div>
<div class="line">        LIBCWD_CLEANUP_POP_RESTORE(<span class="keyword">false</span>);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> channel_ct::NS_initialize(<span class="keywordtype">char</span> <span class="keyword">const</span>* label LIBCWD_COMMA_TSD_PARAM, <span class="keywordtype">bool</span> add_to_channel_list)</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// This is pretty much identical to fatal_channel_ct::fatal_channel_ct().</span></div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (WNS_initialized)</div>
<div class="line">        <span class="keywordflow">return</span>;         <span class="comment">// Already initialized.</span></div>
<div class="line"> </div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Entering `channel_ct::NS_initialize(\&quot;&quot;</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">&quot;\&quot;)&#39;&quot;</span> );</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">size_t</span> label_len = strlen(label);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (label_len &gt; <a class="code" href="namespacelibcwd.html#af987679b17017ae55fb3d8063b68c636">max_label_len_c</a>)  <span class="comment">// Only happens for customized channels</span></div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>( <a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;strlen(\&quot;&quot;</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">&quot;\&quot;) &gt; &quot;</span> &lt;&lt; <a class="code" href="namespacelibcwd.html#af987679b17017ae55fb3d8063b68c636">max_label_len_c</a> );</div>
<div class="line"> </div>
<div class="line">      LIBCWD_DEFER_CANCEL;</div>
<div class="line">      _private_::debug_channels.init(LIBCWD_TSD);</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">static</span> _private_::debug_channels_ct hidden_channels;</div>
<div class="line">      hidden_channels.init(LIBCWD_TSD);</div>
<div class="line"> </div>
<div class="line">      DEBUG_CHANNELS_ACQUIRE_WRITE_LOCK;</div>
<div class="line"> </div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);       <span class="comment">// debug_channels is internal.</span></div>
<div class="line">      <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">channels::dc::core</a>.get_label())[WST_max_len] = <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">      <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<a class="code" href="group__group__default__dc.html#ga3f5c48783b250b79e642077534b52d7c">channels::dc::fatal</a>.get_label())[WST_max_len] = <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">      _private_::debug_channels_ct::container_type&amp; channels(_private_::debug_channels.write_locked());</div>
<div class="line">      <span class="keywordflow">for</span>(_private_::debug_channels_ct::container_type::iterator i(channels.begin()); i != channels.end(); ++i)</div>
<div class="line">        <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>((*i)-&gt;get_label())[WST_max_len] = <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">      _private_::debug_channels_ct::container_type&amp; channels_not_listed(hidden_channels.write_locked());</div>
<div class="line">      <span class="keywordflow">for</span>(_private_::debug_channels_ct::container_type::iterator i(channels_not_listed.begin());</div>
<div class="line">          i != channels_not_listed.end(); ++i)</div>
<div class="line">        <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>((*i)-&gt;get_label())[WST_max_len] = <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// MT: This is not strict thread safe because it is possible that after threads are already</span></div>
<div class="line">      <span class="comment">//     running, a new shared library is dlopen-ed with a new global channel_ct with a larger</span></div>
<div class="line">      <span class="comment">//     label.  However, it makes no sense to lock the *reading* of WST_max_len for the other</span></div>
<div class="line">      <span class="comment">//     threads because this assignment is an atomic operation.  The lock above is only needed</span></div>
<div class="line">      <span class="comment">//     to prefend two such simultaneously loaded libraries from causing WST_max_len to end up</span></div>
<div class="line">      <span class="comment">//     not maximal.</span></div>
<div class="line">      <span class="comment">//     When this thread is cancelled later, there is no need to take action: the debug channel</span></div>
<div class="line">      <span class="comment">//     is global and can be used by any thread.  We want to keep the maximum label length as</span></div>
<div class="line">      <span class="comment">//     set by this channel.  Even when this debug channel is part of shared library that is</span></div>
<div class="line">      <span class="comment">//     being loaded by dlopen() then it won&#39;t get removed when this thread is cancelled.</span></div>
<div class="line">      <span class="comment">//     (Actually, a downwards update of WST_max_len should be done by dlclose if at all).</span></div>
<div class="line">      <span class="keywordflow">if</span> (label_len &gt; WST_max_len)</div>
<div class="line">        WST_max_len = label_len;</div>
<div class="line"> </div>
<div class="line">      <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">channels::dc::core</a>.get_label())[WST_max_len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">      <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(<a class="code" href="group__group__default__dc.html#ga3f5c48783b250b79e642077534b52d7c">channels::dc::fatal</a>.get_label())[WST_max_len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">      <span class="keywordflow">for</span>(_private_::debug_channels_ct::container_type::iterator i(channels.begin()); i != channels.end(); ++i)</div>
<div class="line">        <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>((*i)-&gt;get_label())[WST_max_len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">      <span class="keywordflow">for</span>(_private_::debug_channels_ct::container_type::iterator i(channels_not_listed.begin());</div>
<div class="line">          i != channels_not_listed.end(); ++i)</div>
<div class="line">        <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>((*i)-&gt;get_label())[WST_max_len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      <span class="comment">// MT: Take advantage of the `libcwd::_private_::debug_channels_instance&#39; lock to prevent simultaneous access</span></div>
<div class="line">      <span class="comment">//     to `next_index&#39; in the case of simultaneously dlopen-loaded libraries.</span></div>
<div class="line">      <span class="keyword">static</span> <span class="keywordtype">int</span> next_index;</div>
<div class="line">      WNS_index = ++next_index;         <span class="comment">// Don&#39;t use index 0, it is used to make sure that uninitialized channels appear to be off.</span></div>
<div class="line"> </div>
<div class="line">      __libcwd_tsd.off_cnt_array[WNS_index] = 0;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      off_cnt = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">PRAGMA_DIAGNOSTIC_PUSH_IGNORE_stringop_overflow</div>
<div class="line">      strncpy(WNS_label, label, label_len);</div>
<div class="line">PRAGMA_DIAGNOSTIC_POP</div>
<div class="line">      std::memset(WNS_label + label_len, <span class="charliteral">&#39; &#39;</span>, <a class="code" href="namespacelibcwd.html#af987679b17017ae55fb3d8063b68c636">max_label_len_c</a> - label_len);</div>
<div class="line">      WNS_label[WST_max_len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"> </div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);       <span class="comment">// debug_channels is internal.</span></div>
<div class="line">      <span class="keywordflow">if</span> (add_to_channel_list)</div>
<div class="line">      {</div>
<div class="line">        <span class="comment">// We store debug channels in some organized order, so that the</span></div>
<div class="line">        <span class="comment">// order in which they appear in the ForAllDebugChannels is not</span></div>
<div class="line">        <span class="comment">// dependent on the order in which these global objects are</span></div>
<div class="line">        <span class="comment">// initialized.</span></div>
<div class="line">        _private_::debug_channels_ct::container_type::iterator i(channels.begin());</div>
<div class="line">        <span class="keywordflow">for</span>(; i != channels.end(); ++i)</div>
<div class="line">          <span class="keywordflow">if</span> (strncmp((*i)-&gt;get_label(), WNS_label, WST_max_len) &gt; 0)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        channels.insert(i, <span class="keyword">this</span>);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        channels_not_listed.push_back(<span class="keyword">this</span>);</div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line"> </div>
<div class="line">      DEBUG_CHANNELS_RELEASE_WRITE_LOCK;</div>
<div class="line">      LIBCWD_RESTORE_CANCEL;</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// Turn debug channel &quot;WARNING&quot; on by default.</span></div>
<div class="line">      <span class="keywordflow">if</span> (strncmp(WNS_label, <span class="stringliteral">&quot;WARNING&quot;</span>, label_len) == 0)</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">        __libcwd_tsd.off_cnt_array[WNS_index] = -1;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        off_cnt = -1;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Leaving `channel_ct::NS_initialize(\&quot;&quot;</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">&quot;\&quot;)&quot;</span> );</div>
<div class="line"> </div>
<div class="line">      WNS_initialized = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> fatal_channel_ct::NS_initialize(<span class="keywordtype">char</span> <span class="keyword">const</span>* label, <a class="code" href="group__group__control__flags.html#ga4aeae06f97b04d5db2b57ca5f0ded615">control_flag_t</a> maskbit LIBCWD_COMMA_TSD_PARAM)</div>
<div class="line">    {</div>
<div class="line">       <span class="comment">// This is pretty much identical to channel_ct::NS_initialize().</span></div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (WNS_maskbit)</div>
<div class="line">        <span class="keywordflow">return</span>;         <span class="comment">// Already initialized.</span></div>
<div class="line"> </div>
<div class="line">      WNS_maskbit = maskbit;</div>
<div class="line"> </div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Entering `fatal_channel_ct::NS_initialize(\&quot;&quot;</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">&quot;\&quot;)&#39;&quot;</span> );</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">size_t</span> label_len = strlen(label);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (label_len &gt; <a class="code" href="namespacelibcwd.html#af987679b17017ae55fb3d8063b68c636">max_label_len_c</a>)  <span class="comment">// Only happens for customized channels</span></div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>( <a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;strlen(\&quot;&quot;</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">&quot;\&quot;) &gt; &quot;</span> &lt;&lt; <a class="code" href="namespacelibcwd.html#af987679b17017ae55fb3d8063b68c636">max_label_len_c</a> );</div>
<div class="line"> </div>
<div class="line">      LIBCWD_DEFER_CANCEL;</div>
<div class="line">      _private_::debug_channels.init(LIBCWD_TSD);</div>
<div class="line">      DEBUG_CHANNELS_ACQUIRE_WRITE_LOCK;</div>
<div class="line"> </div>
<div class="line">      set_alloc_checking_off(LIBCWD_TSD);       <span class="comment">// debug_channels is internal.</span></div>
<div class="line">      _private_::debug_channels_ct::container_type&amp; channels(_private_::debug_channels.write_locked());</div>
<div class="line">      <span class="keywordflow">for</span>(_private_::debug_channels_ct::container_type::iterator i(channels.begin()); i != channels.end(); ++i)</div>
<div class="line">        <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>((*i)-&gt;get_label())[WST_max_len] = <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"> </div>
<div class="line">      <span class="comment">// MT: See comments in channel_ct::NS_initialize above.</span></div>
<div class="line">      <span class="keywordflow">if</span> (label_len &gt; WST_max_len)</div>
<div class="line">        WST_max_len = label_len;</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span>(_private_::debug_channels_ct::container_type::iterator i(channels.begin()); i != channels.end(); ++i)</div>
<div class="line">        <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>((*i)-&gt;get_label())[WST_max_len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">      set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line"> </div>
<div class="line">PRAGMA_DIAGNOSTIC_PUSH_IGNORE_stringop_overflow</div>
<div class="line">      strncpy(WNS_label, label, label_len);</div>
<div class="line">PRAGMA_DIAGNOSTIC_POP</div>
<div class="line">      std::memset(WNS_label + label_len, <span class="charliteral">&#39; &#39;</span>, <a class="code" href="namespacelibcwd.html#af987679b17017ae55fb3d8063b68c636">max_label_len_c</a> - label_len);</div>
<div class="line">      WNS_label[WST_max_len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"> </div>
<div class="line">      DEBUG_CHANNELS_RELEASE_WRITE_LOCK;</div>
<div class="line">      LIBCWD_RESTORE_CANCEL;</div>
<div class="line"> </div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Leaving `fatal_channel_ct::NS_initialize(\&quot;&quot;</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">&quot;\&quot;)&quot;</span> );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> continued_channel_ct::NS_initialize(<a class="code" href="group__group__control__flags.html#ga4aeae06f97b04d5db2b57ca5f0ded615">control_flag_t</a> maskbit)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> (!WNS_maskbit)</div>
<div class="line">        WNS_maskbit = maskbit;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> <span class="keyword">const</span> always_channel_ct::label[<a class="code" href="namespacelibcwd.html#af987679b17017ae55fb3d8063b68c636">max_label_len_c</a> + 1] = { <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, 0 };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> channel_ct::off()</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      __libcwd_tsd.off_cnt_array[WNS_index] += 1;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      ++off_cnt;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> channel_ct::on()</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      <span class="keywordflow">if</span> (__libcwd_tsd.off_cnt_array[WNS_index] == -1)</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      <span class="keywordflow">if</span> (off_cnt == -1)</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>( <a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;Calling channel_ct::on() more often than channel_ct::off()&quot;</span> );</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      __libcwd_tsd.off_cnt_array[WNS_index] -= 1;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      --off_cnt;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//----------------------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Handle continued channel flags and update `off_count&#39; and `continued_stack&#39;.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">namespace </span>_private_ {</div>
<div class="line">      <span class="keywordtype">void</span> print_pop_error() {</div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;Using \&quot;dc::finish\&quot; without corresponding \&quot;continued_cf\&quot; or &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;calling the Dout(dc::finish, ...) more often than its corresponding &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;Dout(dc::channel|continued_cf, ...).  Note that the wrong \&quot;dc::finish\&quot; doesn&#39;t &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;have to be the one that we core dumped on, if two or more are nested.&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    continued_channel_set_st&amp; channel_set_st::operator|(<a class="code" href="group__group__control__flags.html#ga9d5fcf5636bf2a88e53860ccbe858d23">continued_cf_nt</a>)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG</span></div>
<div class="line">      DEBUGDEBUG_CERR( <span class="stringliteral">&quot;continued_cf detected&quot;</span> );</div>
<div class="line">      <span class="keywordflow">if</span> (!do_tsd_ptr || !do_tsd_ptr-&gt;tsd_initialized)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">if</span> (do_tsd_ptr)</div>
<div class="line">          DEBUGDEBUG_CERR( <span class="stringliteral">&quot;&amp;do_tsd_ptr-&gt;tsd_initialized == &quot;</span> &lt;&lt; (<span class="keywordtype">void</span>*)&amp;do_tsd_ptr-&gt;tsd_initialized );</div>
<div class="line">        FATALDEBUGDEBUG_CERR( <span class="stringliteral">&quot;Don&#39;t use DoutFatal together with continued_cf, use Dout instead.&quot;</span> );</div>
<div class="line">        <a class="code" href="group__chapter__core__dump.html#ga3a9ce22a745dc31b20a25615dc4b28cb">core_dump</a>();</div>
<div class="line">      }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      mask |= continued_cf_maskbit;</div>
<div class="line">      <span class="keywordflow">if</span> (!on)</div>
<div class="line">      {</div>
<div class="line">        ++(do_tsd_ptr-&gt;off_count);</div>
<div class="line">        DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Channel is switched off. Increased off_count to &quot;</span> &lt;&lt; do_tsd_ptr-&gt;off_count );</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        do_tsd_ptr-&gt;continued_stack.push(do_tsd_ptr-&gt;off_count);</div>
<div class="line">        DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Channel is switched on. Pushed off_count (&quot;</span> &lt;&lt; do_tsd_ptr-&gt;off_count &lt;&lt; <span class="stringliteral">&quot;) to stack (size now &quot;</span> &lt;&lt;</div>
<div class="line">            do_tsd_ptr-&gt;continued_stack.size() &lt;&lt; <span class="stringliteral">&quot;) and set off_count to 0&quot;</span> );</div>
<div class="line">        do_tsd_ptr-&gt;off_count = 0;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span> *(<span class="keyword">reinterpret_cast&lt;</span>continued_channel_set_st*<span class="keyword">&gt;</span>(<span class="keyword">this</span>));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    continued_channel_set_st&amp; channel_set_bootstrap_st::operator|(continued_channel_ct <span class="keyword">const</span>&amp; cdc)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG</span></div>
<div class="line">      <span class="keywordflow">if</span> ((cdc.get_maskbit() &amp; continued_maskbit))</div>
<div class="line">        DEBUGDEBUG_CERR( <span class="stringliteral">&quot;dc::continued detected&quot;</span> );</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        DEBUGDEBUG_CERR( <span class="stringliteral">&quot;dc::finish detected&quot;</span> );</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> ((on = !do_tsd_ptr-&gt;off_count))</div>
<div class="line">      {</div>
<div class="line">        DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Channel is switched on (off_count is 0)&quot;</span> );</div>
<div class="line">        do_tsd_ptr-&gt;current-&gt;mask |= cdc.get_maskbit();                                 <span class="comment">// We continue with the current channel</span></div>
<div class="line">        mask = do_tsd_ptr-&gt;current-&gt;mask;</div>
<div class="line">        label = do_tsd_ptr-&gt;current-&gt;label;</div>
<div class="line">        <span class="keywordflow">if</span> (cdc.get_maskbit() == finish_maskbit)</div>
<div class="line">        {</div>
<div class="line">          do_tsd_ptr-&gt;off_count = do_tsd_ptr-&gt;continued_stack.top();</div>
<div class="line">          do_tsd_ptr-&gt;continued_stack.pop();</div>
<div class="line">          DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Restoring off_count to &quot;</span> &lt;&lt; do_tsd_ptr-&gt;off_count &lt;&lt; <span class="stringliteral">&quot;. Stack size now &quot;</span> &lt;&lt; do_tsd_ptr-&gt;continued_stack.size() );</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        DEBUGDEBUG_CERR( <span class="stringliteral">&quot;Channel is switched off (off_count is &quot;</span> &lt;&lt; do_tsd_ptr-&gt;off_count &lt;&lt; <span class="charliteral">&#39;)&#39;</span> );</div>
<div class="line">        <span class="keywordflow">if</span> (cdc.get_maskbit() == finish_maskbit)</div>
<div class="line">        {</div>
<div class="line">          DEBUGDEBUG_CERR( <span class="stringliteral">&quot;` decrementing off_count with 1&quot;</span> );</div>
<div class="line">          --(do_tsd_ptr-&gt;off_count);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span>continued_channel_set_st*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">namespace </span>_private_ {</div>
<div class="line"> </div>
<div class="line">      <span class="keywordtype">void</span> assert_fail(<span class="keywordtype">char</span> <span class="keyword">const</span>* expr, <span class="keywordtype">char</span> <span class="keyword">const</span>* file, <span class="keywordtype">int</span> line, <span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">function</span>)</div>
<div class="line">      {</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG</span></div>
<div class="line">        LIBCWD_TSD_DECLARATION;</div>
<div class="line">        <span class="keywordflow">if</span> (__libcwd_tsd.recursive_assert</div>
<div class="line">#<span class="keywordflow">if</span> CWDEBUG_DEBUGM</div>
<div class="line">            || __libcwd_tsd.inside_malloc_or_free</div>
<div class="line">#endif</div>
<div class="line">            )</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">if</span> (!__libcwd_tsd.recursive_assert</div>
<div class="line">#<span class="keywordflow">if</span> CWDEBUG_ALLOC</div>
<div class="line">              &amp;&amp; __libcwd_tsd.library_call &lt; 6</div>
<div class="line">#endif</div>
<div class="line">              )</div>
<div class="line">          {</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">            <span class="keywordtype">int</span> saved_internal = 0;     <span class="comment">// To avoid &#39;may be used uninitialized&#39; compiler warning.</span></div>
<div class="line">            <span class="keywordtype">bool</span> is_internal = __libcwd_tsd.internal;</div>
<div class="line">            <span class="keywordflow">if</span> (is_internal)</div>
<div class="line">              saved_internal = _private_::set_library_call_on(LIBCWD_TSD);      <span class="comment">// flush is a library call.</span></div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">              ++__libcwd_tsd.library_call;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">            <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>( <a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.<a class="code" href="group__group__destination.html#ga3259c183bdfb2dc5a6050ea0e128b7ca">get_ostream</a>()-&gt;flush() );</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div>
<div class="line">            <span class="keywordflow">if</span> (is_internal)</div>
<div class="line">              _private_::set_library_call_off(saved_internal LIBCWD_COMMA_TSD);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">              --__libcwd_tsd.library_call;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">          }</div>
<div class="line">          set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">          FATALDEBUGDEBUG_CERR(file &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; line &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <span class="keyword">function</span> &lt;&lt; <span class="stringliteral">&quot;: Assertion `&quot;</span> &lt;&lt; expr &lt;&lt; <span class="stringliteral">&quot;&#39; failed.\n&quot;</span>);</div>
<div class="line">          set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">          <a class="code" href="group__chapter__core__dump.html#ga3a9ce22a745dc31b20a25615dc4b28cb">core_dump</a>();</div>
<div class="line">        }</div>
<div class="line">        __libcwd_tsd.recursive_assert = <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUGT</span></div>
<div class="line">        __libcwd_tsd.internal_debugging_code = <span class="keyword">true</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, file &lt;&lt; <span class="charliteral">&#39;:&#39;</span> &lt;&lt; line &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <span class="keyword">function</span> &lt;&lt; <span class="stringliteral">&quot;: Assertion `&quot;</span> &lt;&lt; expr &lt;&lt; <span class="stringliteral">&quot;&#39; failed.\n&quot;</span>);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">    } <span class="comment">// namespace _private_</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> debug_ct::force_on(debug_ct::OnOffState&amp; state)</div>
<div class="line">    {</div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUG</span></div>
<div class="line">      <span class="keywordflow">if</span> (!NS_init(LIBCWD_TSD))</div>
<div class="line">        <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;Calling debug_ct::NS_init recursively from debug_ct::force_on&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      (void)NS_init(LIBCWD_TSD);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      state._off = LIBCWD_TSD_MEMBER_OFF;</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUGOUTPUT</span></div>
<div class="line">      state.first_time = LIBCWD_TSD_MEMBER(first_time);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      LIBCWD_TSD_MEMBER_OFF = -1;                                       <span class="comment">// Turn object on.</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> debug_ct::restore(debug_ct::OnOffState <span class="keyword">const</span>&amp; state)</div>
<div class="line">    {</div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUGOUTPUT</span></div>
<div class="line">      <span class="keywordflow">if</span> (state.first_time != LIBCWD_TSD_MEMBER(first_time))            <span class="comment">// state.first_time &amp;&amp; !first_time.</span></div>
<div class="line">        <a class="code" href="group__chapter__core__dump.html#ga3a9ce22a745dc31b20a25615dc4b28cb">core_dump</a>();                                                    <span class="comment">// on() was called without first a call to off().</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      <span class="keywordflow">if</span> (LIBCWD_TSD_MEMBER_OFF != -1)</div>
<div class="line">        <a class="code" href="group__chapter__core__dump.html#ga3a9ce22a745dc31b20a25615dc4b28cb">core_dump</a>();                                                    <span class="comment">// off() and on() where called and not in equal pairs.</span></div>
<div class="line">      LIBCWD_TSD_MEMBER_OFF = state._off;                               <span class="comment">// Restore.</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> channel_ct::force_on(channel_ct::OnOffState&amp; state, <span class="keywordtype">char</span> <span class="keyword">const</span>* label)</div>
<div class="line">    {</div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      NS_initialize(label LIBCWD_COMMA_TSD, <span class="keyword">true</span>);</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      <span class="keywordtype">int</span>&amp; off_cnt(__libcwd_tsd.off_cnt_array[WNS_index]);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      state.off_cnt = off_cnt;</div>
<div class="line">      off_cnt = -1;                                     <span class="comment">// Turn channel on.</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> channel_ct::restore(channel_ct::OnOffState <span class="keyword">const</span>&amp; state)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">      LIBCWD_TSD_DECLARATION;</div>
<div class="line">      <span class="keywordtype">int</span>&amp; off_cnt(__libcwd_tsd.off_cnt_array[WNS_index]);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      <span class="keywordflow">if</span> (off_cnt != -1)</div>
<div class="line">        <a class="code" href="group__chapter__core__dump.html#ga3a9ce22a745dc31b20a25615dc4b28cb">core_dump</a>();                                    <span class="comment">// off() and on() where called and not in equal pairs.</span></div>
<div class="line">      off_cnt = state.off_cnt;                          <span class="comment">// Restore.</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line"><span class="comment">// Specialization</span></div>
<div class="line"><span class="keyword">template</span>&lt;&gt;</div>
<div class="line">  <span class="keywordtype">void</span> debug_ct::set_ostream(std::ostream* os, pthread_mutex_t* mutex)</div>
<div class="line">  {</div>
<div class="line">    LIBCWD_TSD_DECLARATION;</div>
<div class="line">    _private_::set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">    _private_::lock_interface_base_ct* new_mutex = <span class="keyword">new</span> _private_::pthread_lock_interface_ct(mutex);     <span class="comment">// A single LEAK of 20 bytes per debug object from here is ok.</span></div>
<div class="line">    _private_::set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">    LIBCWD_DEFER_CANCEL;</div>
<div class="line">    _private_::mutex_tct&lt;_private_::set_ostream_instance&gt;::lock();</div>
<div class="line">    _private_::lock_interface_base_ct* old_mutex = M_mutex;</div>
<div class="line">    <span class="keywordflow">if</span> (old_mutex)</div>
<div class="line">      old_mutex-&gt;lock();                <span class="comment">// Make sure all other threads left this critical area.</span></div>
<div class="line">    M_mutex = new_mutex;</div>
<div class="line">    <span class="keywordflow">if</span> (old_mutex)</div>
<div class="line">    {</div>
<div class="line">      old_mutex-&gt;unlock();</div>
<div class="line">      _private_::set_alloc_checking_off(LIBCWD_TSD);</div>
<div class="line">      <span class="keyword">delete</span> old_mutex;</div>
<div class="line">      _private_::set_alloc_checking_on(LIBCWD_TSD);</div>
<div class="line">    }</div>
<div class="line">    private_set_ostream(os);</div>
<div class="line">    _private_::mutex_tct&lt;_private_::set_ostream_instance&gt;::unlock();</div>
<div class="line">    LIBCWD_RESTORE_CANCEL;</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// LIBCWD_THREAD_SAFE</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> debug_ct::set_ostream(std::ostream* os)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">  <span class="keywordflow">if</span> (_private_::WST_multi_threaded)</div>
<div class="line"><span class="preprocessor">#if CWDEBUG_LOCATION</span></div>
<div class="line">    <a class="code" href="debug_8h.html#a345365647bad2709dac5955a83d33aa3">Dout</a>(<a class="code" href="group__group__default__dc.html#gaec68402e99fbc02d720bab71cef0d8d0">dc::warning</a>, location_ct((<span class="keywordtype">char</span>*)__builtin_return_address(0) + <a class="code" href="namespacelibcwd.html#a2c5332fbeb7993b5c8b687f37afa5b75">builtin_return_address_offset</a>) &lt;&lt; <span class="stringliteral">&quot;: You should passing a locking mechanism to `set_ostream&#39; for the ostream (see documentation/reference-manual/group__group__destination.html)&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <a class="code" href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a>(<a class="code" href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">dc::core</a>, <span class="stringliteral">&quot;You must pass a locking mechanism to `set_ostream&#39; for the ostream (see documentation/reference-manual/group__group__destination.html)&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#if CWDEBUG_DEBUGT</span></div>
<div class="line">  LIBCWD_TSD_DECLARATION;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  LIBCWD_DEFER_CANCEL;</div>
<div class="line">  _private_::mutex_tct&lt;_private_::set_ostream_instance&gt;::lock();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  private_set_ostream(os);</div>
<div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div>
<div class="line">  _private_::mutex_tct&lt;_private_::set_ostream_instance&gt;::unlock();</div>
<div class="line">  LIBCWD_RESTORE_CANCEL;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace libcwd</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// This can be used in configure to see if libcwd exists.</span></div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span> __libcwd_version = VERSION;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The following functions can be invoked from gdb directly.</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespacelibcwd.html">libcwd</a> {</div>
<div class="line">  <span class="keyword">namespace </span>_private_ {</div>
<div class="line">    <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="group__group__demangle.html#ga0bfa4b041346ea31f7d9432dee81e660">demangle_symbol</a>(<span class="keywordtype">char</span> <span class="keyword">const</span>* in, _private_::internal_string&amp; out);</div>
<div class="line">  } <span class="comment">// namespace _private_</span></div>
<div class="line">} <span class="comment">// namespace libcwd</span></div>
<div class="ttc" id="aclasslibcwd_1_1channel__ct_html_a86c94f9631697791669c414e89dc6696"><div class="ttname"><a href="classlibcwd_1_1channel__ct.html#a86c94f9631697791669c414e89dc6696">libcwd::channel_ct::off</a></div><div class="ttdeci">void off()</div><div class="ttdoc">Turn this channel off.</div><div class="ttdef"><b>Definition:</b> debug.cc:1780</div></div>
<div class="ttc" id="aclasslibcwd_1_1channel__ct_html_aaec3cb39b5b3540db261fdcd8f4d91d3"><div class="ttname"><a href="classlibcwd_1_1channel__ct.html#aaec3cb39b5b3540db261fdcd8f4d91d3">libcwd::channel_ct::on</a></div><div class="ttdeci">void on()</div><div class="ttdoc">Cancel one call to ‘off()’.</div><div class="ttdef"><b>Definition:</b> debug.cc:1795</div></div>
<div class="ttc" id="aclasslibcwd_1_1debug__string__ct_html_a013b5a96ba4dd0225497583a1847de52"><div class="ttname"><a href="classlibcwd_1_1debug__string__ct.html#a013b5a96ba4dd0225497583a1847de52">libcwd::debug_string_ct::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdoc">The size of the string.</div><div class="ttdef"><b>Definition:</b> class_debug_string.inl:89</div></div>
<div class="ttc" id="aclasslibcwd_1_1debug__string__ct_html_a3f380134ad3effcfb89ea2b74ceda989"><div class="ttname"><a href="classlibcwd_1_1debug__string__ct.html#a3f380134ad3effcfb89ea2b74ceda989">libcwd::debug_string_ct::reserve</a></div><div class="ttdeci">void reserve(size_t)</div><div class="ttdoc">Reserve memory for the string in advance.</div><div class="ttdef"><b>Definition:</b> debug.cc:905</div></div>
<div class="ttc" id="aconfig_8h_html"><div class="ttname"><a href="config_8h.html">config.h</a></div></div>
<div class="ttc" id="adebug_8h_html"><div class="ttname"><a href="#preparation_step2">debug.h</a></div><div class="ttdoc">This is the main header file of libcwd.</div></div>
<div class="ttc" id="adebug_8h_html_a345365647bad2709dac5955a83d33aa3"><div class="ttname"><a href="debug_8h.html#a345365647bad2709dac5955a83d33aa3">Dout</a></div><div class="ttdeci">#define Dout(cntrl, data)</div><div class="ttdoc">Macro for writing debug output.</div><div class="ttdef"><b>Definition:</b> debug.h:154</div></div>
<div class="ttc" id="adebug_8h_html_a40bdb8fcccb3c8293bd57ca9abef0dd7"><div class="ttname"><a href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a></div><div class="ttdeci">#define Debug(STATEMENTS...)</div><div class="ttdoc">Encapsulation macro for general debugging code.</div><div class="ttdef"><b>Definition:</b> debug.h:124</div></div>
<div class="ttc" id="agroup__chapter__core__dump_html_ga3a9ce22a745dc31b20a25615dc4b28cb"><div class="ttname"><a href="group__chapter__core__dump.html#ga3a9ce22a745dc31b20a25615dc4b28cb">libcwd::core_dump</a></div><div class="ttdeci">void core_dump()</div><div class="ttdoc">Dump core of current thread.</div><div class="ttdef"><b>Definition:</b> debug.cc:806</div></div>
<div class="ttc" id="agroup__group__control__flags_html_ga2cfa1c3a533cfeb49224e78fda458505"><div class="ttname"><a href="group__group__control__flags.html#ga2cfa1c3a533cfeb49224e78fda458505">libcwd::blank_marker_cf</a></div><div class="ttdeci">control_flag_t const blank_marker_cf</div><div class="ttdoc">Replace marker by white space.</div><div class="ttdef"><b>Definition:</b> control_flag.h:50</div></div>
<div class="ttc" id="agroup__group__control__flags_html_ga33e668c19cc109120b759bcdfabfccfd"><div class="ttname"><a href="group__group__control__flags.html#ga33e668c19cc109120b759bcdfabfccfd">libcwd::noprefix_cf</a></div><div class="ttdeci">control_flag_t const noprefix_cf</div><div class="ttdoc">Omit margin, label, marker and indentation.</div><div class="ttdef"><b>Definition:</b> control_flag.h:38</div></div>
<div class="ttc" id="agroup__group__control__flags_html_ga34149bed4b7201128a8d71d616467791"><div class="ttname"><a href="group__group__control__flags.html#ga34149bed4b7201128a8d71d616467791">libcwd::nolabel_cf</a></div><div class="ttdeci">control_flag_t const nolabel_cf</div><div class="ttdoc">Omit label, marker and indentation.</div><div class="ttdef"><b>Definition:</b> control_flag.h:41</div></div>
<div class="ttc" id="agroup__group__control__flags_html_ga4aeae06f97b04d5db2b57ca5f0ded615"><div class="ttname"><a href="group__group__control__flags.html#ga4aeae06f97b04d5db2b57ca5f0ded615">libcwd::control_flag_t</a></div><div class="ttdeci">unsigned int control_flag_t</div><div class="ttdef"><b>Definition:</b> control_flag.h:31</div></div>
<div class="ttc" id="agroup__group__control__flags_html_ga76db767f5c7dfb77c48f5e91936c7114"><div class="ttname"><a href="group__group__control__flags.html#ga76db767f5c7dfb77c48f5e91936c7114">libcwd::nonewline_cf</a></div><div class="ttdeci">control_flag_t const nonewline_cf</div><div class="ttdoc">Omit the default new line at the end.</div><div class="ttdef"><b>Definition:</b> control_flag.h:35</div></div>
<div class="ttc" id="agroup__group__control__flags_html_ga7d5eb3d700662ff7ecbde3d705691a4d"><div class="ttname"><a href="group__group__control__flags.html#ga7d5eb3d700662ff7ecbde3d705691a4d">libcwd::blank_margin_cf</a></div><div class="ttdeci">control_flag_t const blank_margin_cf</div><div class="ttdoc">Replace margin by white space.</div><div class="ttdef"><b>Definition:</b> control_flag.h:44</div></div>
<div class="ttc" id="agroup__group__control__flags_html_ga9d5fcf5636bf2a88e53860ccbe858d23"><div class="ttname"><a href="group__group__control__flags.html#ga9d5fcf5636bf2a88e53860ccbe858d23">libcwd::continued_cf_nt</a></div><div class="ttdeci">continued_cf_nt</div><div class="ttdoc">continued_cf has its own type for overloading purposes.</div><div class="ttdef"><b>Definition:</b> control_flag.h:75</div></div>
<div class="ttc" id="agroup__group__control__flags_html_gabd3b35330f68a89067c99df07928c486"><div class="ttname"><a href="group__group__control__flags.html#gabd3b35330f68a89067c99df07928c486">libcwd::error_cf</a></div><div class="ttdeci">control_flag_t const error_cf</div><div class="ttdoc">Append error string according to errno.</div><div class="ttdef"><b>Definition:</b> control_flag.h:62</div></div>
<div class="ttc" id="agroup__group__control__flags_html_gac218bd7ea538df198acf2f6627da9769"><div class="ttname"><a href="group__group__control__flags.html#gac218bd7ea538df198acf2f6627da9769">libcwd::cerr_cf</a></div><div class="ttdeci">control_flag_t const cerr_cf</div><div class="ttdoc">Force output to be written to cerr.</div><div class="ttdef"><b>Definition:</b> control_flag.h:53</div></div>
<div class="ttc" id="agroup__group__control__flags_html_gac79dd61edec06bb4671eaf8d1642d874"><div class="ttname"><a href="group__group__control__flags.html#gac79dd61edec06bb4671eaf8d1642d874">libcwd::blank_label_cf</a></div><div class="ttdeci">control_flag_t const blank_label_cf</div><div class="ttdoc">Replace label by white space.</div><div class="ttdef"><b>Definition:</b> control_flag.h:47</div></div>
<div class="ttc" id="agroup__group__control__flags_html_gadb67bb8d9558741b023f3bce3444bfdc"><div class="ttname"><a href="group__group__control__flags.html#gadb67bb8d9558741b023f3bce3444bfdc">libcwd::wait_cf</a></div><div class="ttdeci">control_flag_t const wait_cf</div><div class="ttdoc">If interactive, wait till return is pressed.</div><div class="ttdef"><b>Definition:</b> control_flag.h:59</div></div>
<div class="ttc" id="agroup__group__control__flags_html_gaded9490b57a6872e145374e8cc43a0e0"><div class="ttname"><a href="group__group__control__flags.html#gaded9490b57a6872e145374e8cc43a0e0">libcwd::flush_cf</a></div><div class="ttdeci">control_flag_t const flush_cf</div><div class="ttdoc">Flush ostream after writing this output.</div><div class="ttdef"><b>Definition:</b> control_flag.h:56</div></div>
<div class="ttc" id="agroup__group__default__dc_html_ga06f27a7560f652ec93e140b967ffbd58"><div class="ttname"><a href="group__group__default__dc.html#ga06f27a7560f652ec93e140b967ffbd58">libcwd::channels::dc::system</a></div><div class="ttdeci">channel_ct system</div><div class="ttdef"><b>Definition:</b> debug.cc:467</div></div>
<div class="ttc" id="agroup__group__default__dc_html_ga104365cb3a621bb5e2683ffda2da5919"><div class="ttname"><a href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">libcwd::channels::dc::malloc</a></div><div class="ttdeci">channel_ct malloc</div><div class="ttdef"><b>Definition:</b> debug.cc:474</div></div>
<div class="ttc" id="agroup__group__default__dc_html_ga1a335257af682a5f32ac33fd583fcbd1"><div class="ttname"><a href="group__group__default__dc.html#ga1a335257af682a5f32ac33fd583fcbd1">libcwd::channels::dc::bfd</a></div><div class="ttdeci">channel_ct bfd</div><div class="ttdef"><b>Definition:</b> bfd.cc:92</div></div>
<div class="ttc" id="agroup__group__default__dc_html_ga33bc4b6cb3a23b09521bfa69e0da3e7c"><div class="ttname"><a href="group__group__default__dc.html#ga33bc4b6cb3a23b09521bfa69e0da3e7c">libcwd::channels::dc::finish</a></div><div class="ttdeci">continued_channel_ct finish</div><div class="ttdef"><b>Definition:</b> debug.cc:517</div></div>
<div class="ttc" id="agroup__group__default__dc_html_ga3f5c48783b250b79e642077534b52d7c"><div class="ttname"><a href="group__group__default__dc.html#ga3f5c48783b250b79e642077534b52d7c">libcwd::channels::dc::fatal</a></div><div class="ttdeci">fatal_channel_ct fatal</div><div class="ttdef"><b>Definition:</b> debug.cc:527</div></div>
<div class="ttc" id="agroup__group__default__dc_html_ga75332c24852742e646f1a05bc9c1e270"><div class="ttname"><a href="group__group__default__dc.html#ga75332c24852742e646f1a05bc9c1e270">libcwd::channels::dc::notice</a></div><div class="ttdeci">channel_ct notice</div><div class="ttdef"><b>Definition:</b> debug.cc:460</div></div>
<div class="ttc" id="agroup__group__default__dc_html_ga7ddfec3fc9aa18c556a62f7d820c74e1"><div class="ttname"><a href="group__group__default__dc.html#ga7ddfec3fc9aa18c556a62f7d820c74e1">libcwd::channels::dc::continued</a></div><div class="ttdeci">continued_channel_ct continued</div><div class="ttdef"><b>Definition:</b> debug.cc:506</div></div>
<div class="ttc" id="agroup__group__default__dc_html_gac0005e6a66a3a30b9e0df12b8efb38f7"><div class="ttname"><a href="group__group__default__dc.html#gac0005e6a66a3a30b9e0df12b8efb38f7">libcwd::channels::dc::debug</a></div><div class="ttdeci">channel_ct debug</div><div class="ttdef"><b>Definition:</b> debug.cc:453</div></div>
<div class="ttc" id="agroup__group__default__dc_html_gaddaee3d6d01f64f1ded1d346bdbcad4e"><div class="ttname"><a href="group__group__default__dc.html#gaddaee3d6d01f64f1ded1d346bdbcad4e">libcwd::channels::dc::always</a></div><div class="ttdeci">always_channel_ct always</div><div class="ttdef"><b>Definition:</b> debug.cc:495</div></div>
<div class="ttc" id="agroup__group__default__dc_html_gadff2e678fd34270c2a9e612ddd7cc6c9"><div class="ttname"><a href="group__group__default__dc.html#gadff2e678fd34270c2a9e612ddd7cc6c9">libcwd::channels::dc::core</a></div><div class="ttdeci">fatal_channel_ct core</div><div class="ttdef"><b>Definition:</b> debug.cc:537</div></div>
<div class="ttc" id="agroup__group__default__dc_html_gaec68402e99fbc02d720bab71cef0d8d0"><div class="ttname"><a href="group__group__default__dc.html#gaec68402e99fbc02d720bab71cef0d8d0">libcwd::channels::dc::warning</a></div><div class="ttdeci">channel_ct warning</div><div class="ttdef"><b>Definition:</b> debug.cc:485</div></div>
<div class="ttc" id="agroup__group__demangle_html_ga0bfa4b041346ea31f7d9432dee81e660"><div class="ttname"><a href="group__group__demangle.html#ga0bfa4b041346ea31f7d9432dee81e660">libcwd::demangle_symbol</a></div><div class="ttdeci">void demangle_symbol(char const *input, std::string &amp;output)</div><div class="ttdoc">Demangle mangled symbol name input and write the result to string output.</div><div class="ttdef"><b>Definition:</b> demangle3.cc:825</div></div>
<div class="ttc" id="agroup__group__destination_html_ga3259c183bdfb2dc5a6050ea0e128b7ca"><div class="ttname"><a href="group__group__destination.html#ga3259c183bdfb2dc5a6050ea0e128b7ca">libcwd::debug_ct::get_ostream</a></div><div class="ttdeci">std::ostream * get_ostream() const</div><div class="ttdoc">Get the ostream device as set with set_ostream().</div><div class="ttdef"><b>Definition:</b> class_debug.inl:128</div></div>
<div class="ttc" id="agroup__group__fatal__output_html_gaa45bf8d78ed558bebec07438c4f8abf1"><div class="ttname"><a href="group__group__fatal__output.html#gaa45bf8d78ed558bebec07438c4f8abf1">DoutFatal</a></div><div class="ttdeci">#define DoutFatal(cntrl, data)</div><div class="ttdoc">Macro for writing fatal debug output to the default debug object libcw_do .</div><div class="ttdef"><b>Definition:</b> debug.h:164</div></div>
<div class="ttc" id="agroup__group__formatting_html_ga006847cf0abd778f8fe7dbe1e3a262bf"><div class="ttname"><a href="group__group__formatting.html#ga006847cf0abd778f8fe7dbe1e3a262bf">libcwd::debug_ct::pop_margin</a></div><div class="ttdeci">void pop_margin()</div><div class="ttdoc">Pop margin from the stack.</div><div class="ttdef"><b>Definition:</b> debug.cc:946</div></div>
<div class="ttc" id="agroup__group__formatting_html_ga1efdf25804c8f63fd2c97460ab9d21fc"><div class="ttname"><a href="group__group__formatting.html#ga1efdf25804c8f63fd2c97460ab9d21fc">libcwd::debug_ct::push_marker</a></div><div class="ttdeci">void push_marker()</div><div class="ttdoc">Push the current marker on a stack.</div><div class="ttdef"><b>Definition:</b> debug.cc:962</div></div>
<div class="ttc" id="agroup__group__formatting_html_ga52d93e7b3c62f9282e6009d5c7e05966"><div class="ttname"><a href="group__group__formatting.html#ga52d93e7b3c62f9282e6009d5c7e05966">libcwd::debug_ct::pop_marker</a></div><div class="ttdeci">void pop_marker()</div><div class="ttdoc">Pop marker from the stack.</div><div class="ttdef"><b>Definition:</b> debug.cc:976</div></div>
<div class="ttc" id="agroup__group__formatting_html_ga6b04359bdee53e41e5e477494d4b9348"><div class="ttname"><a href="group__group__formatting.html#ga6b04359bdee53e41e5e477494d4b9348">libcwd::debug_ct::push_margin</a></div><div class="ttdeci">void push_margin()</div><div class="ttdoc">Push the current margin on a stack.</div><div class="ttdef"><b>Definition:</b> debug.cc:932</div></div>
<div class="ttc" id="agroup__group__formatting_html_gaf25600b372a15939f8c18307197f08ad"><div class="ttname"><a href="group__group__formatting.html#gaf25600b372a15939f8c18307197f08ad">libcwd::debug_ct::margin</a></div><div class="ttdeci">debug_string_ct &amp; margin()</div><div class="ttdoc">The margin.</div><div class="ttdef"><b>Definition:</b> class_debug.inl:43</div></div>
<div class="ttc" id="agroup__group__formatting_html_gafad5c668902370b6b084bf54f3f37bc3"><div class="ttname"><a href="group__group__formatting.html#gafad5c668902370b6b084bf54f3f37bc3">libcwd::debug_ct::marker</a></div><div class="ttdeci">debug_string_ct &amp; marker()</div><div class="ttdoc">The marker.</div><div class="ttdef"><b>Definition:</b> class_debug.inl:59</div></div>
<div class="ttc" id="agroup__group__special_html_ga0d03ab4e0075a22b968a06ab9d6c58e3"><div class="ttname"><a href="group__group__special.html#ga0d03ab4e0075a22b968a06ab9d6c58e3">libcwd::find_channel</a></div><div class="ttdeci">channel_ct * find_channel(char const *label)</div><div class="ttdoc">Find debug channel with label label.</div><div class="ttdef"><b>Definition:</b> debug.cc:1528</div></div>
<div class="ttc" id="agroup__group__special_html_ga2616a7f6d60f8d14beeada0f627de69c"><div class="ttname"><a href="group__group__special.html#ga2616a7f6d60f8d14beeada0f627de69c">ForAllDebugObjects</a></div><div class="ttdeci">#define ForAllDebugObjects(STATEMENT...)</div><div class="ttdoc">Looping over all debug objects.</div><div class="ttdef"><b>Definition:</b> debug.h:209</div></div>
<div class="ttc" id="agroup__group__special_html_ga4471dbaf16aa7885b78b094fe51c5eb8"><div class="ttname"><a href="group__group__special.html#ga4471dbaf16aa7885b78b094fe51c5eb8">libcwd::list_channels_on</a></div><div class="ttdeci">void list_channels_on(debug_ct &amp;debug_object)</div><div class="ttdoc">List all debug channels to a given debug object.</div><div class="ttdef"><b>Definition:</b> debug.cc:1575</div></div>
<div class="ttc" id="anamespacelibcwd_html"><div class="ttname"><a href="namespacelibcwd.html">libcwd</a></div><div class="ttdoc">namespace for libcwd.</div><div class="ttdef"><b>Definition:</b> debug.cc:87</div></div>
<div class="ttc" id="anamespacelibcwd_html_a1b75e612b9e13134de69602543699370"><div class="ttname"><a href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcwd::libcw_do</a></div><div class="ttdeci">debug_ct libcw_do</div><div class="ttdoc">The default debug object.</div><div class="ttdef"><b>Definition:</b> debug.cc:429</div></div>
<div class="ttc" id="anamespacelibcwd_html_a2c5332fbeb7993b5c8b687f37afa5b75"><div class="ttname"><a href="namespacelibcwd.html#a2c5332fbeb7993b5c8b687f37afa5b75">libcwd::builtin_return_address_offset</a></div><div class="ttdeci">int const builtin_return_address_offset</div><div class="ttdoc">Offset to __builtin_return_address() needed to get the correct line number from location_ct.</div><div class="ttdef"><b>Definition:</b> sys.h:39</div></div>
<div class="ttc" id="anamespacelibcwd_html_af987679b17017ae55fb3d8063b68c636"><div class="ttname"><a href="namespacelibcwd.html#af987679b17017ae55fb3d8063b68c636">libcwd::max_label_len_c</a></div><div class="ttdeci">unsigned short const max_label_len_c</div><div class="ttdoc">The maximum number of characters that are allowed in a debug channel label.</div><div class="ttdef"><b>Definition:</b> max_label_len.h:24</div></div>
<div class="ttc" id="aprivate__bufferstream_8h_html"><div class="ttname"><a href="private__bufferstream_8h.html">private_bufferstream.h</a></div></div>
<div class="ttc" id="aprivate__internal__stringbuf_8h_html"><div class="ttname"><a href="private__internal__stringbuf_8h.html">private_internal_stringbuf.h</a></div></div>
<div class="ttc" id="astrerrno_8h_html"><div class="ttname"><a href="strerrno_8h.html">strerrno.h</a></div></div>
<div class="ttc" id="asys_8h_html"><div class="ttname"><a href="sys_8h.html">sys.h</a></div></div>
</div><!-- fragment -->  &laquo;<A HREF="../external/debug.cc">download</A>&raquo;</dd></dl>
<p>The above is just an example of course.&#160; But if you'd use it, then you would initialize libcwd by including the following at the top of main:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#ifdef CWDEBUG</span></div>
<div class="line">  myproject::debug::init();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="comment">// ...</span></div>
</div><!-- fragment --><p>And every thread would call <code>myproject::debug::init_thread();</code> when started. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<ADDRESS>Copyright &copy; 2001 - 2004 Carlo Wood.&nbsp; All rights reserved.</ADDRESS>
</DIV>
</BODY>
</HTML>
