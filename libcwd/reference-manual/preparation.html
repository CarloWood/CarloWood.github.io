<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML LANG="en-us">
<HEAD>
<META name="Author" content="Carlo Wood">
<META name="description" content="C++ debugging support library with ostream debug output">
<META name="keywords" content="libcwd, debug output, debug facility, debug channel, object orientation, OO, C++, nested debug output, ostream, memory allocation, debugging, source file and line number">
<META http-equiv="content-type" content="text/html; charset=iso-8859-1">
<META http-equiv="content-script-type" content="text/javascript">
<TITLE>libcwd: The C++ Debugging Support Library - Reference Manual</TITLE>
<SCRIPT src="../scripts/detect_browser.js"></SCRIPT>
<SCRIPT>need_style_doxygen=1</SCRIPT>
<SCRIPT src="../scripts/load_style_sheets.js"></SCRIPT>
</HEAD>
<BODY>
<DIV class="normal">
<center>
<a class="qindex" href="../index.html">Main Page</a> &nbsp;
<a class="qindex" href="index.html">Reference Manual</a> &nbsp;
<a class="qindex" href="namespaces.html">Namespace List</a> &nbsp;
<a class="qindex" href="annotated.html">Compound List</a> &nbsp;
<a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp;
<a class="qindex" href="functions.html">Compound Members</a> &nbsp;
<a class="qindex" href="globals.html">File Members</a> &nbsp;
</center>
<HR SIZE=1 NOSHADE>
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Preparation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="preparation_section"></a>
Preparation</h1>
<p>This page describes the preparations that you need to perform before starting to use libcwd in your applications source code.</p>
<h2><a class="anchor" id="installation"></a>
Step 1: Installing libcwd</h2>
<p>Binary distributions should be installed the usual way.</p>
<p>If you are installing libcwd from source then please read the  <A HREF="../external/INSTALL"> INSTALL </A>  file that is included in the source distribution.<br />
 See also: <a class="el" href="group__group__configuration.html">Configuration Options And Macros</a></p>
<p><a class="anchor" id="preparation_step2"></a></p>
<h2><a class="anchor" id="header_files"></a>
Step 2: Creating the custom header files</h2>
<p>You need to add two custom header files to your application.<br />
 The recommended names are "debug.h" and "<a class="code" href="#preparation_step2">sys.h</a>".</p>
<p>You can use the following templates for a quick start:</p>
<dl class="section user"><dt>sys.h example template</dt><dd><div class="fragment"><div class="line"><span class="comment">// sys.h</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// This header file is included at the top of every source file,</span></div><div class="line"><span class="comment">// before any other header file.</span></div><div class="line"><span class="comment">// It is intended to add defines that are needed globally and</span></div><div class="line"><span class="comment">// to work around Operating System dependend incompatibilities.</span></div><div class="line"></div><div class="line"><span class="comment">// The following includes the libcwd related mandatory part,</span></div><div class="line"><span class="comment">// which must be included before any system header file is included!</span></div><div class="line"></div><div class="line"><span class="comment">// Piggy back on cwds.</span></div><div class="line"><span class="preprocessor">#include &quot;cwds/sys.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// Add project specific parts here.</span></div></div><!-- fragment -->  &laquo;<A HREF="../external/sys.h">download</A>&raquo;</dd></dl>
<dl class="section user"><dt>debug.h example template</dt><dd><div class="fragment"><div class="line"><span class="comment">// Piggyback on cwds</span></div><div class="line"></div><div class="line"><span class="preprocessor">#pragma once</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define NAMESPACE_DEBUG myproject::debug</span></div><div class="line"><span class="preprocessor">#define NAMESPACE_DEBUG_START namespace myproject { namespace debug {</span></div><div class="line"><span class="preprocessor">#define NAMESPACE_DEBUG_END } }</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;cwds/debug.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// Declare project-wide debug channels here, or in some other (more) appropriate header file.</span></div><div class="line">NAMESPACE_DEBUG_CHANNELS_START</div><div class="line"><span class="keyword">extern</span> channel_ct custom;</div><div class="line">NAMESPACE_DEBUG_CHANNELS_END</div><div class="line"></div><div class="line"><span class="comment">// And define them in a .cpp file like:</span></div><div class="line"><span class="comment">//NAMESPACE_DEBUG_CHANNELS_START</span></div><div class="line"><span class="comment">//channel_ct custom(&quot;CUSTOM&quot;);</span></div><div class="line"><span class="comment">//NAMESPACE_DEBUG_CHANNELS_END</span></div></div><!-- fragment -->  &laquo;<A HREF="../external/debug.h">download</A>&raquo;</dd></dl>
<p>This debug.h file is for applications; for more detailed information and for information for library developers who want to use libcwd, please also read <a class="el" href="group__chapter__custom__debug__h.html">The Custom debug.h File</a>.</p>
<h2><a class="anchor" id="custom_debug_cc"></a>
Step 3: Creating the custom source file</h2>
<p>If you added one or more custom debug channels to your namespace <code>DEBUGCHANNELS</code> in your custom "debug.h", then of course you also need to add the definition somewhere.&#160; You can do that anywhere, or you could add a special source file for it.&#160;</p>
<dl class="section user"><dt>debug.cc example template</dt><dd><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="sys_8h.html">sys.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="#preparation_step2">debug.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef CWDEBUG</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>myproject {           <span class="comment">// &gt;</span></div><div class="line">  <span class="keyword">namespace </span><a class="code" href="group__group__default__dc.html#gac0005e6a66a3a30b9e0df12b8efb38f7">debug</a> {             <span class="comment">//  &gt;--&gt; This part must match DEBUGCHANNELS, see debug.h</span></div><div class="line">    <span class="keyword">namespace </span>channels {        <span class="comment">// &gt;</span></div><div class="line"></div><div class="line">      <span class="keyword">namespace </span>dc {</div><div class="line"></div><div class="line">        <span class="comment">// Add new debug channels here.</span></div><div class="line">        channel_ct custom(<span class="stringliteral">&quot;CUSTOM&quot;</span>);</div><div class="line"></div><div class="line">      } <span class="comment">// namespace dc</span></div><div class="line"></div><div class="line">    } <span class="comment">// namespace DEBUGCHANNELS</span></div><div class="line"></div><div class="line"><span class="comment">// Initialize debugging code from new threads.</span></div><div class="line"><span class="keywordtype">void</span> init_thread(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  <span class="comment">// Everything below needs to be repeated at the start of every</span></div><div class="line">  <span class="comment">// thread function, because every thread starts in a completely</span></div><div class="line">  <span class="comment">// reset state with all debug channels off etc.</span></div><div class="line"></div><div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE          // For the non-threaded case this is set by the rcfile.</span></div><div class="line">  <span class="comment">// Turn on all debug channels by default.</span></div><div class="line">  <a class="code" href="group__group__special.html#gadda3d19f06091c0f61a0e664e548f134">ForAllDebugChannels</a>(<span class="keywordflow">while</span>(!debugChannel.is_on()) debugChannel.on());</div><div class="line">  <span class="comment">// Turn off specific debug channels.</span></div><div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>(<a class="code" href="group__group__default__dc.html#ga1a335257af682a5f32ac33fd583fcbd1">dc::bfd</a>.off());</div><div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>(<a class="code" href="group__group__default__dc.html#ga104365cb3a621bb5e2683ffda2da5919">dc::malloc</a>.off());</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">  <span class="comment">// Turn on debug output.</span></div><div class="line">  <span class="comment">// Only turn on debug output when the environment variable SUPPRESS_DEBUG_OUTPUT is not set.</span></div><div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>(<span class="keywordflow">if</span> (getenv(<span class="stringliteral">&quot;SUPPRESS_DEBUG_OUTPUT&quot;</span>) == NULL) <a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.<a class="code" href="classlibcwd_1_1debug__ct.html#ab551645032e1910ce51294797716ef58">on</a>());</div><div class="line"><span class="preprocessor">#if LIBCWD_THREAD_SAFE</span></div><div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>(<a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.<a class="code" href="group__group__destination.html#gad3186732962fa4d461489fbd0e891dc0">set_ostream</a>(&amp;std::cout, &amp;cout_mutex));</div><div class="line"></div><div class="line">  <span class="comment">// Set the thread id in the margin.</span></div><div class="line">  <span class="keywordtype">char</span> margin[12];</div><div class="line">  sprintf(margin, <span class="stringliteral">&quot;%-10lu &quot;</span>, pthread_self());</div><div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>(<a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.<a class="code" href="group__group__formatting.html#gaf25600b372a15939f8c18307197f08ad">margin</a>().<a class="code" href="classlibcwd_1_1debug__string__ct.html#a49dd56496a4ce052f8ee6125a7a8e098">assign</a>(margin, 11));</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>(<a class="code" href="namespacelibcwd.html#a1b75e612b9e13134de69602543699370">libcw_do</a>.<a class="code" href="group__group__destination.html#gad3186732962fa4d461489fbd0e891dc0">set_ostream</a>(&amp;std::cout));</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">  <span class="comment">// Write a list of all existing debug channels to the default debug device.</span></div><div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>(<a class="code" href="group__group__special.html#ga4471dbaf16aa7885b78b094fe51c5eb8">list_channels_on</a>(libcw_do));</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Initialize debugging code from main().</span></div><div class="line"><span class="keywordtype">void</span> init(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  <span class="comment">// You want this, unless you mix streams output with C output.</span></div><div class="line">  <span class="comment">// Read  http://gcc.gnu.org/onlinedocs/libstdc++/27_io/howto.html#8 for an explanation.</span></div><div class="line">  <span class="comment">// We can&#39;t use it, because other code uses printf to write to the console.</span></div><div class="line"><span class="preprocessor">#if 0</span></div><div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>(<a class="code" href="group__group__invisible.html#gabdbb2bfbde6b510f98987f0ae7c9eccb">set_invisible_on</a>());</div><div class="line">  std::ios::sync_with_stdio(<span class="keyword">false</span>);     <span class="comment">// Cause &quot;memory leaks&quot; ([w]cin, [w]cout and [w]cerr filebuf allocations).</span></div><div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>(<a class="code" href="group__group__invisible.html#ga88578f13d809c007691caffacfac677f">set_invisible_off</a>());</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">  <span class="comment">// This will warn you when you are using header files that do not belong to the</span></div><div class="line">  <span class="comment">// shared libcwd object that you linked with.</span></div><div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>(check_configuration());</div><div class="line"></div><div class="line"><span class="preprocessor">#if CWDEBUG_ALLOC</span></div><div class="line">  <span class="comment">// Remove all current (pre- main) allocations from the Allocated Memory Overview.</span></div><div class="line">  <a class="code" href="group__group__invisible.html#gac086535865f146e706fb9d5e2959bd32">libcwd::make_all_allocations_invisible_except</a>(NULL);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">  <a class="code" href="debug_8h.html#a40bdb8fcccb3c8293bd57ca9abef0dd7">Debug</a>(<a class="code" href="namespacelibcwd.html#a4e9842ea3771f7a09c62f30ddd00940e">read_rcfile</a>());</div><div class="line"></div><div class="line">  init_thread();</div><div class="line">}</div><div class="line"></div><div class="line">  } <span class="comment">// namespace debug</span></div><div class="line">} <span class="comment">// namespace myproject</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif // CWDEBUG</span></div></div><!-- fragment -->  &laquo;<A HREF="../external/debug.cc">download</A>&raquo;</dd></dl>
<p>The above is just an example of course.&#160; But if you'd use it, then you would initialize libcwd by including the following at the top of main:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line"><span class="preprocessor">#ifdef CWDEBUG</span></div><div class="line">  myproject::debug::init();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"><span class="preprocessor">// ...</span></div></div><!-- fragment --><p>And every thread would call <code>myproject::debug::init_thread();</code> when started. </p>
</div></div><!-- contents -->
<ADDRESS>Copyright &copy; 2001 - 2004 Carlo Wood.&nbsp; All rights reserved.</ADDRESS>
</DIV>
</BODY>
</HTML>
